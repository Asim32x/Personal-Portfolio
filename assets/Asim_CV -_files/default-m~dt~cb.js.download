"use strict";(self.webpackChunk_grammarly_denali_app=self.webpackChunk_grammarly_denali_app||[]).push([[6027],{34681:(e,t,i)=>{i.d(t,{n:()=>h,r:()=>p});var s=i(83531),n=i(23988),o=i(31784),r=i(30040),a=i(80172),l=i(10047),d=i(69063),c=i(93712);class h{get withoutAccessToken(){return{csrfToken:this.csrfToken,containerId:this.containerId,clientName:this.clientName,clientVersion:this.clientVersion}}constructor(e,t,i,o){(0,n._)(this,"_gnarClient",void 0),(0,n._)(this,"_config",void 0),(0,n._)(this,"_env",void 0),(0,n._)(this,"_oauthClient",void 0),(0,n._)(this,"_cookieStorage",void 0),(0,n._)(this,"_log",void 0),(0,n._)(this,"csrfToken",void 0),(0,n._)(this,"containerId",void 0),(0,n._)(this,"clientName",void 0),(0,n._)(this,"clientVersion",void 0),(0,n._)(this,"accessToken",void 0),this._gnarClient=e,this._config=t,this._env=i,this._oauthClient=o,this._cookieStorage=new a.W6(this._config.domains.cookie),this._log=d.Bx.Logging.root.getLogger("base.fingerprints"),this.csrfToken=()=>this._cookieStorage.safeGetValue("csrf-token").then((e=>(Boolean(e)||this._log.warn("Missing CSRF token: token is empty"),e))).catch((e=>{throw this._log.warn("Missing CSRF token: error",e),e})),this.containerId=this._gnarClient.getContainerId(),this.clientName=this._env.names.auth,this.clientVersion=this._env.buildVersion;var r,l=this;this.accessToken=(r=this._env.platform)===c.OH.Platform.MACEDITOR||r===c.OH.Platform.IPAD?void 0:(0,s._)((function*(){try{return yield l._oauthClient(l.withoutAccessToken).getAccessToken()}catch(e){return}}))}}const u=(0,r.flow)(l.yU(["X-CSRF-Token","X-Container-Id","X-Client-Version","X-Client-Type","Authorization"]),l.pb((e=>void 0!==e[0])),l.Tj(o.wg),l.TS({},((e,[t,i])=>(e[t]=i,e))));function p(e){return()=>Promise.all([e.csrfToken(),e.containerId.catch(r.constUndefined),e.clientVersion.toString(),e.clientName,Promise.resolve("function"==typeof e.accessToken?e.accessToken():e.accessToken).then((e=>void 0===e?e:`Bearer ${e}`))]).then(u)}},86503:(e,t,i)=>{i.d(t,{$I:()=>le,pq:()=>ae});var s,n,o=i(23988),r=i(10334),a=i(17171),l=i(69384),d=i(60251),c=i(80172),h=i(16781),u=i(3880),p=i(81207),_=i(95074),g=i(1795),m=i(37560),f=i(93113),v=i(88265),y=i(63724),b=i(78793),w=i(65772),S=i(58526),x=i(42491),T=i(48581),k=i(36840),E=i(86562),P=i(60172),C=i(69063),D=i(20739),A=i(58889),U=i(30040),O=i(96797),M=i(80074),I=i(5692),N=i(43308),B=i(78339),F=i(15491),L=i(95168),R=i(44297),j=i(22835),H=i(58193),W=i(37107),G=i(86003),q=i(74194),V=i(78018),z=i(76901),Z=i(89096);!function(e){let t;!function(e){e.codec=O.NW({userAccount:q.bb.sharedCodec},"sharedState"),e.toPersistentState=e=>({userAccount:(0,a._)((0,r._)({},e.userAccount),{settings:W.tl.parse(W.Zb.read(e.userAccount.userProfile.id))})})}(t=e.Stored||(e.Stored={})),e.defaultPersistentState={userAccount:null},e.defaultState=e=>({authentication:e.userAccount?I.j.ok(e.userAccount):q.n6,userAccount:e.userAccount,editorTsNotifications:Z.n6,modal:z.n6,overlay:z.n6,documentsPage:V.n6,online:!0})}(s||(s={})),function(e){var t=e.STATE_KEY="appState";const i=G.u.getItemOfType(t,s.Stored.codec),n=G.u.setItemOfType(t,s.Stored.codec);let o;!function(e){const t=[{name:"page reload",active:()=>null!=performance&&performance.getEntriesByType("navigation").some((e=>"reload"===e.type))},{name:"external referrer",active:()=>!document.referrer.includes(location.origin)}];e.reasonToInvalidate=()=>(0,U.pipe)(t.find((e=>e.active())),R.fromNullable,R.map(j.Up("name")))}(o||(o={}));const r=(0,U.flow)(i,R.map(A.map(s.Stored.toPersistentState)),R.getOrElse((()=>A.right(s.defaultPersistentState))));function a(e){return null!==e&&I.j.isOk(e.subscription)}e.create=()=>{const e=C.Bx.Logging.getLogger("PersistentApp"),t=t=>{e.debug("Invalidating app state: ",t),G.u.clear()};(0,U.pipe)(o.reasonToInvalidate(),H.Mi(t));const i=(0,U.pipe)(r(),A.fold((t=>(t.forEach((({input:t,error:i})=>e.error("Error decoding persistent app state from session storage:",i,t))),G.u.clear(),s.defaultPersistentState)),(t=>(e.debug("Retrieved persistent app state from storage"),t)))),l=M.s.create(s.defaultState(i)),d=l.pipe(N.E("userAccount"),B.p(a),F.T((e=>({userAccount:j.cJ(e,"settings")}))),L.M((0,U.flow)(n,A.fold((t=>{e.error(t.message,t)}),(()=>{e.debug("App state persisted to session storage")}))))).subscribe();return{appState:l,invalidate:t,dispose:()=>d.unsubscribe()}}}(n||(n={}));var X,K=i(62279),Y=i(8094),J=i(93712),Q=i(34681),$=i(60269),ee=i(65141),te=i(62822),ie=i(54988);class se{constructor(){(0,o._)(this,"generalActivity",$.h(ee.R(window.document,"mousemove",{capture:!0,passive:!0}).pipe(te.u(void 0)),ee.R(window.document,"wheel",{capture:!0,passive:!0}).pipe(te.u(void 0)),ee.R(window.document,"keydown",{capture:!0,passive:!0}).pipe(te.u(void 0))))}}!function(e){e.Mock=class{constructor(){(0,o._)(this,"generalActivity",ie.w)}}}(X||(X={}));class ne{nextPingDateReadError(e){this._metric.getCounter("nextPingDate.read.failure").increment(),this._logger.warn("nextPingDate.read.failed",e)}nextPingDateWriteError(e){this._metric.getCounter("nextPingDate.write.failure").increment(),this._logger.warn("nextPingDate.write.failed",e)}sendError(){this._metric.getCounter("send.failure").increment()}trackBeforeSetUser(e){this._metric.getCounter("trackBeforeSetUser").increment(),this._logger.debug("trackBeforeSetUser",e)}constructor(e,t){(0,o._)(this,"_logger",void 0),(0,o._)(this,"_metric",void 0),this._logger=e,this._metric=t}}const oe={ga:e=>(0,k.Yi)(),setUserId:e=>(0,k.Yi)(),getClientId:()=>Promise.resolve("disabled_GA")};function re(e){return{primaryStorage:new c.W6(e.domains.cookie),altStorages:[new c.DT,new c.XG]}}const ae=(e,t)=>(0,k.Bj)((i=>new v.dN({clientId:i.clientName,redirectUri:e,domain:t,fetch:T.pM.request({target:"oauth",cache:"no-cache"}),httpClientOptions:{getApplicationHeaders:(0,Q.r)(i)}})),((...e)=>{const[t]=e;return t.clientName}));function le(e,t,i,s,o,l,v=re){const A=n.create();C.Bx.Logging.root.debug(`Constructing model for ${i.env} on the client`);const U=function(e,t,i=re){if("disabled"!==e.tracking.state){const{primaryStorage:s,altStorages:n}=i(e);return function(e,t,i,s,n){const o=e.api.gnarApi.url,r=new c.q2(i,s,new c.Mj(C.Bx.Logging.root.getLogger("gnar.containerIdManager"),C.Bx.TimeSeries.rootFemetrics.getMetric("gnar.containerIdManager")));return new c.Ob(o,n.names.tracking,n.buildVersion.toString(),t,r,new ne(C.Bx.Logging.root.getLogger("gnar"),C.Bx.TimeSeries.rootFemetrics.getMetric("gnar")),!1,oe)}(e,T.pM.request({target:"gnar",cache:"default"}),s,n,t)}{const e=new c.Aj;return e.getContainerId=()=>Promise.resolve("dummyContainerId"),e}}(i,e,v);U.getContainerId().then((e=>C.Bx.Logging.root.context.add({containerId:e}))).catch((e=>C.Bx.Logging.root.debug("cant get containerId",e)));const O=new Q.n(U,i,e,ae(window.location.origin,i.api.tokensUrl)),M=new se,I=function(e,t){switch(e){case J.OH.Platform.IPAD:return new D.BO(de(t));case J.OH.Platform.MACEDITOR:return new D.qb(de(t));case J.OH.Platform.WEB:return new D.vp(de(t));default:return(0,E.xb)(e)}}(e.platform,U),N=new D.Y$(U,M,i.pingMaybeGnarDelay,e);(0,k.hJ)("getEnv",(()=>e));const B=e.has(J.OH.Flag.useForceNoCacheOption)?"no-cache":"default",F=[T.pM.request({target:"manakin",cache:B}),{getApplicationHeaders:(0,Q.r)(O)},i.env===P.OH.fb||i.env===P.OH.dev?"prod":i.env];return new K.fI(A,new h.Nj(i.api.authUrl,u.j.createTE(T.pM.request({target:h.Nj.targetTag,cache:B})),O.withoutAccessToken),new y.lK(i.api.dapiUrl,u.j.create(T.pM.request({target:y.lK.targetTag,cache:B})),O),new g.X9(i.api.institutionUrl,u.j.create(T.pM.request({target:g.X9.targetTag,cache:B})),O),new d.eb(...F),new d.mP(...F),new p.DI(i.api.subscriptionUrl,u.j.create(T.pM.request({target:p.DI.targetTag,cache:B})),O),new _.R1(i.api.doxUrl,u.j.create(T.pM.request({target:_.R1.targetTag,cache:B})),O),new x.r(new b.y(i.api.doxWsUrl),(()=>new w.G(S.WS.create(),O.accessToken))),new f.v(i.api.settingsRegistryUrl,u.j.createTE(T.pM.request({target:f.v.targetTag,cache:B})),O),new D.IG(U,e.names.tracking),(0,a._)((0,r._)({gnarSpec:I},o),{bootstrap:N,getContainerId:U.getContainerId.bind(U)}),i,s,M,e,t,O,l,new Y.WG(O),new m.t.PassportClient(i.api.passportUrl,u.j.create(T.pM.request({target:p.DI.targetTag,cache:B})),O))}function de(e){const t=C.Bx.Logging.root.getLogger("gnar.events");return(0,a._)((0,r._)({},e),{track:i=>{const{eventName:s}=i,n=(0,l._)(i,["eventName"]);return t.info(s,n),e.track(i).catch((e=>(t.error("Failed to track gnar event (modern)",{eventName:s,props:i,error:e}),Promise.resolve())))}})}},98969:(e,t,i)=>{i.d(t,{b:()=>s});var s,n=i(44297),o=i(30040),r=i(96797),a=i(54708),l=i(37560),d=i(22835);!function(e){var t;e.codec=r.YO(r.E$([r.NW({featureReference:a.Type.createStringEnum(l.t.Feature,"PassportFeature")}),r.OH({entitlement:r.OH({stringValue:r.Yj,numberValue:r.ai,boolValue:r.zM})})])),e.fromPassport=e=>{var i;return null!==(t=null===(i=e.passport.featureVisa)||void 0===i?void 0:i.map((({featureReference:e,entitlement:t})=>({featureReference:e,entitlement:t}))))&&void 0!==t?t:[]},e.has=e=>t=>t.some((({featureReference:t,entitlement:i})=>{var s,n,o;const r=Boolean(null===(s=i)||void 0===s?void 0:s.boolValue)||Boolean(null===(n=i)||void 0===n?void 0:n.stringValue)||Boolean(null===(o=i)||void 0===o?void 0:o.numberValue);return t===e&&r}));const i=(e,t)=>i=>(0,o.pipe)(i.find((({featureReference:t})=>t===e)),n.fromNullable,n.chain((0,o.flow)(d.Up("entitlement"),n.fromNullable)),n.chain((0,o.flow)(d.Up(t),n.fromNullable)));e.getString=e=>i(e,"stringValue"),e.getNumber=e=>i(e,"numberValue"),e.getBoolean=e=>i(e,"boolValue"),e.getBrandingSet=(0,o.unsafeCoerce)(s.getString(l.t.Feature.BrandingSet))}(s||(s={}))},58687:(e,t,i)=>{i.d(t,{Aj:()=>C,Lj:()=>D,nS:()=>x.nS,ut:()=>E.ut,yD:()=>P});var s=i(23988),n=i(63336),o=i(80074),r=i(5692),a=i(15491),l=i(12884),d=i(89769),c=i(68101),h=i(6987),u=i(68745),p=i(36094),_=i(82718),g=i(45232),m=i(54988),f=i(21216),v=i(61586),y=i(44297),b=i(29052),w=i(28421),S=i(36840),x=i(40884),T=i(37107),k=i(40464),E=i(58434);const P={DESKTOP_APP_INSTALLED_MAC:"macExtension",DESKTOP_APP_INSTALLED_WINDOWS:"windowsExtension",MOBILE_INSTALLED:["keyboard-installed","mobile-app","mobile-android","mobile-ios"],FREEBIE_USER:"freebie",PREMIUM_CONVERSION:"premium-conversion",MOBILE_IOS_INSTALLED:"mobile-ios",MOBILE_ANDROID_INSTALLED:"mobile-android"};class C{constructor(e,t,i,o,a,l,d,c,h,u,p,_,g,m,f,v){(0,s._)(this,"_state",void 0),(0,s._)(this,"_subscriptionApi",void 0),(0,s._)(this,"_authApi",void 0),(0,s._)(this,"_dapi",void 0),(0,s._)(this,"_experimentClient",void 0),(0,s._)(this,"_clientControls",void 0),(0,s._)(this,"_router",void 0),(0,s._)(this,"_config",void 0),(0,s._)(this,"_environment",void 0),(0,s._)(this,"_platformEnvironment",void 0),(0,s._)(this,"_upgradeHook",void 0),(0,s._)(this,"_modal",void 0),(0,s._)(this,"_overlay",void 0),(0,s._)(this,"_logoutRD",void 0),(0,s._)(this,"_vitoClient",void 0),(0,s._)(this,"_onLogout",void 0),(0,s._)(this,"_logoutHandler",void 0),(0,s._)(this,"logout",void 0),(0,s._)(this,"updateUserRole",void 0),(0,s._)(this,"updateUserNativeLanguage",void 0),(0,s._)(this,"getUserNativeLanguage",void 0),(0,s._)(this,"clientControls",void 0),(0,s._)(this,"profile",void 0),(0,s._)(this,"subscription",void 0),(0,s._)(this,"settings",void 0),(0,s._)(this,"features",void 0),(0,s._)(this,"entitlements",void 0),this._state=e,this._subscriptionApi=t,this._authApi=i,this._dapi=o,this._experimentClient=a,this._clientControls=l,this._router=d,this._config=c,this._environment=h,this._platformEnvironment=u,this._upgradeHook=p,this._modal=_,this._overlay=g,this._logoutRD=m,this._vitoClient=f,this._onLogout=v,this._logoutHandler=new A(this._modal,this._overlay),this.logout=()=>{this._onLogout(),(0,n.pipe)(this._logoutRD,this._logoutHandler.handler).subscribe()},this.updateUserRole=e=>r.j.modifyRemoteStateOptimistic(this._state.lens("userProfile","role"),(()=>y.some(e)),this._authApi.setUserData({role:e})),this.updateUserNativeLanguage=e=>this._authApi.setUserData({primaryLanguage:e}),this.getUserNativeLanguage=(0,n.pipe)(this._authApi.getUser(),b.Tj((e=>y.fromNullable(e.customFields.frontend_primaryLanguage)))),this.clientControls=this._clientControls,this.profile=this._state.view("userProfile"),this.subscription=new k.H0(this._state.lens("subscription"),this._subscriptionApi,this._config,this._platformEnvironment,this._upgradeHook,this._state.lens("userProfile").view("isPaymentSandbox").get()),this.settings=new T.ZJ(this._state.lens("settings"),this._dapi,this._state.lens("userProfile").lens("id")),this.features=new x.nS(this._experimentClient,this._state.view("experiments"),this.subscription.state,this.profile,this.settings,this._clientControls,this._environment,this._router,this._vitoClient),this.entitlements=this._state.view("entitlements")}}var D;!function(e){e.Mock=class{constructor(){(0,s._)(this,"subscription",void 0),(0,s._)(this,"profile",o.s.create({fullName:"test",email:"test@test.com",institutionInfo:y.none}).view()),(0,s._)(this,"features",new x.ZI.DenaliPageFeaturesMock(!1,new x.ZI.DenaliFeaturesMock)),(0,s._)(this,"settings",new T.wq.Mock),(0,s._)(this,"entitlements",o.s.create(y.none))}}}(D||(D={}));class A{_errorState(e,t){return(0,n.pipe)(t,a.T((e=>(0,n.pipe)(l.Y(1e3),d.Z(-1),a.T((t=>e.status.previousDelay/1e3-(t+1))),c.v((e=>e>-1))))),h.n((t=>U(this._modal.editorTsNotifications,this._modal.editorTsNotifications.create.logoutError(e,t)))))}constructor(e,t){(0,s._)(this,"_modal",void 0),(0,s._)(this,"_overlay",void 0),(0,s._)(this,"handler",void 0),(0,s._)(this,"_fatalState",void 0),this._modal=e,this._overlay=t,this.handler=e=>{const t=new u.t(p.q6),i=()=>t.next(p.q6);return this._modal.show({type:"inProgressSpinner"}),(0,n.pipe)(t,_.K(e),g.M2("type"),g.YW({[w.ZU.InProgress]:()=>m.w,[w.ZU.Success]:()=>f.of(void 0),[w.ZU.Error]:e=>this._errorState(i,e),[w.ZU.Fatal]:this._fatalState}))},this._fatalState=()=>(this._modal.hide(),this._overlay.show(),U(this._modal.editorTsNotifications,this._modal.editorTsNotifications.create.logoutError(S.Yi,f.of(-1))))}}function U(e,t){return v.c.create((()=>{const i=e.show(t);return()=>e.hide(i)}))}},58434:(e,t,i)=>{i.d(t,{gG:()=>n,j1:()=>o,kz:()=>b,ut:()=>s,x:()=>y});var s,n,o,r=i(30040),a=i(96797),l=i(54708),d=i(16781),c=i(94155),h=i(5692),u=i(44297),p=i(21538),_=i(40464),g=i(98969),m=i(37107);!function(e){e.free="free",e.premium="premium"}(s||(s={})),function(e){e.work="work",e.school="school",e.otherProjects="other projects"}(n||(n={})),function(e){e.student="student"}(o||(o={}));const f=a.NW({email:a.Yj,fullName:a.Yj,institutionInfo:l.Type.option(d.KJ.InstitutionInfo.codec)}),v=a.E$([f,a.NW({id:a.Yj,confirmed:a.zM,type:l.Type.createStringEnum(s,"UserType"),role:l.Type.option(a.Yj),roles:a.YO(d.KJ.Role.codec),isTest:a.zM,canUseEditor:a.zM,groups:l.Type.set(a.Yj),loginType:l.Type.createStringEnum(d.Gb,"LoginType"),registrationDate:l.Type.option(l.Type.date()),editorFeatures:d.KJ.EditorFeatures.codec,isPaymentSandbox:a.zM}),a.OH({newEmail:a.Yj})]);var y,b;!function(e){var t=e.sharedCodec=a.NW({userProfile:v,subscription:h.j.valueCodec(_.E2,a.L5,a.L5),experiments:l.Type.set(a.Yj),entitlements:l.Type.option(g.b.codec)});e.codec=a.E$([t,a.NW({settings:m.tl.dapiPropsCodec})])}(y||(y={})),function(e){e.codec=l.Type.option(a.E$([p.O.codec,a.OH(c.k.ReadConfigIOType.props)]))}(b||(b={})),function(e){e.getDLPConfig=(0,r.flow)((e=>e.clientControls),u.map((e=>e.dlpConfiguration)))}(b||(b={}))},74194:(e,t,i)=>{i.d(t,{lR:()=>F,EL:()=>X,bb:()=>q,n6:()=>G});var s=i(83531),n=i(23988),o=i(10334),r=i(17171),a=i(89606),l=i(10047),d=i(83293),c=i(30040),h=i(63336),u=i(96797),p=i(21296),_=i(5574),g=i(16781),m=i(37560),f=i(63724),v=i(5692),y=i(85076),b=i(6987),w=i(7323),S=i(21216),x=i(19711),T=i(95168),k=i(15491),E=i(44297),P=i(29052),C=i(77396),D=i(86562),A=i(10117),U=i(58889),O=i(47370),M=i(28421),I=i(69063),N=i(21538);const B=["clientControls","blockedClients"];var F,L=i(98969),R=i(58687),j=i(58434),H=i(37107),W=i(40464);!function(e){e.CannotUseEditorError="CannotUseEditorError",e.UnknownNetworkError="UnknownNetworkError",e.UnauthorizedError="UserUnauthorizedError",e.UnknownClientError="UnknownClientError",e.UnknownServerError="UnknownServerError"}(F||(F={})),(F||(F={})).fromAjaxErr=function(e){return e instanceof _.GI?F.UnknownNetworkError:401===e.code||403===e.code?F.UnauthorizedError:e.code>=400||e.code<500?F.UnknownClientError:F.UnknownServerError};const G=v.j.defaultValue();var q,V;!function(e){e.sharedCodec=u.E$([j.x.sharedCodec,u.NW({clientControls:j.kz.codec})])}(q||(q={})),function(e){e.parseUserProfileJSON=function(e,t,i,s,n,a){var l;const d=new Set(e.groups.filter(Boolean)),c="Free"===e.type?R.ut.free:"Premium"===e.type?R.ut.premium:(()=>{throw new Error(`Unknown user type ${e.type}`)})();var u;return{userProfile:{isPaymentSandbox:Boolean(Boolean(e.customFields)&&e.customFields["sandbox.payments"]),id:e.id,confirmed:e.confirmed,email:e.email,newEmail:e.newEmail,fullName:e.name,isTest:e.isTest||!1,canUseEditor:"Premium"===e.type||e.freemium||!1,groups:d,type:c,role:(0,h.pipe)(e.customFields.frontend_role,E.fromNullable),roles:(0,h.pipe)(null!==(u=null===(l=e)||void 0===l?void 0:l.roles)&&void 0!==u?u:[]),loginType:e.loginType,registrationDate:(0,h.pipe)(e.registrationDate,E.fromNullable,E.map((e=>new Date(e)))),editorFeatures:e.editorFeatures,institutionInfo:(0,h.pipe)(E.fromNullable(e.institutionInfo),E.map((e=>(0,r._)((0,o._)({},e),{trueUpSchedule:n}))))},subscription:W.n6,settings:t,experiments:i,clientControls:s,entitlements:(0,h.pipe)(a,E.map(L.b.fromPassport))}}}(V||(V={}));class z extends _.Hl{constructor(){super({code:403,status:"error",message:"User is anonymous"})}}class Z extends _.Hl{constructor(){super({code:0,status:"error",message:"User cannot use editor"})}}class X{navigateToSigninOrRefresh(){return(0,h.pipe)(this._getUserSession(),P.AU((()=>d.fromIO((()=>{this._environment.actions.showSigninView()}))),(()=>d.fromIO((()=>this._environment.actions.refresh())))))}ensureAuthenticated(){return v.j.isIdle(this._state.get())?(this._state.modify(v.j.begin),(0,h.pipe)(this._getUserSession(),C.qI((e=>(setTimeout((()=>{this._onAuthenticated(e,this._logoutRD),this._state.modify(v.j.success(e))}),0),e.userProfile.canUseEditor?P.pG(void 0):P.kb(new Z)))),P.qE(this._handleAuthError))):P.pG(void 0)}_getUserMimicWithProps(){var e=this;return(0,s._)((function*(){try{const t=yield e._dapi.getMimicWithProps(yield e._telemetry.getContainerId());return yield e._validateExperimentGroups(Array.from(t.experiments)),t}catch(t){return e._log.warn("dapiError: Failed to get dapi props and mimic groups",t),{experiments:new Set,properties:f.OA.of({})}}}))}_getTrueUpSchedule(e){var t,i;const s=d.of(E.none),n=null===(t=e.roles)||void 0===t?void 0:t.map((e=>e.role)).includes(g.KJ.InstitutionRoleName.Admin);return"BUSINESS"!==(null===(i=e.institutionInfo)||void 0===i?void 0:i.organizationType)||!0!==n?s:(0,h.pipe)((()=>this._institution.getTrueUpSchedule()),P.Gg,P.cy((e=>P.pG({isTrueUpEligible:e.isEligible,overageSeats:e.overageSeats,nextTrueUpBillingDate:e.nextTrueUpBillingDate}))),P.qE((e=>this._log.warn("get true up data error: Failed to get true up data",e))),P.AU((0,c.constant)(s),(0,c.flow)(E.some,d.of)))}_getClientControls(e){const t=d.of(E.none);return Boolean(e.institutionInfo)?(0,h.pipe)(this._settingsRegistry.getMergedSettings({settings:B}),P.qE((e=>this._log.warn("client controls error: Failed to get client controls config",e))),P.AU((0,c.constant)(t),(0,c.flow)(E.map(N.q),d.of))):t}_getUserSession(){let e=1;const t=y.l(this._authApi.getUser(["sandbox.payments","frontend_role"]),[p.limitRetries(5),p.exponentialBackoff(5e3)],(t=>{this._log.error("authError: getUser failed",t,{attempt:e++});const i=F.fromAjaxErr(t);switch(i){case F.CannotUseEditorError:case F.UnauthorizedError:return!1;case F.UnknownNetworkError:case F.UnknownClientError:case F.UnknownServerError:return!0;default:return(0,D.xb)(i)}}));return(0,h.pipe)(t,b.n(A.AU({onInProgress:()=>w.t,onSuccess:e=>S.of(U.right(e)),onError:()=>w.t,onFatal:e=>S.of(U.left(e))})),x.$(),(e=>()=>e.toPromise()),P.Pm((e=>!e.anonymous),(()=>new z)),P.cy((e=>(0,h.pipe)(a.C(d.ApplicativePar)(this._getUserMimicWithProps(),this._getTrueUpSchedule(e),this._getClientControls(e),this._getTreatments,this._getPassport),P.M1,P.Tj((([t,i,s,,n])=>({trueUpSchedule:i,authData:e,dapiData:t,clientControls:s,passport:n})))))),P.Tj((({authData:e,dapiData:t,clientControls:i,trueUpSchedule:s,passport:n})=>{const o=H.tl.parse(t.properties,H.Zb.read(e.id));return(0,h.pipe)(H.tl.serialize(o),U.fold((()=>{this._log.warn("_getUserSession: Cannot serialize user settings",o)}),(t=>H.Zb.write(e.id,t)))),V.parseUserProfileJSON(e,o,t.experiments,i,s,n)})))}_validateExperimentGroups(e){var t=this;return(0,s._)((function*(){try{const i=yield t._cookies.safeGetValue("experiment_groups");void 0===i?t._expLog.warn("'experiment_groups' has empty value",{groupsFromDapiResponse:e}):l.nZ(O.kK).equals(e,i.split("|"))||t._expLog.warn("'experiment_groups' and DAPI groups are unequal",{groupsFromDapiResponse:e,groupsFromCookies:i})}catch(e){t._expLog.warn("can not read 'experiment_groups' cookie",e)}}))()}constructor(e,t,i,s,o,r,a,l,u,g,f,b){(0,n._)(this,"_state",void 0),(0,n._)(this,"_authApi",void 0),(0,n._)(this,"_dapi",void 0),(0,n._)(this,"_institution",void 0),(0,n._)(this,"_experimentClient",void 0),(0,n._)(this,"_settingsRegistry",void 0),(0,n._)(this,"_passportClient",void 0),(0,n._)(this,"_onAuthenticated",void 0),(0,n._)(this,"_telemetry",void 0),(0,n._)(this,"_cookies",void 0),(0,n._)(this,"_environment",void 0),(0,n._)(this,"_onAuthError",void 0),(0,n._)(this,"_log",void 0),(0,n._)(this,"status",void 0),(0,n._)(this,"_handleAuthError",void 0),(0,n._)(this,"_getTreatments",void 0),(0,n._)(this,"_getPassport",void 0),(0,n._)(this,"_logoutRD",void 0),(0,n._)(this,"_expLog",void 0),this._state=e,this._authApi=t,this._dapi=i,this._institution=s,this._experimentClient=o,this._settingsRegistry=r,this._passportClient=a,this._onAuthenticated=l,this._telemetry=u,this._cookies=g,this._environment=f,this._onAuthError=b,this._log=I.Bx.Logging.getLogger("model.authentication"),this.status=this._state.view((e=>v.j.map(e,(e=>e)))),this._handleAuthError=e=>{this._onAuthError();const t=e instanceof Z?F.CannotUseEditorError:F.fromAjaxErr(e);switch(t){case F.CannotUseEditorError:this._log.info("authError: Cannot use editor",e,t),this._state.modify(v.j.error(t));break;case F.UnauthorizedError:this._log.warn("authError: Bad user session",e,t),this._state.modify(v.j.error(t));break;case F.UnknownNetworkError:case F.UnknownClientError:case F.UnknownServerError:this._log.fatal("authError: Failed to get user session",e,t),this._state.modify(v.j.fatal(t));break;default:return(0,D.xb)(t)}return t},this._getTreatments=()=>this._experimentClient.fetchTreatments().catch((e=>{this._log.warn("Failed to fetch treatments",e)})),this._getPassport=(0,h.pipe)(P.TX((()=>this._passportClient.getPassport([m.t.Feature.BrandingSet])),U.toError),P.AU((e=>(this._log.warn("Failed to get a passport",e),d.of(E.none))),(0,c.flow)(E.some,d.of))),this._logoutRD=(0,h.pipe)(y.l(this._authApi.logout(),[p.limitRetries(5),p.exponentialBackoff(5e3)],K),T.M((e=>{this._log.info("logout state change",e),M.oJ(e)?(0,h.pipe)(this._environment.actions.afterLogout(),U.mapLeft((e=>this._log.error("env error during logout",e)))):M.BG(e)&&(e.error instanceof _.Hl&&401===e.error.code?this._environment.actions.exit("missing user session"):this._log.error("Logout error",e.error))})),k.T(A.qE(F.fromAjaxErr))),this._expLog=this._log.getLogger("validate_experiments");const w=this._state.get();v.j.isOk(w)&&this._getTreatments().finally((()=>this._onAuthenticated(w.value,this._logoutRD)))}}function K(e){const t=F.fromAjaxErr(e);return t===F.UnknownNetworkError||t===F.UnknownServerError}},97015:(e,t,i)=>{i.d(t,{Ah:()=>n,DJ:()=>r,Ps:()=>H,RO:()=>o,S:()=>a,VF:()=>z,Wq:()=>s,Wy:()=>l,fN:()=>j,q8:()=>R});var s,n,o,r,a,l,d=i(23988),c=i(10334),h=i(17171),u=i(64514),p=i(30040),_=i(63336),g=i(80074),m=i(47961),f=i(68594),v=i(40027),y=i(95168),b=i(6987),w=i(60269),S=i(83541),x=i(62822),T=i(80837),k=i(86562),E=i(47370),P=i(44297),C=i(34717),D=i(23121),A=i(58889),U=i(36840),O=i(69063),M=i(74056),I=i(40884),N=i(14650),B=i(37107);!function(e){e.is=e=>B.tl.extensionBanners.some((t=>t===e))}(s||(s={})),function(e){e.is=e=>o.is(e)||r.isPopup(e)}(n||(n={})),function(e){e.popups=B.tl.extensionAppPopups,e.is=e=>B.tl.extensionAppPopups.some((t=>t===e))}(o||(o={})),function(e){e.popups=B.tl.extensionAutoCitationsPopups,e.isBanner=e=>B.tl.extensionAutoCitationsBanners.some((t=>t===e)),e.isPopup=e=>B.tl.extensionAutoCitationsPopups.some((t=>t===e))}(r||(r={})),function(e){e.is=e=>B.tl.llamaBanners.some((t=>t===e)),e.isMac=e=>"llama-mac-download-banner"===e}(a||(a={})),function(e){e.is=e=>B.tl.llamaPopups.some((t=>t===e)),e.isMac=e=>"llama-mac-download-popup"===e}(l||(l={}));const F={active:null};function L(e){switch(e){case N.X.App.extensionChrome:return"chrome-popup";case N.X.App.extensionFirefox:return"firefox-popup";case N.X.App.extensionSafari:return"safari-popup";case N.X.App.extensionEdge:return"edge-popup";case N.X.App.extensionEdgeChromium:return"edge-chromium-popup";case N.X.App.desktopMac:return"llama-mac-download-popup";case N.X.App.desktopWindows:return"llama-windows-download-popup";default:return(0,k.xb)(e)}}function R(e){switch(e){case"llama-mac-download-popup":return N.X.App.desktopMac;case"llama-windows-download-popup":return N.X.App.desktopWindows;default:return(0,k.xb)(e)}}function j(e){switch(e){case"chrome-popup":return N.X.App.extensionChrome;case"safari-popup":return N.X.App.extensionSafari;case"firefox-popup":return N.X.App.extensionFirefox;case"edge-popup":case"edge-chromium-popup":return N.X.App.extensionEdge;case"chrome-autoCitations-popup":return"chrome-autoCitations-popup";case"safari-autoCitations-popup":case"firefox-autoCitations-popup":return"safari-autoCitations-popup";case"edge-chromium-autoCitations-popup":return"edge-chromium-autoCitations-popup";default:return(0,k.xb)(e)}}function H(e){switch(e){case"true-up":return"gbTrueUpReminder";case"llama-mac-download-banner":return N.X.App.desktopMac;case"llama-windows-download-banner":return N.X.App.desktopWindows;case"chrome-extension":return N.X.App.extensionChrome;case"firefox-extension":return N.X.App.extensionFirefox;case"safari-extension":return N.X.App.extensionSafari;case"edge-extension":case"edge-chromium-extension":return N.X.App.extensionEdge;case"mobile-keyboard":return N.X.App.mobileKeyboard;case"campaign-end":return"campaignEnd";case"proofit-cancelled":return"proofitCancel";case"proofit-completed":return"proofitComplete";case"invite-members":return"inviteMembers";case"style-guide":return"styleGuide";case"chrome-autoCitations":return"chrome-autoCitations";case"edge-chromium-autoCitations":return"edge-chromium-autoCitations";case"safari-autoCitations":return"safari-autoCitations";case"firefox-autoCitations":return"firefox-autoCitations";case"de-deprecation-banner":return"deDeprecationBanner";case"de-deprecation-popup":return"deDeprecationPopup";case"desktop-mac":return"desktopMac";case"desktop-windows":return"desktopWindows";default:return(0,k.xb)(e)}}var W,G,q,V;(G=W||(W={})).eq=E.OW({type:E.kK,expire:E.US}),G.has=e=>t=>Array.from(t.values()).some((t=>W.eq.equals(t,e))),function(e){e.empty=()=>({dismiss:new Set,shown:new Set,later:new Set,cancelled:new Set}),e.show={show:e=>{const t=JSON.stringify({dismiss:Array.from(e.dismiss),shown:Array.from(e.shown),later:Array.from(e.later),cancelled:Array.from(e.cancelled)});return`length: ${t.length}\n${t}`}}}(q||(q={})),function(e){function t(e){return(0,_.pipe)(e.llamaDiscoverabilityType,P.toUndefined)}function i(e){return N.X.isNotInstalled(e)?function(e){switch(e){case N.X.App.extensionChrome:return"chrome-extension";case N.X.App.extensionFirefox:return"firefox-extension";case N.X.App.extensionSafari:return"safari-extension";case N.X.App.extensionEdge:return"edge-extension";case N.X.App.extensionEdgeChromium:return"edge-chromium-extension";case N.X.App.mobileKeyboard:return"mobile-keyboard";case N.X.App.iOS:case N.X.App.android:case N.X.App.desktopMac:case N.X.App.desktopWindows:return null;default:return(0,k.xb)(e)}}(e.name):null}function s(e){return t=>null===t||e.dismiss.has(t)||(0,_.pipe)(e.later,u.zN((e=>e.type===t)))?null:t}function n(e){return t=>{switch(t){case"chrome-extension":case"chrome-popup":case"chrome-autoCitations":case"chrome-autoCitations-popup":return e.includes(N.X.App.extensionChrome)?null:t;case"safari-extension":case"safari-popup":case"safari-autoCitations":case"safari-autoCitations-popup":return e.includes(N.X.App.extensionSafari)?null:t;case"edge-chromium-extension":case"edge-chromium-popup":case"edge-chromium-autoCitations":case"edge-chromium-autoCitations-popup":return e.includes(N.X.App.extensionEdgeChromium)?null:t;case"edge-extension":case"edge-popup":return e.includes(N.X.App.extensionEdge)?null:t;case"firefox-extension":case"firefox-popup":case"firefox-autoCitations":case"firefox-autoCitations-popup":return e.includes(N.X.App.extensionFirefox)?null:t;case"mobile-keyboard":return e.includes(N.X.App.iOS)||e.includes(N.X.App.android)?null:t;default:return t}}}e.getActiveBanner=function(e,o,r){const a=o.desktopApp.state===M.OH.ClientState.INSTALLED&&r.showAutoCitationsBannerPromotion&&(m=o.extension,N.X.isNotInstalled(m)?function(e){switch(e){case N.X.App.extensionChrome:return"chrome-autoCitations";case N.X.App.extensionFirefox:return"firefox-autoCitations";case N.X.App.extensionSafari:return"safari-autoCitations";case N.X.App.extensionEdgeChromium:return"edge-chromium-autoCitations";case N.X.App.extensionEdge:default:return null}}(m.name):null),l=N.X.isSupported(o.desktopApp)&&N.X.App.isLlama(o.desktopApp.name)&&t(r)===I.d6.Banner&&(o.desktopApp.name===N.X.App.desktopWindows?"llama-windows-download-banner":"llama-mac-download-banner"),d=P.isNone(r.llamaDiscoverabilityType)&&r.showAppBanners&&(0,_.pipe)(i(o.extension),s(e),n(o.blockedApps)),c=r.showAppBanners&&(0,_.pipe)(i(o.desktopApp),s(e),n(o.blockedApps)),h=r.showInviteMembersBanner&&(0,_.pipe)("invite-members",s(e)),u=r.showStyleGuideBanner&&(0,_.pipe)("style-guide",s(e)),p=r.showAppBanners&&(0,_.pipe)(i(o.iOS),s(e),n(o.blockedApps))&&(0,_.pipe)(i(o.android),s(e),n(o.blockedApps)),g=r.showTrueUpBanner&&(0,_.pipe)("true-up",s(e));var m;return h||u||l||a||d||c||p||g||null},e.getActivePopup=function(e,i,o){return(0,_.pipe)(function(e,i){const{extension:s,desktopApp:n}=e;return N.X.isSupported(n)&&N.X.App.isLlama(n.name)&&t(i)===I.d6.Modal?L(n.name):i.extensionInstallPromotion&&i.showAppBanners&&N.X.isNotInstalled(s)&&N.X.App.isExtension(s.name)?L(s.name):Boolean(i.showAutoCitationsPopupPromotion)&&s.state===M.OH.ClientState.INSTALLED&&N.X.App.isExtension(s.name)?function(e){switch(e){case N.X.App.extensionChrome:return"chrome-autoCitations-popup";case N.X.App.extensionFirefox:return"firefox-autoCitations-popup";case N.X.App.extensionSafari:return"safari-autoCitations-popup";case N.X.App.extensionEdgeChromium:return"edge-chromium-autoCitations-popup";case N.X.App.extensionEdge:return null;default:return(0,k.xb)(e)}}(s.name):null}(i,o),function(e){return t=>null===t||e.shown.has(t)?null:t}(e),s(e),n(i.blockedApps))}}(V||(V={}));class z{get bannerFeatures(){return(0,_.pipe)(this._features,P.getOrElse((()=>I.LU.empty)))}_updateLaterBanners(e){const{later:t}=e,i=Date.now(),s=(0,_.pipe)(t,u.pb((e=>i<=e.expire)));s.size!==t.size&&(e=(0,h._)((0,c._)({},e),{later:s}));const n=(0,c._)({},q.empty(),e);if(B.tl.bannersType.is(n))return this._banners.set(n),n;{this._log.error("Initialized with corrupt banner type, resetting banners",{parsedBanners:n,banners:m.OA.of(n)});const e=q.empty();return this._updateBanners(e),e}}_getActiveBanner(){return V.getActiveBanner(this._banners.get(),this._clientsState,this.bannerFeatures)}_getActivePopup(){return V.getActivePopup(this._banners.get(),this._clientsState,this.bannerFeatures)}_getAppsPopupsToMarkAsShown(){return B.tl.extensionAppPopups.filter((e=>!this.getBannerState(e).includes("shown")))}_markPopupsShown(e,t){e.length>0&&this._updateBanners({shown:new Set([...Array.from(t.shown),...e])})}_getAutoCitationsPopupsToMarkShown(){const e=this.state.get().active;return e&&B.tl.isExtensionAutoCitationsPopup(e)?B.tl.extensionAutoCitationsPopups.filter((e=>!this.getBannerState(e).includes("shown"))):[]}remind(e){this.getBannerState(e).includes("cancelled")?this.dismiss(e):(this._cancel(e),this._remind(e,C.ei))}cancel(e){this.remind(e)}install(e){s.is(e)||n.is(e)?this._extension.install().then((e=>e&&this.state.set(F))):this.state.set(F)}dispose(){this._subs.dispose()}_resetState(){this.state.set(F)}_updateBanners(e){this._banners.modify((t=>(0,c._)({},t,e)))}constructor(e,t,i,s){(0,d._)(this,"_clientsState",void 0),(0,d._)(this,"_extension",void 0),(0,d._)(this,"_features",void 0),(0,d._)(this,"state",void 0),(0,d._)(this,"_log",void 0),(0,d._)(this,"_subs",void 0),(0,d._)(this,"initialize",void 0),(0,d._)(this,"_banners",void 0),(0,d._)(this,"dismiss",void 0),(0,d._)(this,"shown",void 0),(0,d._)(this,"getBannerState",void 0),(0,d._)(this,"_cancel",void 0),(0,d._)(this,"_remind",void 0),(0,d._)(this,"_addBanner",void 0),this._clientsState=e,this._extension=t,this._features=i,this.state=g.s.create(F),this._log=O.Bx.Logging.getLogger("BannersModel"),this._subs=new T.y.Keeper,this.initialize=e=>{const t=this._updateLaterBanners(e);var i;this.state.set({active:null!==(i=this._getActivePopup())&&void 0!==i?i:this._getActiveBanner()}),this._markPopupsShown([...this._getAppsPopupsToMarkAsShown(),...this._getAutoCitationsPopupsToMarkShown()],t)},this._banners=g.s.create(q.empty()),this.dismiss=e=>{this._addBanner({type:"dismiss",banner:e}),this._resetState()},this.shown=e=>{this._addBanner({type:"shown",banner:e})},this.getBannerState=e=>{const t=this._banners.get();return(0,_.pipe)(D.zb((()=>Object.keys(t).filter((i=>"later"===i?(0,_.pipe)(t[i],u.zN((t=>t.type===e))):t[i].has(e))))),A.fold((i=>(this._log.error("Failed to get banner state",{name:i.name,message:i.message,banners:m.OA.of(t),parsedBanners:t,banner:e}),[])),p.identity))},this._cancel=e=>{this._addBanner({type:"cancelled",banner:e}),this._resetState()},this._remind=(e,t)=>{this._addBanner({type:"later",lateBanner:{type:e,expire:Date.now()+t}}),this._resetState()},this._addBanner=e=>{const t=this._banners.get();switch(e.type){case"shown":case"cancelled":const i=t[e.type];if(i.has(e.banner))return;this._updateBanners({[e.type]:new Set([...Array.from(i),e.banner])});break;case"later":this._updateBanners({later:new Set([...Array.from(t.later),e.lateBanner])});break;case"dismiss":this._updateBanners({dismiss:new Set([...Array.from(t.dismiss),e.banner])});break;default:(0,k.xb)(e)}},this._banners.pipe(f.i(1),v.Z(100)).subscribe(s),(0,U.hJ)("resetBanners",(()=>{this._updateBanners(q.empty())})),(0,U.hJ)("remindBanner",((e,t)=>{this._remind(e,t)})),(0,U.hJ)("listBanners",(()=>{console.debug(JSON.stringify(this._banners.get(),null,2))})),this._subs.push(this._banners.pipe(y.M((e=>this._log.debug("Banners updated",{banners:q.show.show(e)}))),b.n((e=>w.h(...Array.from(e.later).map((e=>S.timer(e.expire-Date.now()).pipe(x.u(e.type))))).pipe(y.M((t=>{this._log.debug("Showing banner scheduled for later",t),this.state.set({active:t}),this._updateLaterBanners(e)})))))).subscribe())}}},21538:(e,t,i)=>{i.d(t,{O:()=>s,q:()=>d});var s,n=i(10334),o=i(17171),r=i(96797),a=i(97772);!function(e){e.codec=r.NW({dlpEnabled:r.zM,docsDisabled:r.zM,dlpConfiguration:a.fW.codec,clients:r.YO(r.NW({client:r.Yj,blocked:r.zM}))})}(s||(s={}));const l="editor";function d(e){var t;if(!e.clientControls.clientControlsEnabled)return(0,o._)((0,n._)({},e.clientControls),{dlpEnabled:!1,docsDisabled:!1,dlpConfiguration:a.Wm,clients:[]});const i=(null===(t=e.blockedClients)||void 0===t?void 0:t.blockedClients.map((e=>({client:e.client,blocked:e.enabled}))))||[],s=i.some((e=>e.client===l&&e.blocked));return(0,o._)((0,n._)({},e.clientControls),{dlpEnabled:e.clientControls.dlpEnabled,dlpConfiguration:e.clientControls.dlpConfiguration,docsDisabled:s,clients:i})}},14650:(e,t,i)=>{i.d(t,{X:()=>s});var s,n=i(23988),o=i(63336),r=i(44297),a=i(74056),l=i(58687);!function(e){let t;var i;!function(e){e.desktopMac="macDesktop",e.desktopWindows="winDesktop",e.extensionChrome="chromeExt",e.extensionFirefox="firefoxExt",e.extensionSafari="safariExt",e.extensionEdge="edgeExt",e.extensionEdgeChromium="edgeChromiumExt",e.iOS="iOS",e.android="android",e.mobileKeyboard="mobileKeyboard"}(t=e.App||(e.App={})),(i=t=e.App||(e.App={})).isExtension=e=>[t.extensionChrome,t.extensionFirefox,t.extensionSafari,t.extensionEdge,t.extensionEdgeChromium].some((t=>t===e)),i.isLlama=e=>[t.desktopMac,t.desktopWindows].some((t=>t===e)),i.isExternalDownloadSource=e=>[t.iOS,t.android].some((t=>t===e)),e.isSupported=function(e){return e.state!==a.OH.ClientState.NOT_SUPPORTED},e.isNotInstalled=function(e){return e.state===a.OH.ClientState.NOT_INSTALLED};var d=e.unsupported={state:a.OH.ClientState.NOT_SUPPORTED};e.Impl=class{getAsArray(){return this._defaultSupportedArray.filter(s.isSupported).filter((e=>!Boolean(this.blockedApps.includes(e.name))))}_getExtensionName(e){switch(e){case"chrome":return t.extensionChrome;case"firefox":return t.extensionFirefox;case"safari":return t.extensionSafari;case"edge":return Number(this._environment.info.version)>18?t.extensionEdgeChromium:t.extensionEdge;default:throw new Error("unsupported browser "+e)}}constructor(e,i){(0,n._)(this,"_environment",void 0),(0,n._)(this,"_userProfile",void 0),(0,n._)(this,"_isWin",void 0),(0,n._)(this,"_isMac",void 0),(0,n._)(this,"_getDesktopAppMac",void 0),(0,n._)(this,"_getDesktopAppWindows",void 0),(0,n._)(this,"extension",void 0),(0,n._)(this,"desktopApp",void 0),(0,n._)(this,"iOS",void 0),(0,n._)(this,"android",void 0),(0,n._)(this,"_defaultSupportedArray",void 0),(0,n._)(this,"blockedApps",void 0),(0,n._)(this,"supportedApps",void 0),(0,n._)(this,"isEditorBlocked",void 0),this._environment=e,this._userProfile=i,this._isWin="windows"===this._environment.info.os,this._isMac="mac"===this._environment.info.os,this._getDesktopAppMac=()=>({name:t.desktopMac,state:this._userProfile.profile.view((({groups:e})=>e.has(l.yD.DESKTOP_APP_INSTALLED_MAC))).get()?a.OH.ClientState.INSTALLED:a.OH.ClientState.NOT_INSTALLED}),this._getDesktopAppWindows=()=>({name:t.desktopWindows,state:this._userProfile.profile.view((({groups:e})=>e.has(l.yD.DESKTOP_APP_INSTALLED_WINDOWS))).get()?a.OH.ClientState.INSTALLED:a.OH.ClientState.NOT_INSTALLED}),this.extension=this._environment.extension===a.OH.ClientState.NOT_SUPPORTED?d:{name:this._getExtensionName(this._environment.info.browser),state:this._environment.extension},this.desktopApp=this._isWin?this._getDesktopAppWindows():this._isMac?this._getDesktopAppMac():d,this.iOS={name:t.iOS,state:this._userProfile.profile.view((({groups:e})=>e.has(l.yD.MOBILE_IOS_INSTALLED))).get()?a.OH.ClientState.INSTALLED:a.OH.ClientState.NOT_INSTALLED},this.android={name:t.android,state:this._userProfile.profile.view((({groups:e})=>e.has(l.yD.MOBILE_ANDROID_INSTALLED))).get()?a.OH.ClientState.INSTALLED:a.OH.ClientState.NOT_INSTALLED},this._defaultSupportedArray=[this.desktopApp,this.extension,this.iOS,this.android],this.blockedApps=(0,o.pipe)(this._userProfile.clientControls,r.fold((()=>[]),(({clients:e})=>e.filter((e=>e.blocked)).map((e=>{switch(e.client){case"extensionChrome":return s.App.extensionChrome;case"extensionEdge":return s.App.extensionEdgeChromium;case"extensionFirefox":return s.App.extensionFirefox;case"macExtension":return s.App.desktopMac;case"windowsExtension":return s.App.desktopWindows;case"IOS_NATIVE_EDITOR":return s.App.iOS;case"MOBILE_ANDROID":return s.App.android;default:return}})).filter((e=>void 0!==e))))),this.supportedApps=this.getAsArray().map((({name:e,state:t})=>({app:e,installed:t===a.OH.ClientState.INSTALLED}))),this.isEditorBlocked=(0,o.pipe)(this._userProfile.clientControls,r.fold((()=>!1),(({docsDisabled:e})=>e)))}},e.Mock=class{getAsArray(){return[this.desktopApp,this.extension,this.iOS,this.android]}constructor(e={name:t.desktopMac,state:a.OH.ClientState.NOT_INSTALLED},i={name:t.extensionChrome,state:a.OH.ClientState.NOT_INSTALLED},o={name:t.android,state:a.OH.ClientState.NOT_INSTALLED},r={name:t.iOS,state:a.OH.ClientState.NOT_INSTALLED}){(0,n._)(this,"desktopApp",void 0),(0,n._)(this,"extension",void 0),(0,n._)(this,"android",void 0),(0,n._)(this,"iOS",void 0),(0,n._)(this,"supportedApps",void 0),(0,n._)(this,"blockedApps",void 0),(0,n._)(this,"isEditorBlocked",void 0),this.desktopApp=e,this.extension=i,this.android=o,this.iOS=r,this.supportedApps=this.getAsArray().filter(s.isSupported).map((({name:e,state:t})=>({app:e,installed:t===a.OH.ClientState.INSTALLED}))),this.blockedApps=[],this.isEditorBlocked=!1}}}(s||(s={}))},78018:(e,t,i)=>{i.d(t,{$G:()=>L,Pm:()=>j,l1:()=>V,n6:()=>W,rv:()=>K});var s=i(83531),n=i(23988),o=i(10334),r=i(17171),a=i(63336),l=i(21296),d=i(80074),c=i(5574),h=i(9890),u=i(77890),p=i(95074),_=i(10821),g=i(5692),m=i(42543),f=i(21662),v=i(78339),y=i(36735),b=i(6987),w=i(54988),S=i(60269),x=i(15491),T=i(58347),k=i(8433),E=i(19711),P=i(36094),C=i(95168),D=i(86562),A=i(44297),U=i(36840),O=i(59592),M=i(29052),I=i(77396),N=i(69063),B=i(81870),F=i(36257);const L=["doc","docx","odt","rtf","htm","html","txt"].map((e=>"."+e));var R;!function(e){e.doc="application/msword",e.docx="application/vnd.openxmlformats-officedocument.wordprocessingml.document",e.odt="application/vnd.oasis.opendocument.text",e.rtf="text/rtf",e.html="text/html",e.txt="text/plain"}(R||(R={}));const j=[R.doc,R.docx,R.odt,R.rtf,R.html,R.txt];var H;!function(e){e.empty={soft:[],hard:[]}}(H||(H={}));const W={searchText:"",wsConnection:g.j.defaultValue(),proofitResults:{},deletedDocumentIds:H.empty,first100:g.j.defaultValue(),remoteSearch:g.j.defaultValue(),documentKind:F.j.Kind.existing},G=100,q=new Date(15653592e5);var V;!function(e){let t;!function(e){e.compatibility="compatibility",e.on="on",e.off="off"}(t=e.FormattingMode||(e.FormattingMode={})),e.fromDocument=(e,t)=>({id:e.id,rtfMode:i(e.originalFilename,e.createdAt,t)});var i=e.getFormattingMode=(e,t,i)=>i.rtf?"string"==typeof e&&null!==t&&t>q?V.FormattingMode.compatibility:V.FormattingMode.on:V.FormattingMode.off}(V||(V={}));class z{init(){(0,D.V1)(null===this._operation,"Expect operation to be not established"),this._operation=g.j.OperationRetrier.create((()=>this._connect()),this.wsConnection)}reset(){const e=this.wsConnection.get();g.j.isOk(e)?this._terminate(e.value):this._operation&&this._operation.unsubscribe(),this._operation=null,this.wsConnection.set(W.wsConnection)}_connect(){return this._doxApi.openDocumentsList({metadataChangeHandler:(e,t)=>{(0,a.pipe)(t.proofit,A.fold(U.Yi,(t=>{this.results.modify((i=>Object.assign({},i,{[e]:t}))),t.status===_.c.JobStatus.cancelled&&this.cancelled.next({id:e})})))}}).then((e=>({unsubscribe:e.remoteConnection.close.bind(e.remoteConnection)})))}_terminate(e){var t=this;return(0,s._)((function*(){try{t.results.set(W.proofitResults),t.cancelled.next({id:null}),yield e.unsubscribe()}catch(e){throw t._log.error("Failed to close dox session",e),e}}))()}constructor(e,t){(0,n._)(this,"_doxApi",void 0),(0,n._)(this,"_state",void 0),(0,n._)(this,"_log",void 0),(0,n._)(this,"_operation",void 0),(0,n._)(this,"results",void 0),(0,n._)(this,"cancelled",void 0),(0,n._)(this,"wsConnection",void 0),this._doxApi=e,this._state=t,this._log=N.Bx.Logging.getLogger("model.documents.proofit"),this._operation=null,this.results=this._state.lens("proofitResults"),this.cancelled=new m.B7,this.wsConnection=this._state.lens("wsConnection")}}class Z{_reset(){this.searchText.set(W.searchText),this._isLocalSearch.set(!1),this._remoteSearch.set(g.j.defaultValue()),this._first100.set(g.j.defaultValue()),this.deletedDocumentIds.set(H.empty)}_loadDocuments(e,t){const i=d.s.create(!1);this._documentSubs=[g.j.OperationRetrier.create((()=>this._documentKind.get()===F.j.Kind.existing?this._doxApi.listDocuments(G,p.R1.OrderBy.Updated,!this._settings.firstCall.get(),p.R1.DocumentFilter.all,e,t):this._doxApi.listDeleted(G,p.R1.OrderBy.Updated,e,t)),this._first100,g.j.OperationRetrier.RetryStrategy.conditional(this._retryWhen,g.j.OperationRetrier.RetryStrategy.linear(3,3e3))),this._trimmedSearchText.pipe(f.E(this._first100,i),v.p((([e])=>!e)),y.c(1e3),v.p((([e,t,i])=>g.j.isTerminated(t)&&!i))).subscribe((()=>{i.set(!0),(this._documentKind.get()===F.j.Kind.deleted?this._doxApi.listDeleted(G,p.R1.OrderBy.Updated,e,t):this._doxApi.listDocuments(G,p.R1.OrderBy.Updated,!1,p.R1.DocumentFilter.all,e,t)).then((e=>this._first100.set(g.j.ok(e)))).catch((e=>{e instanceof c.Hl&&this._handleHttpDoxError(e,"Failed to refresh document list"),this._log.info("Failed to refresh document list",e)})).then((()=>{i.set(!1)}))})),this._isLocalSearch.pipe(b.n((e=>e?w.w:S.h(this._trimmedSearchText.pipe(x.T((e=>O.u.left(e)))),this._trimmedSearchText.pipe(T.B(500),x.T((e=>O.u.right(e))))).pipe(b.n((e=>(this._remoteSearch.set(g.j.defaultValue()),O.u.isLeft(e)||!e.value?w.w:k.v((()=>g.j.OperationRetrier.create((()=>this._doxApi.searchDocument(p.Jo.Search.contains(e.value),G,p.R1.OrderBy.Any,this._documentKind.get()===F.j.Kind.deleted?p.R1.DocumentFilter.trash:p.R1.DocumentFilter.all)),this._remoteSearch,g.j.OperationRetrier.RetryStrategy.conditional(this._retryWhen,g.j.OperationRetrier.RetryStrategy.linear(3,3e3)))),(()=>this._remoteSearch.pipe(v.p(g.j.isTerminated),E.$())))))))))).subscribe()]}_localSearch(e,t,i,s){const n=new RegExp(s.replace(/[-\/\\^$*+?.()|[\]{}]/g,"\\$&"),"i");return t.concat(e.filter((e=>!s||n.test(e.firstContent)||n.test(e.title))).filter((e=>-1===t.findIndex((t=>t.id===e.id))))).filter((e=>!i.includes(e.id)))}constructor(e,t,i,s,o){(0,n._)(this,"_state",void 0),(0,n._)(this,"_doxApi",void 0),(0,n._)(this,"_settings",void 0),(0,n._)(this,"_connectivity",void 0),(0,n._)(this,"_handleHttpDoxError",void 0),(0,n._)(this,"_log",void 0),(0,n._)(this,"_isLocalSearch",void 0),(0,n._)(this,"_first100",void 0),(0,n._)(this,"_remoteSearch",void 0),(0,n._)(this,"_documentKind",void 0),(0,n._)(this,"deletedDocumentIds",void 0),(0,n._)(this,"load",void 0),(0,n._)(this,"reset",void 0),(0,n._)(this,"searchText",void 0),(0,n._)(this,"_trimmedSearchText",void 0),(0,n._)(this,"isFirstTimeLoaded",void 0),(0,n._)(this,"isSearching",void 0),(0,n._)(this,"searchResults",void 0),(0,n._)(this,"_retryWhen",void 0),(0,n._)(this,"_documentSubs",void 0),this._state=e,this._doxApi=t,this._settings=i,this._connectivity=s,this._handleHttpDoxError=o,this._log=N.Bx.Logging.getLogger("model.documents.list"),this._isLocalSearch=d.s.create(!1),this._first100=this._state.lens("first100"),this._remoteSearch=this._state.lens("remoteSearch"),this._documentKind=this._state.lens("documentKind"),this.deletedDocumentIds=this._state.lens("deletedDocumentIds"),this.load=(e,t)=>{this.reset(),this._loadDocuments(e,t)},this.reset=()=>{this._documentSubs.forEach((e=>e.unsubscribe())),this._documentSubs=[],this._reset()},this.searchText=this._state.lens("searchText"),this._trimmedSearchText=this.searchText.view((e=>e.trim())),this.isFirstTimeLoaded=this._first100.view(g.j.isOk),this.isSearching=this._remoteSearch.view((e=>g.j.isInProgress(e)||g.j.isError(e))),this.searchResults=d.s.combine(this._documentKind,this._first100,this._remoteSearch,this.deletedDocumentIds,this._trimmedSearchText,((e,t,i,s,n)=>g.j.flatMap(t,(t=>{const o=e===F.j.Kind.existing?s.soft:s.hard;return g.j.isTerminated(i)?g.j.flatMap(i,(e=>g.j.ok(this._localSearch(t,Boolean(e)?e:[],o,n)))):g.j.ok(this._localSearch(t,[],o,n))})))),this._retryWhen=e=>!(e instanceof c.Hl)||(0,D.z3)(e.code),this._documentSubs=[],this._settings.firstCall.get()||this._first100.pipe(v.p(g.j.isOk),E.$()).subscribe((()=>this._settings.firstCallDone())),this._first100.pipe(v.p((e=>g.j.isOk(e)))).subscribe((e=>this._isLocalSearch.set(e.value.length<G))),this.searchResults.pipe(v.p((e=>g.j.isError(e)||g.j.isFatal(e))),b.n(P._F.rafScheduler)).subscribe((e=>{g.j.isFatal(e)?(e.error instanceof c.Hl?this._handleHttpDoxError(e.error,"DOX: Cannot load document list"):this._connectivity.setState({type:"dox",state:{type:(0,D.z3)(e.error.code)?"serverError":"unknownConnectionError"}}),this._log.error("DOX: Cannot load document list",e.error)):g.j.isError(e)&&this._log.warn("DOX: Attempt to load document list failed",e.error,{attempt:e.attempt})}))}}class X{createDocument(e,t,i){const s=(0,a.pipe)(M.TX((()=>this._doxApi.createDocument(p.Jo.Create.textFull((0,r._)((0,o._)({},Boolean(e)?{doc:{ops:[{insert:e}]}}:{},i?{extra_params:i}:{}),{title:t})))),(e=>e)));let n=1;return(0,a.pipe)(s,(0,h.L5)([l.limitRetries(4),l.exponentialBackoff(1e3)],(e=>(this._log.error("DOX: createDocument error",e,{attempt:n++}),!0))),I.hq)}createDocumentAndNavigate(e){return this.createDocument().then((t=>{e.get()?this.navigateToDocument(t.id):this._editorTsNotifications.show(this._editorTsNotifications.create.newDocumentCreated((()=>this.navigateToDocument(t.id))))})).catch((e=>this.handleCreateDocumentError(e)))}deleteDocument(e){const{request:t,lens:i}=this._state.view("documentKind").get()===F.j.Kind.deleted?{request:this._doxApi.forceDelete(e),lens:this._deletedDocumentIds.lens("hard")}:{request:this._doxApi.deleteDocumentById(e),lens:this._deletedDocumentIds.lens("soft")};return i.modify((t=>t.concat([e]))),t.catch((t=>{throw i.modify((t=>t.filter((t=>t!==e)))),t}))}emptyBin(){return this._doxApi.emptyBin().then(this._reset)}downloadOriginal(e){return this._log.info("downloadOriginal.initiated"),(e.rtfMode===V.FormattingMode.on?this._doxApi.downloadInFormat(e.id,"docx"):this._doxApi.downloadOriginal(e.id)).then(u.F.saveToFS).catch(this.handleDownloadDocumentError)}downloadProofread(e,t,i=!1){var n=this;return(0,s._)((function*(){n._log.info("downloadProofread.initiated");try{yield n._doxApi.downloadProofread(e,i).then(u.F.saveToFS).then((()=>{t&&n._editorTsNotifications.show(t)}))}catch(e){n.handleDownloadDocumentError(e)}}))()}navigateToDocument(e){this._navigateToDocument(`${e}`)}handleCreateDocumentError(e){e instanceof c.Hl?(this._handleHttpDoxError(e,"Failed to create new document"),this._log.warn("Failed to create new document",e)):(0,D.eK)(e)?(this._log.warn("Failed to create new document",e),this._editorTsNotifications.showError(`Failed to create new document: ${Boolean(e)?e.message:e}`)):(this._log.error("Failed to create new document",e),this._editorTsNotifications.showError(`Failed to create new document: ${Boolean(e)?e.message:e}`))}handleDeleteDocumentError(e){this._handleError(e,`Failed to delete ${this._state.view("documentKind").get()} document`)}handleEmptyBinError(e){this._handleError(e,"Failed to empty trash")}handleRestoreError(e){this._handleError(e,"Failed to restore a document")}_handleError(e,t){e instanceof c.Hl&&(this._handleHttpDoxError(e,t),this._log.error(t,e))}constructor(e,t,i,s,o,r){(0,n._)(this,"_state",void 0),(0,n._)(this,"_doxApi",void 0),(0,n._)(this,"_navigateToDocument",void 0),(0,n._)(this,"_editorTsNotifications",void 0),(0,n._)(this,"_handleHttpDoxError",void 0),(0,n._)(this,"_reset",void 0),(0,n._)(this,"_log",void 0),(0,n._)(this,"_deletedDocumentIds",void 0),(0,n._)(this,"restoreDocument",void 0),(0,n._)(this,"documentUploadProgress",void 0),(0,n._)(this,"uploadDocument",void 0),(0,n._)(this,"handleDownloadDocumentError",void 0),this._state=e,this._doxApi=t,this._navigateToDocument=i,this._editorTsNotifications=s,this._handleHttpDoxError=o,this._reset=r,this._log=N.Bx.Logging.getLogger("model.documents.actions"),this._deletedDocumentIds=this._state.lens("deletedDocumentIds"),this.restoreDocument=e=>(this._deletedDocumentIds.lens("soft").modify((t=>t.filter((t=>t!==e)))),this._deletedDocumentIds.lens("hard").modify((t=>t.concat([e]))),(0,a.pipe)(M.TX((()=>this._doxApi.restoreDocumentById(e)),(e=>e)),M.wu((t=>(this._deletedDocumentIds.lens("soft").modify((t=>t.concat([e]))),t instanceof c.Hl&&this._handleHttpDoxError(t,"Failed to restore document"),t)),(()=>e)))),this.documentUploadProgress=d.s.create(null),this.uploadDocument=(e,t)=>this._doxApi.createDocument(p.Jo.Create.file(e,t)).then((e=>(this._state.lens("first100").modify((t=>g.j.isOk(t)?g.j.ok(new Array(e).concat(t.value)):t)),e))),this.handleDownloadDocumentError=e=>{this._log.error("downloadDocument failed",e);const t=e instanceof p.hB.UnauthorizedError,i=e instanceof p.hB.DocumentNotFoundError,s=e instanceof p.hB.TooManyRequestsError||e instanceof p.hB.ConnectionError;t?this._editorTsNotifications.show(this._editorTsNotifications.create.unauthorizedError()):i?this._editorTsNotifications.show(this._editorTsNotifications.create.downloadDocumentNotFoundError()):s?this._editorTsNotifications.show(this._editorTsNotifications.create.isTemporaryDownloadError()):this._editorTsNotifications.show(this._editorTsNotifications.create.error())}}}class K{constructor(e,t,i,s,o,r,a,l){(0,n._)(this,"_state",void 0),(0,n._)(this,"_doxApi",void 0),(0,n._)(this,"_doxWSApi",void 0),(0,n._)(this,"_settings",void 0),(0,n._)(this,"_connectivity",void 0),(0,n._)(this,"_notifications",void 0),(0,n._)(this,"_navigateToDocument",void 0),(0,n._)(this,"_router",void 0),(0,n._)(this,"proofit",void 0),(0,n._)(this,"_doxHttpErrorHandler",void 0),(0,n._)(this,"list",void 0),(0,n._)(this,"actions",void 0),this._state=e,this._doxApi=t,this._doxWSApi=i,this._settings=s,this._connectivity=o,this._notifications=r,this._navigateToDocument=a,this._router=l,this.proofit=new z(this._doxWSApi,this._state),this._doxHttpErrorHandler=e=>{switch(e.code){case p.hB.HttpCodes.UNAUTHORIZED:this._connectivity.setState({type:"dox",state:{type:"unauthorized"}});break;case p.hB.HttpCodes.TOO_MANY_REQUESTS:this._notifications.show(this._notifications.create.error());break;default:this._notifications.showError(e.message)}},this.list=new Z(this._state,this._doxApi,this._settings,this._connectivity,this._doxHttpErrorHandler),this.actions=new X(this._state,this._doxApi,this._navigateToDocument,this._notifications,this._doxHttpErrorHandler,this.list.load),this._router.isActive(B.Lz.routes.documents.href()).pipe(C.M((e=>this._state.lens("documentKind").set(e?F.j.Kind.existing:F.j.Kind.deleted)))).subscribe()}}},18711:(e,t,i)=>{i.r(t),i.d(t,{ChecklistSteps:()=>y,ChecklistUseCase:()=>b,CheetahOggyEditorInternal:()=>P,FeatureAwareness:()=>S,FreeTrial:()=>p,GDocsTour:()=>a,GetStartedChecklist:()=>_,GetStartedPriority:()=>r,GrammarlyProM3V2:()=>O,InlinePremiumPreviews:()=>o,LlamaAdoption:()=>w,LlamaEntryPointsV3:()=>f,LockedUIUXExperiment:()=>A,LongFormPremiumFeed:()=>M,OnboardingTourA11y:()=>v,PlagiarismUphook:()=>D,PremiumChecklistNoTrial:()=>g,PremiumChecklistTrial:()=>m,PremiumFreeTrialEuUk:()=>E,PremiumFreeTrialForNewUsers:()=>k,RedirectUphookToUpgradePage:()=>T,RemoveWelcomeTour:()=>u,SharedAssistant:()=>C,TopSitesTours:()=>l,TrueUp:()=>x,UphookCard:()=>n,WritingProgress:()=>d,WritingProgressV2:()=>c,WritingProgressV3:()=>h,lockedUI:()=>U});var s=i(60251);const n=new s.aj("denali_uphook_card",["test","control"]),o=new s.aj("inline_premium_previews_denali",["control","experiment"]),r=new s.aj("get_started_priority",["test","control"]),a=new s.aj("gdoc_tour",["test","control"]),l=new s.aj("top_sites_tours",["test","control"]),d=new s.aj("learning_hub_mvp",["control","test"]),c=new s.aj("writing_progress_v2",["control","test"]),h=new s.aj("writing_progress_v3",["control","dashboard","ipm"]),u=new s.aj("remove_welcome_tour",["control","test"]),p=new s.aj("premium_free_trial_v3",["trial","differentiated"]),_=new s.aj("get_started_checklist",["control","test"]),g=new s.aj("premium_checklist_no_trial",["control","test"]),m=new s.aj("premium_checklist_trial",["control","test"]),f=new s.aj("llama_entry_points_v3",["control","one_day_delay","three_day_delay"]),v=new s.aj("editor_onboarding_tour_a11y_v2",["control","test"]),y=new s.aj("checklist_steps",["control","test"]),b=new s.aj("checklist_use_case",["control","test"]),w=new s.aj("checklist_llama_editor",["control","test"]),S=new s.aj("feature_awareness",["control","test"]),x=new s.aj("true_up_billing",["control","test"]),T=new s.aj("editor_redirect_uphook_to_upgrade_page",["control","test"]),k=new s.aj("premium_free_trial_for_new_users",["control","test"]),E=new s.aj("premium_free_trial_eu_uk",["control","test"]),P=new s.aj("cheetah_oggy_editor",["control","test"]),C=new s.aj("sharedassistant_editor",["control","mergedSharedAssistant","splitSharedAssistants"]),D=new s.aj("smart_plagiarism_uphook",["control","test"]),A=new s.aj("locked_ui_iteration_1",["control","published_limit","non_published_limit"]),U=new s.aj("locked_ui_editor_2",["control","unlimited_pool"]),O=new s.aj("grammarly_pro_m3_v2",["control","test"]),M=new s.aj("long_form_premium_feed",["control","test"])},16843:(e,t,i)=>{i.r(t),i.d(t,{BackendManagedStorageMacEditor:()=>b,BackendManagedStorageWebEditor:()=>y,CPRA:()=>E,CheetahProfuseEventsTracking:()=>M,CheetahStudentsOnboarding:()=>w,GDPRInverted:()=>k,GDebugger:()=>L,GetStartedChecklistPermanentDismiss:()=>F,ReferralsGate:()=>O,SelectionContextUpdatesClient:()=>x,SelectionContextUpdatesServer:()=>T,TrafficThroughGatewayForCapi:()=>I,TrafficThroughInternalCapi:()=>N,VersionHistory:()=>B,WritingExpertFeedback:()=>P,WritingExpertInAssistantExternalNative:()=>U,WritingExpertInAssistantExternalOggy:()=>A,WritingExpertInAssistantInternal:()=>D,WritingExpertPullMode:()=>C,WritingExpertVbarsGlobal:()=>S,cheetahInlineRewrite:()=>_,cheetahMagicRewrite:()=>p,cheetahOnboarding:()=>g,cheetahOrgContext:()=>m,cheetahStudentBTS:()=>f,cheetahStudentPromptsInternal:()=>v,citationBuilder:()=>a,citationBuilderBannersChrome:()=>d,citationBuilderBannersEdge:()=>h,citationBuilderBannersFirefox:()=>u,citationBuilderBannersSafari:()=>c,citationBuilderInternal:()=>l,citationsRollout:()=>n,citationsRolloutInternal:()=>o,proofitNoteToEditor:()=>r});var s=i(60251);const n=new s.iD("citations_rollout","enabled"),o=new s.iD("citations_rollout_internal","enabled"),r=new s.iD("proofit_note_to_editor","enabled"),a=new s.iD("citation_builder","enabled"),l=new s.iD("citation_builder_internal","enabled"),d=new s.iD("citation_builder_banners_chrome","enabled"),c=new s.iD("citation_builder_banners_safari","enabled"),h=new s.iD("citation_builder_banners_edge","enabled"),u=new s.iD("citation_builder_banners_firefox","enabled"),p=new s.iD("cheetah_editor_feature_flag_magic_rewrite"),_=new s.iD("cheetah_editor_feature_flag_inline_rewrite"),g=new s.iD("cheetah_editor_feature_flag_product_onboarding"),m=new s.iD("gbgo_knowledge_share_web"),f=new s.iD("ggo_student_bts"),v=new s.iD("ggo_student_prompts_internal"),y=new s.iD("editor_feature_flag_capi_client_storage"),b=new s.iD("mac_editor_feature_flag_capi_client_storage"),w=new s.iD("ggo_students_onboarding"),S=new s.iD("vbars_global"),x=new s.iD("cheetah_selection_context_updates"),T=new s.iD("cheetah_selection_context_updates_server"),k=new s.iD("gdpr_inverted","enabled"),E=new s.iD("cpra"),P=new s.iD("writing_expert_feedback"),C=new s.iD("editor_writing_expert_pull_mode"),D=new s.iD("writing_expert_in_assistant"),A=new s.iD("writing_expert_in_assistant_oggy"),U=new s.iD("writing_expert_in_assistant_native"),O=new s.iD("growth_referrals"),M=new s.iD("cheetah_profuse_events_tracking"),I=new s.iD("capi_traffic_through_cthulhu"),N=new s.iD("capi_traffic_through_internal_capi"),B=new s.iD("editor_version_history"),F=new s.iD("get_started_checklist_permanent_dismiss"),L=new s.iD("g_debugger_enabled")},40884:(e,t,i)=>{var s,n,o,r;i.d(t,{yK:()=>W,LU:()=>z,Wk:()=>j,fO:()=>L,DY:()=>r,ZI:()=>Z,nS:()=>te,Vd:()=>G,d6:()=>q,kH:()=>H,vI:()=>V,bz:()=>I,Fh:()=>B,fx:()=>F,SA:()=>N}),function(e){e.Business="BUSINESS",e.Edu="EDU",e.Gov="GOV",e.K12="K12",e.Ngo="NGO"}(s||(s={})),function(e){e.Admin="admin",e.Member="member"}(n||(n={})),function(e){e.Free="free",e.Premium="premium",e.Business="business",e.Edu="edu"}(o||(o={})),function(e){e.isFree=e=>e.type===o.Free,e.isPremium=e=>e.type===o.Premium||e.type===o.Business||e.type===o.Edu,e.isPremiumConsumer=e=>e.type===o.Premium,e.isPro=e=>"isPro"in e&&e.isPro;var t=e.isBusiness=e=>e.type===o.Business,i=e.isEdu=e=>e.type===o.Edu,s=e.isInstitutionUser=e=>"institutionType"in e;e.isConsumerUser=e=>!s(e),e.isBusinessAdmin=e=>t(e)&&e.institutionType===n.Admin,e.isEduAdmin=e=>i(e)&&e.institutionType===n.Admin,e.isBusinessTeamMember=e=>t(e)&&e.institutionType===n.Member,e.isEduTeamMember=e=>i(e)&&e.institutionType===n.Member,e.isAdmin=e=>s(e)&&e.institutionType===n.Admin,e.isGrammarlyUser=e=>e.email.indexOf("@grammarly.com")>-1,e.isTestUser=e=>e.isTest}(r||(r={}));var a=i(23988),l=i(73872),d=i(30040),c=i(63336),h=i(80074),u=i(44781),p=i(34717),_=i(44297),g=i(58193),m=i(22835),f=i(36840),v=i(27788),y=i(69063),b=i(12486),w=i(81870),S=i(58434),x=i(18711),T=i(16843),k=i(37107),E=i(74056);const P=new Date(15259968e5),C=new Date(15488856e5),D=new Date(15995736e5),A={[u.k.BulkAccept]:{releaseDate:new Date(16091064e5),isNewFor:4*p.ks},trashbin:{releaseDate:new Date(1656324189130),isNewFor:5*p.ks},versionHistory:{releaseDate:new Date(17177112e5),isNewFor:3*p.ks}};var U;!function(e){e.is=e=>A.hasOwnProperty(e)}(U||(U={}));const O=new Date(16855776e5),M="llamaDiscoverabilityType";var I,N,B,F,L,R,j,H,W,G,q,V,z,Z;!function(e){let t;!function(e){e.on="on",e.force="force"}(t=e.UserRolePopupMode||(e.UserRolePopupMode={}))}(I||(I={})),function(e){e.layoutGroup="layoutGroup",e.benefits="benefits"}(N||(N={})),function(e){e.enabled="enabled",e.upgradeIsNeeded="upgradeIsNeeded",e.disabled="disabled"}(B||(B={})),function(e){e.plansPage="plansPage",e.upgradePage="upgradePage"}(F||(F={})),function(e){let t;!function(e){e.migration="migration",e.welcome="welcome"}(t=e.TourType||(e.TourType={})),e.isTourType=function(e){return e===t.migration||e===t.welcome}}(L||(L={})),function(e){e.withoutDiscount="withoutDiscount"}(R||(R={})),function(e){e.none="none",e.documentSettings="documentSettings"}(j||(j={})),function(e){e.mergedSharedAssistant="mergedSharedAssistant",e.splitSharedAssistants="splitSharedAssistants"}(H||(H={})),function(e){e[e.CRITICAL_ADVANCED=0]="CRITICAL_ADVANCED",e[e.FREE_PREMIUM=1]="FREE_PREMIUM"}(W||(W={})),function(e){e.List="List",e.Checklist="Checklist",e.PremiumChecklist="PremiumChecklist"}(G||(G={})),function(e){e.Banner="Banner",e.Modal="Modal"}(q||(q={})),function(e){let t,i;!function(e){e.Full="Full",e.Oggy="Oggy",e.OggySplit="OggySplit",e.WithoutInlineCards="WithoutInlineCards"}(t=e.Content||(e.Content={})),function(e){e.Forced="Forced",e.Standard="Standard",e.Hidden="Hidden"}(i=e.Kind||(e.Kind={})),e.isForced=function(e){return e.kind===i.Forced},e.isHidden=function(e){return e.kind===i.Hidden}}(V||(V={})),function(e){e.empty={extensionInstallPromotion:!1,showAppBanners:!1,showInviteMembersBanner:!1,showStyleGuideBanner:!1,mockedBannersState:_.none,showAutoCitationsPopupPromotion:!1,showAutoCitationsBannerPromotion:!1,llamaDiscoverabilityType:_.none,showTrueUpBanner:!1},e.BannersFeaturesImpl=class{get showAppBanners(){return!r.isEdu(this.denaliUserType)&&!r.isBusinessAdmin(this.denaliUserType)}get showInviteMembersBanner(){return this._router.query.has("gbInviteMembersBanner")||r.isBusinessAdmin(this.denaliUserType)&&!this._isUserRegisteredBefore(D)&&!this._settings.memberInviteOnboardingPassed.get()}get showStyleGuideBanner(){return this._router.query.has("gbStyleGuideBanner")||r.isAdmin(this.denaliUserType)&&(0,c.pipe)(this._userProfile.get().institutionInfo,_.exists((e=>e.voxEnabled)))&&_.isNone(this.voxInfo)}get showTrueUpBanner(){return this._exp.isQuery("true_up")||this._exp.isManakin(x.TrueUp,"test")&&r.isBusinessAdmin(this.denaliUserType)&&(0,c.pipe)(this._userProfile.get().institutionInfo,_.exists((e=>(0,c.pipe)(e.trueUpSchedule,_.exists((e=>Boolean(e.isTrueUpEligible)&&e.overageSeats>0&&_.isSome(e.nextTrueUpBillingDate)))))))}get mockedBannersState(){return(0,c.pipe)(this._router.query.get("mockedBannersState"),_.chain((0,d.flow)((e=>JSON.parse(e)),k.tl.bannersType.decode,_.fromEither)))}_shouldSeeAutoCitationPromotion(){return Date.now()>16632414e5&&(0,c.pipe)(this._userProfile.get().role,g.Lw((e=>e===S.gG.school||e===S.j1.student)))&&!r.isBusiness(this.denaliUserType)}get showAutoCitationsPopupPromotion(){return!!this._exp.isQuery("autoCitations")||!!this._shouldSeeAutoCitationPromotion()&&(this._exp.isManakin(T.citationBuilderInternal)||this._exp.isManakin(T.citationBuilder))}get showAutoCitationsBannerPromotion(){return!!this._exp.isQuery("autoCitations")||!!this._shouldSeeAutoCitationPromotion()&&("chrome"===this._browser&&this._exp.isManakin(T.citationBuilderBannersChrome)||"safari"===this._browser&&this._exp.isManakin(T.citationBuilderBannersSafari)||"edge"===this._browser&&this._exp.isManakin(T.citationBuilderBannersEdge)||"firefox"===this._browser&&this._exp.isManakin(T.citationBuilderBannersFirefox))}get llamaDiscoverabilityType(){return this._llamaDiscoverabilityType}constructor(e,t,i,s,n,o,r,l,d){(0,a._)(this,"_userProfile",void 0),(0,a._)(this,"_exp",void 0),(0,a._)(this,"_settings",void 0),(0,a._)(this,"_router",void 0),(0,a._)(this,"denaliUserType",void 0),(0,a._)(this,"_isUserRegisteredBefore",void 0),(0,a._)(this,"voxInfo",void 0),(0,a._)(this,"_browser",void 0),(0,a._)(this,"_llamaDiscoverabilityType",void 0),(0,a._)(this,"extensionInstallPromotion",void 0),this._userProfile=e,this._exp=t,this._settings=i,this._router=s,this.denaliUserType=n,this._isUserRegisteredBefore=o,this.voxInfo=r,this._browser=l,this._llamaDiscoverabilityType=d,this.extensionInstallPromotion=!this._isUserRegisteredBefore(C)&&!this._exp.isDapi(...K.disabled)&&!this._exp.isQuery("disable_ext_promo")&&_.isNone(this._llamaDiscoverabilityType)||(0,c.pipe)(this._router.query.get("ext_promo"),_.exists((e=>"show"===e)))}}}(z||(z={}));class X{showNewLabel(e){const t=A[e];return!r.isTestUser(this._userProfile.get())&&(new Date).getTime()<t.isNewFor+t.releaseDate.getTime()}get cheetah(){return this._environment.platform===E.OH.Platform.WEB||this._environment.platform===E.OH.Platform.MACEDITOR}get cheetahMagicRewrite(){return(0,c.pipe)(this._router.query.get("cheetahMagicRewrite"),_.map((e=>"on"===e)),_.getOrElse((()=>this._exp.isManakin(T.cheetahMagicRewrite))))}get cheetahInlineRewrite(){return(0,c.pipe)(this._router.query.get("cheetahInlineRewrite"),_.map((e=>"on"===e)),_.getOrElse((()=>this._exp.isManakin(T.cheetahInlineRewrite))))}get cheetahOnboarding(){return this._environment.platform===E.OH.Platform.WEB&&(this._exp.isManakin(T.cheetahOnboarding)||this._exp.isQuery("cheetahOnboarding"))}get cheetahOrgContextEnabled(){return this._exp.isManakin(T.cheetahOrgContext)||this._exp.isQuery("cheetahOrgContext")}get cheetahBTSOnboardingEnabled(){return this._exp.isManakin(T.CheetahStudentsOnboarding)&&(this._exp.isManakin(T.cheetahStudentBTS)||this._exp.isManakin(T.cheetahStudentPromptsInternal))||(0,c.pipe)(this._router.query.get("cheetahBTSOnboarding"),_.isSome)}get writingExpertVbarsEnabled(){return this._exp.isManakin(T.WritingExpertVbarsGlobal)||this._exp.isQuery("writingExpertVbars")}get isEligibleForGtm(){const e=this._userProfile.get().email;return!["fcps.edu","fcpsschools.net","winclusion.org","test.fcpstechlab.org","grammarlian.com"].some((t=>e.endsWith(`@${t}`)))&&this._exp.isManakin(T.GDPRInverted)&&!this._exp.isManakin(T.CPRA)}get cheetahPromptsUsed(){return(0,c.pipe)(this._router.query.get("cheetahPromptsUsed"),_.map((e=>Number.parseInt(e,10))),_.filter((e=>!Number.isNaN(e))))}get backendManagedStorageEnabled(){return!(void 0===window.indexedDB||!(this._environment.platform===E.OH.Platform.WEB&&this._exp.isManakin(T.BackendManagedStorageWebEditor)||this._environment.platform===E.OH.Platform.MACEDITOR&&this._exp.isManakin(T.BackendManagedStorageMacEditor)||this._exp.isQuery("backendManagedStorage")))}get mutedAlerts(){return!(0,c.pipe)(this._router.query.get("mutedAlerts"),_.exists((e=>"off"===e)))&&((0,c.pipe)(this._router.query.get("mutedAlerts"),_.exists((e=>"on"===e)))||r.isPremium(this._userMeta.denaliUserType))}get enforceFeaturesOnboarding(){const e=new Set;return this._isUserTestingMutedAlerts&&e.add(u.k.CardMute),this._forceMuteQuotedAlertsAdvice&&e.add(u.k.MuteQuotedAdvice),e}get safariExtActivationWeb(){return this._exp.isQuery("safariExt")||"safari"===this._environment.info.browser&&!this._settings.seenSafariExtNotification.get()&&this._settings.safariDeactivatedWeb.get()}get getStartedPriority(){return this._exp.isManakin(x.GetStartedPriority,"test")}get gDocsTour(){return this._exp.isManakin(x.GDocsTour,"test")}get topSitesTours(){return this._exp.isQuery("topSitesTours")||this._exp.isManakin(x.TopSitesTours,"test")}get supportUkraineCardAppearanceLimit(){return(0,c.pipe)(this._router.query.get("supportUkraineCardAppearanceLimit"),_.map((e=>parseInt(e,10))),_.getOrElse((()=>4)))}get isStudentsOFE(){return!_.exists((e=>"off"===e))(this._router.query.get("students"))&&(this._exp.isManakin(T.citationsRollout)||this._exp.isManakin(T.citationsRolloutInternal)||(0,c.pipe)(this._router.query.get("students"),_.exists((e=>"on"===e))))}get proofitNoteToEditor(){return this._exp.isManakin(T.proofitNoteToEditor)}get isInternalUser(){return this._userMeta.isInternalUser}get showSignoutSurvey(){return(0,c.pipe)(this._router.query.get("signOutSurvey"),_.exists((e=>"on"===e)))||!this._settings.seenSignOutSurvey.get()}get showSignOutConfirmationPopup(){return!(0,c.pipe)(this._router.query.get("signOutConfirmation"),_.exists((e=>"off"===e)))}get removeWelcomeTour(){return this._exp.isQuery("removeWelcomeTour")||this._exp.isManakin(x.RemoveWelcomeTour,"test")}get showOnboardingTourA11yUpdates(){return this._exp.isQuery("showDemoDocOnboardingA11y")||this._exp.isManakin(x.OnboardingTourA11y,"test")}get removeAccountCreationSection(){return this._exp.isManakin(x.ChecklistSteps,"test")}get tailorTryInWebsitesSection(){return this._exp.isManakin(x.ChecklistUseCase,"test")}get replaceViewAppsSection(){return this._exp.isManakin(x.LlamaAdoption,"test")}get replaceTakeATourSection(){return this._exp.isManakin(x.FeatureAwareness,"test")}get selectionContextUpdatesClient(){return this._exp.isManakin(T.SelectionContextUpdatesClient,"enabled")}get selectionContextUpdatesServer(){return this._exp.isManakin(T.SelectionContextUpdatesServer,"enabled")}get writingExpertPullMode(){return(0,c.pipe)(this._router.query.get("writingExpertPullMode"),_.map((e=>"on"===e)),_.getOrElse((()=>!!this._exp.isManakin(T.WritingExpertPullMode,"enabled")&&(this._exp.isManakin(T.WritingExpertInAssistantExternalOggy,"enabled")||this._exp.isManakin(T.WritingExpertInAssistantExternalNative,"enabled")||this._exp.isManakin(T.WritingExpertInAssistantInternal,"enabled")))))}get oggy(){return(0,c.pipe)(this._router.query.get("oggy"),_.map((e=>"merged"===e?H.mergedSharedAssistant:H.splitSharedAssistants)),_.getOrElse((0,d.constant)(H.splitSharedAssistants)))}get isLockedUIEnabled(){return r.isFree(this._userMeta.denaliUserType)&&this._exp.peekManakinExperiment(x.lockedUI,"unlimited_pool")}get lockedUIUXExperimentTreatment(){return this.isLockedUIEnabled&&(this._exp.peekManakinExperiment(x.LockedUIUXExperiment,"published_limit")||this._exp.peekManakinExperiment(x.LockedUIUXExperiment,"non_published_limit"))}get uphookDestination(){if(this._exp.isQuery("redirectUphookToUpgradePage"))return _.some(F.upgradePage);const e=this._exp.getManakinExperimentTreatment(x.RedirectUphookToUpgradePage);return"test"===e?_.some(F.upgradePage):"control"===e?_.some(F.plansPage):_.none}get writingExpertFeedback(){return this._exp.isQuery("writingExpertFeedback")||r.isGrammarlyUser(this._userProfile.get())&&this._exp.isManakin(T.WritingExpertFeedback)}get isGetStartedChecklistPermanentDismissEnabled(){return this._isGetStartedChecklistPermanentDismissEnabled}get versionHistory(){return this._exp.isQuery("version_history")||this._exp.isManakin(T.VersionHistory,"enabled")}get _isFreeClarityAlertsEnabled(){return this._exp.isQuery("free-clarity-enabled")}get _isFreeClarityAlertsControl(){return this._exp.isQuery("free-clarity-control")}get _isProofitSurvey(){return this._userProfile.get().type===S.ut.premium||this._exp.isQuery("proofit_promo")}get _isPremiumOnboardingSurvey(){return!1}get _isGBSatisfactionSurvey(){const e=this._exp.isQuery("gb_satisfaction_survey_enabled"),t=(0,c.pipe)(this._userProfile.get().institutionInfo,_.fold(d.constFalse,(e=>e.business&&e.admin)));return e&&t}get _isPowerUserSurvey(){return _.isSome(this._router.query.get("powerUser"))}get _isUserTestingFullSentence(){return this._exp.isQuery("ut-fullSentence")}get _isAnnotator(){return this._exp.isQuery("ut-annotator")}get _isUserTestingMutedAlerts(){return this._exp.isQuery("ut-mutedAlerts")}get _isUserTestingListTransform(){return this._exp.isQuery("ut-listTransform")}get _forceMuteQuotedAlertsAdvice(){return(0,c.pipe)(this._router.query.get("muteQuotedAlerts"),_.exists((e=>"force"===e)))}_dismissedGetStartedChecklist(e){var t,i;const s="premium"===e?null===(t=this._settings.getStartedPremiumChecklistSettings)||void 0===t?void 0:t.get().dismissal:null===(i=this._settings.getStartedChecklistSettings)||void 0===i?void 0:i.get().dismissal;return(0,c.pipe)(s,_.exists((e=>{const{type:t,timestamp:i}=e;return t===k.RM.HardDismiss||t===k.RM.SoftDismiss&&Date.now()-i.getTime()<2*p.ei})))}get _viewedOrDismissedLlamaModal(){const e=this._settings.llamaDiscoverabilitySettings.get().modalDismissalTimestamp;return _.isSome(e)}get _dismissedLlamaBanner(){const e=this._settings.llamaDiscoverabilitySettings.get().bannerDismissalTimestamp;return _.isSome(e)}get _hideGetStarted(){return _.isSome(this._router.query.get("hideGetStarted"))}get _showGetStartedChecklist(){return this._userProfile.get().type===S.ut.free&&!this._dismissedGetStartedChecklist("free")&&(0,c.pipe)(this._userProfile.get().registrationDate,_.exists((e=>Date.now()-e.getTime()<p.ks)))}get _isInFreeTrialExperiment(){return this._userMeta.isOnFreeTrial.get()&&this._exp.isManakin(x.PremiumChecklistTrial,"test")}get _isInNonTrialExperiment(){return!this._userMeta.isOnFreeTrial.get()&&this._exp.isManakin(x.PremiumChecklistNoTrial,"test")}get _isInPremiumChecklistExperiment(){return this._isInNonTrialExperiment||this._isInFreeTrialExperiment}get _forceShowPremiumGetStartedChecklist(){return this._exp.isQuery("premiumGetStartedChecklist")}get _isGetStartedChecklistPermanentDismissEnabled(){return this._exp.isManakin(T.GetStartedChecklistPermanentDismiss,"enabled")}get _showPremiumGetStartedChecklist(){const e=(0,c.pipe)(this._userMeta.lastSubscribedDateString.get(),_.exists((e=>{const t=new Date(e);return Date.now()-t.getTime()<p.ks})));return this._forceShowPremiumGetStartedChecklist||this._userProfile.get().type===S.ut.premium&&!r.isInstitutionUser(this._userMeta.denaliUserType)&&e&&!this._dismissedGetStartedChecklist("premium")&&this._isInPremiumChecklistExperiment}get _showGetStartedList(){return this._userProfile.get().type===S.ut.premium&&(0,c.pipe)(this._userProfile.get().registrationDate,_.exists((e=>Date.now()-e.getTime()<p.ei)))}get _hasInstalledLlama(){const e=this._userProfile.get().groups;return e.has("windowsExtension")||e.has("macExtension")}get _isFromOnboarding(){return(0,c.pipe)(this._router.query.get("isFromOnboarding"),_.exists((e=>"true"===e)))}get _hasOneWeekPassedSinceRegistration(){const e=new Date;return this._isUserRegisteredBefore(new Date(e.getTime()-p.ks))}get _assignLlamaEntryPointType(){return this._exp.getManakinExperimentTreatment(x.LlamaEntryPointsV3)}get _showLlamaDiscoverabilityModal(){if((0,c.pipe)(this._router.query.get(M),_.exists((e=>"modal"===e))))return!0;if(!this._hasInstalledLlama&&!this._viewedOrDismissedLlamaModal){const e=new Date,t=this._assignLlamaEntryPointType;return"one_day_delay"===t?this._isUserRegisteredBefore(new Date(e.getTime()-p.ei)):"three_day_delay"===t?this._isUserRegisteredBefore(new Date(e.getTime()-3*p.ei)):!this._isFromOnboarding&&this._hasOneWeekPassedSinceRegistration}return!1}get _showLlamaDiscoverabilityBanner(){if((0,c.pipe)(this._router.query.get(M),_.exists((e=>"banner"===e))))return!0;if(!this._hasInstalledLlama&&!this._dismissedLlamaBanner){const e=this._assignLlamaEntryPointType;return"one_day_delay"===e||"three_day_delay"===e||this._hasOneWeekPassedSinceRegistration}return!1}_getAssignedSurveys(){const e=new Array;return this._surveyTypeAssignments.forEach(((t,i)=>{t&&e.push(i)})),e}get requirePaymentCheck(){return _.isSome(this._router.query.get("fraud"))}get documentToolbar(){return this._isIPad||this._isMacEditor?j.none:j.documentSettings}get showUploadInPlaceholderText(){return!this._isMacEditor}get voxInfo(){return(0,c.pipe)(this._userProfile.get().institutionInfo,_.chain((e=>e.vox)),g.NW(_.none))}get instType(){return this._instType.get()}get alertGroupNames(){return this._userMeta.isFree.get()?W.FREE_PREMIUM:W.CRITICAL_ADVANCED}get llamaDiscoverabilityType(){return this._showLlamaDiscoverabilityModal?_.some(q.Modal):this._showLlamaDiscoverabilityBanner?_.some(q.Banner):_.none}get isLlamaDiscoverabilityTest(){return(0,c.pipe)(this._settings.llamaDiscoverabilitySettings.get().modalDismissalTimestamp,_.exists((e=>e>O)))||(0,c.pipe)(this._settings.llamaDiscoverabilitySettings.get().bannerDismissalTimestamp,_.exists((e=>e>O)))}get getStartedType(){return this._hideGetStarted?_.none:this._showPremiumGetStartedChecklist?_.some(G.PremiumChecklist):this._showGetStartedChecklist?_.some(G.Checklist):!this._dismissedGetStartedChecklist("premium")&&this._showGetStartedList?_.some(G.List):_.none}get tour(){return this.removeWelcomeTour?_.none:(0,c.pipe)(this._router.query.get("tour"),_.filter(L.isTourType),_.fold((()=>this._settings.seenDenaliWelcome.get()||this._isIPad||!(0,c.pipe)(this._userProfile.get().registrationDate,_.exists((e=>e>P)))?_.none:_.some(this._settings.seenWelcome.get()?L.TourType.migration:L.TourType.welcome)),_.some))}get alertsUpdate(){return(0,c.pipe)(this._router.query.get("alertsUpdate"),_.exists((e=>"true"===e)))}get autoJumpSettings(){return{isDisabledByDefault:!0}}get sidebarOpenedByDefault(){return!this._exp.isQuery("disableSidebarByDefault")}get globalExperimentDemoText(){return this._isUserTestingFullSentence?_.some("fullSentenceDemoText"):this._isUserTestingMutedAlerts?_.some("mutedAlertsDemoText"):this._isUserTestingListTransform?_.some("listTransformDemoText"):this._isAnnotator?_.some("annotatorEmptyDocument"):_.none}get showcaseNewFeaturesOnStartup(){return _.isNone(this.tour)&&!this._isIPad&&((0,c.pipe)(this._router.query.get("showNews"),_.exists((e=>"true"===e)))||!r.isTestUser(this._userProfile.get())&&m.HP(this.newsConfig).some((e=>!this._settings.newsSeen.get().has(e)&&this.newsConfig[e].visible()&&this.newsConfig[e].showcaseOnStartup())))}get rtf(){return!this._exp.isQuery("no_rtf")}get toneDetector(){return(this._exp.isQuery("toneDetector")||r.isGrammarlyUser(this._userProfile.get()))&&!this._exp.isQuery("no_toneDetector")}get changePlanHook(){return this._settings.changePlanHook.view((e=>{if((0,f.Ub)(r.isFree,r.isInstitutionUser)(this._userMeta.denaliUserType))return _.none;if(this._exp.isQuery(this._changePlanHook.query.withoutDiscount))return _.some(R.withoutDiscount);const t=p.Local.daysAgo(p.Local.now(),3),i=(0,c.pipe)(e.latestDismissAt,_.fold((()=>!0),(e=>e.getTime()<t))),s=e.latestAppearances.filter((e=>t<e.getTime())).length;return i&&s<3?_.some(R.withoutDiscount):_.none}))}get gbBillingMigrationNotification(){return(0,c.pipe)(this._router.query.get("gb_billing_migration"),_.fold((()=>h.s.combine(this._userProfile,this._settings.gbBillingMigrationSettings,((e,t)=>(0,c.pipe)(e.institutionInfo,_.chain((({admin:e,subscriptionInfo:{migrationState:i,expirationDate:s}})=>e&&"BILLING_FLOW_MIGRATION_STARTED"===i?(0,c.pipe)(_.fromEither(p.Local.parseDate(s)),_.chain((e=>{const i=p.Local.now(),s=p.Local.monthsAgo(e,1);if(p.Local.toTimestamp(i)<s||i>e)return _.none;const n=p.Local.daysAgo(i,5);return(0,c.pipe)(t.latestDismissAt,_.exists((e=>e.getTime()>n)))?_.none:_.some({expiryDate:e})}))):_.none)))))),(()=>h.s.create(_.some({expiryDate:new Date})))))}get premiumUngatingRenewalNotification(){if(this._userMeta.isFree.get())return h.s.create(_.none);if(this._exp.isQuery("premium_ungating_renewal_notification"))return h.s.create(_.some(p.Local.now()));const e=p.Local.toTimestamp(p.Local.now()),t=p.Local.Timestamp.add(e,2*p.ei);return h.s.combine(this._settings.ungatedTrialEndDate,this._settings.ungatedRenewalNotificationSettings,((i,s)=>s.wasDismissed||(0,c.pipe)(s.latestAppearance,_.exists((e=>e.getDate()===(new Date).getDate())))?_.none:(0,c.pipe)(i,_.filter((i=>e<i.getTime()&&i.getTime()<t)))))}get recordCapiMessages(){return(0,c.pipe)(this._router.query.get("recordCapiMessages"),_.fold((()=>"off"),(e=>"messages-and-mock"===e?"messages-and-mock":"messages")))}get gDebugger(){return(0,c.pipe)(this._router.query.get("gdebugger"),_.fold((()=>this._exp.isManakin(T.GDebugger,"enabled")),(e=>"on"===e)))}get dlp(){return(0,c.pipe)(this._clientControls,_.exists((({dlpEnabled:e})=>e)))}get uphookFormat(){return this._exp.isDapi(...this._uphookFormat.layoutGroups)||this._exp.isQuery(this._uphookFormat.layoutGroupsQuery)?_.some(N.layoutGroup):this._exp.isDapi(...this._uphookFormat.benefits)||this._exp.isQuery(this._uphookFormat.benefitsQuery)?_.some(N.benefits):_.none}get gbPrompt(){return(0,c.pipe)(this._userProfile.get().institutionInfo,_.exists((e=>e.voxEnabled)))}get sendProfuseGnarEvents(){return this._exp.isManakin(T.CheetahProfuseEventsTracking,"enabled")}get isSmartPlagiarismUphookEnabled(){return this._exp.peekManakinExperiment(x.PlagiarismUphook,"test")}get trafficThroughGatewayForCapi(){return this._exp.isManakin(T.TrafficThroughGatewayForCapi,"enabled")}get trafficThroughInternalCapi(){return this._exp.isQuery("internalCapi")||r.isGrammarlyUser(this._userProfile.get())&&this._exp.isManakin(T.TrafficThroughInternalCapi,"enabled")}constructor(e,t,i,s,n,o,r,h,u,g){(0,a._)(this,"_userProfile",void 0),(0,a._)(this,"_settings",void 0),(0,a._)(this,"_clientControls",void 0),(0,a._)(this,"_router",void 0),(0,a._)(this,"_exp",void 0),(0,a._)(this,"_environment",void 0),(0,a._)(this,"_instType",void 0),(0,a._)(this,"_proofit",void 0),(0,a._)(this,"_userMeta",void 0),(0,a._)(this,"_isUserRegisteredBefore",void 0),(0,a._)(this,"onboardingSeen",void 0),(0,a._)(this,"markFeatureOnboarded",void 0),(0,a._)(this,"newsConfig",void 0),(0,a._)(this,"_log",void 0),(0,a._)(this,"_changePlanHook",void 0),(0,a._)(this,"_uphookFormat",void 0),(0,a._)(this,"_isIPad",void 0),(0,a._)(this,"_isMacEditor",void 0),(0,a._)(this,"_surveyTypeAssignments",void 0),(0,a._)(this,"surveyType",void 0),(0,a._)(this,"appInitedFromDenaliPage",void 0),(0,a._)(this,"dismissFeedbackFormSuppressed",void 0),this._userProfile=e,this._settings=t,this._clientControls=i,this._router=s,this._exp=n,this._environment=o,this._instType=r,this._proofit=h,this._userMeta=u,this._isUserRegisteredBefore=g,this.onboardingSeen=e=>this._settings.featuresOnboardingSeen.view((t=>t.has(e))),this.markFeatureOnboarded=e=>{this._settings.markFeatureOnboarded(e)},this.newsConfig={[k.Ks.VersionHistory]:{visible:()=>this.versionHistory,showcaseOnStartup:d.constTrue},[k.Ks.Trash]:{visible:d.constTrue,showcaseOnStartup:()=>this._isUserRegisteredBefore(new Date(A.trashbin.releaseDate.getTime()-p.ks))},[k.Ks.MutedAlerts]:{visible:()=>this.mutedAlerts,showcaseOnStartup:d.constFalse},[k.Ks.RTF]:{visible:()=>this.rtf,showcaseOnStartup:d.constFalse},[k.Ks.PDF]:{visible:d.constTrue,showcaseOnStartup:d.constFalse},[k.Ks.ProofitClarity]:{visible:()=>this._proofit.get()===B.enabled,showcaseOnStartup:d.constFalse}},this._log=y.Bx.Logging.getLogger("DenaliFeaturesImpl",b.$.DEBUG),this._changePlanHook={query:{withoutDiscount:"change-plan-without-discount"}},this._uphookFormat={control:["uphook_formats_control_1","uphook_formats_control_2"],layoutGroups:["uphook_formats_experiment_layout_group_1","uphook_formats_experiment_layout_group_2"],layoutGroupsQuery:"uphook_formats_layout",benefits:["uphook_formats_experiment_benefits_1","uphook_formats_experiment_benefits_2"],benefitsQuery:"uphook_formats_benefits"},this._isIPad=this._environment.platform===E.OH.Platform.IPAD,this._isMacEditor=this._environment.platform===E.OH.Platform.MACEDITOR,this._surveyTypeAssignments=new Map([[k.L0.FreeClarityAlertsControl,this._isFreeClarityAlertsControl],[k.L0.FreeClarityAlertsEnabled,this._isFreeClarityAlertsEnabled],[k.L0.GBSatisfaction,this._isGBSatisfactionSurvey],[k.L0.MostActiveUsers,this._isPowerUserSurvey],[k.L0.PremiumOnboarding,this._isPremiumOnboardingSurvey],[k.L0.ProofitPromo,this._isProofitSurvey]]),this.surveyType=(0,c.pipe)(this._router.query.get("survey"),_.filter((e=>Object.values(k.L0).includes(e))),_.fold((()=>{if(this._userMeta.isInternalUser&&_.isNone(this._router.query.get("exp")))return _.none;const e=this._getAssignedSurveys();return e.length>1&&(2!==e.length||!e.includes(k.L0.ProofitPromo))&&this._log.error("User has been assigned to multiple surveys. Check all finished experiments have been closed",e.join(", ")),_.fromNullable(e[0])}),_.some),_.filter((e=>!this._isIPad))),this.appInitedFromDenaliPage=this._router.isActive(w.Lz.routes.denali_editor.href({docId:"*"})).get(),this.dismissFeedbackFormSuppressed=(0,c.pipe)((()=>this._router.query.get("suppressFeedbackForm")),v.K.map((e=>"true"===e)),l.Tj(_.getOrElse(d.constFalse))),(0,f.hJ)("getSurveyType",(()=>this.surveyType)),(0,f.hJ)("getRecordCapiMessagesMode",(()=>this.recordCapiMessages))}}!function(e){e.BannersFeaturesMock=class{constructor(e=!1){(0,a._)(this,"extensionInstallPromotion",void 0),(0,a._)(this,"showAppBanners",void 0),(0,a._)(this,"showInviteMembersBanner",void 0),(0,a._)(this,"showStyleGuideBanner",void 0),(0,a._)(this,"showAutoCitationsPopupPromotion",void 0),(0,a._)(this,"showAutoCitationsBannerPromotion",void 0),(0,a._)(this,"mockedBannersState",void 0),(0,a._)(this,"llamaDiscoverabilityType",void 0),(0,a._)(this,"showTrueUpBanner",void 0),this.extensionInstallPromotion=e,this.showAppBanners=!0,this.showInviteMembersBanner=!1,this.showStyleGuideBanner=!1,this.showAutoCitationsPopupPromotion=!1,this.showAutoCitationsBannerPromotion=!1,this.mockedBannersState=_.none,this.llamaDiscoverabilityType=_.none,this.showTrueUpBanner=!1}};class t{constructor(){(0,a._)(this,"newsConfig",void 0),(0,a._)(this,"sidebarOpenedByDefault",!1),(0,a._)(this,"newExtensionBanner",!1),(0,a._)(this,"alertsUpdate",!1),(0,a._)(this,"tour",_.none),(0,a._)(this,"enabled",!0),(0,a._)(this,"showSwitchToDenaliBtn",void 0),(0,a._)(this,"alertGroupNames",W.CRITICAL_ADVANCED),(0,a._)(this,"appInitedFromDenaliPage",!1),(0,a._)(this,"instType",_.none),(0,a._)(this,"surveyType",_.none),(0,a._)(this,"autoJumpSettings",{title:"",isDisabledByDefault:!1}),(0,a._)(this,"getStartedType",_.none),(0,a._)(this,"toneDetector",!1),(0,a._)(this,"enforceFeaturesOnboarding",new Set),(0,a._)(this,"premiumOnboardingSurvey",!1),(0,a._)(this,"recordCapiMessages","messages"),(0,a._)(this,"ideas",_.none),(0,a._)(this,"showSignoutSurvey",!1),(0,a._)(this,"showSignOutConfirmationPopup",!1),(0,a._)(this,"proofitNoteToEditor",!1),(0,a._)(this,"isInternalUser",!1),(0,a._)(this,"globalExperimentDemoText",_.none),(0,a._)(this,"showcaseNewFeaturesOnStartup",!1),(0,a._)(this,"rtf",!0),(0,a._)(this,"voxInfo",_.none),(0,a._)(this,"documentToolbar",j.documentSettings),(0,a._)(this,"showUploadInPlaceholderText",!0),(0,a._)(this,"requirePaymentCheck",!1),(0,a._)(this,"iPad",!0),(0,a._)(this,"changePlanHook",h.s.create(_.none)),(0,a._)(this,"gbUpHook",h.s.create(_.none)),(0,a._)(this,"mutedAlerts",!1),(0,a._)(this,"premiumUngatingRenewalNotification",h.s.create(_.none)),(0,a._)(this,"dismissFeedbackFormSuppressed",l.of(!1)),(0,a._)(this,"showNewLabel",d.constFalse),(0,a._)(this,"onboardingSeen",(0,d.constant)(h.s.create(!1))),(0,a._)(this,"markFeatureOnboarded",f.Yi),(0,a._)(this,"gbBillingMigrationNotification",h.s.create(_.none)),(0,a._)(this,"safariExtActivationWeb",!1),(0,a._)(this,"safariExtActivationNative",!1),(0,a._)(this,"lockedUIUXExperimentTreatment",!1),(0,a._)(this,"isLockedUIEnabled",!1),(0,a._)(this,"dlp",!1),(0,a._)(this,"uphookFormat",_.none),(0,a._)(this,"gbPrompt",!1),(0,a._)(this,"getStartedPriority",!1),(0,a._)(this,"gDocsTour",!1),(0,a._)(this,"topSitesTours",!1),(0,a._)(this,"isStudentsOFE",!1),(0,a._)(this,"supportUkraineCardAppearanceLimit",0),(0,a._)(this,"llamaDiscoverabilityType",_.none),(0,a._)(this,"removeWelcomeTour",!1),(0,a._)(this,"cheetah",!1),(0,a._)(this,"cheetahMagicRewrite",!1),(0,a._)(this,"cheetahInlineRewrite",!1),(0,a._)(this,"cheetahOnboarding",!1),(0,a._)(this,"cheetahPromptsUsed",_.none),(0,a._)(this,"cheetahOrgContextEnabled",!1),(0,a._)(this,"removeAccountCreationSection",!1),(0,a._)(this,"tailorTryInWebsitesSection",!1),(0,a._)(this,"replaceViewAppsSection",!1),(0,a._)(this,"replaceTakeATourSection",!1),(0,a._)(this,"trueUpSchedule",_.none),(0,a._)(this,"backendManagedStorageEnabled",!1),(0,a._)(this,"cheetahBTSOnboardingEnabled",!1),(0,a._)(this,"showDemoDocOnboardingA11yUpdates",!1),(0,a._)(this,"demoDocOnboardingA11yUpdatesTreatment",_.none),(0,a._)(this,"writingExpertVbarsEnabled",!1),(0,a._)(this,"writingExpertPullMode",!1),(0,a._)(this,"isEligibleForGtm",!1),(0,a._)(this,"showOnboardingTourA11yUpdates",!1),(0,a._)(this,"selectionContextUpdatesClient",!1),(0,a._)(this,"selectionContextUpdatesServer",!1),(0,a._)(this,"oggy",H.splitSharedAssistants),(0,a._)(this,"uphookDestination",_.none),(0,a._)(this,"writingExpertFeedback",!1),(0,a._)(this,"sendProfuseGnarEvents",!1),(0,a._)(this,"isSmartPlagiarismUphookEnabled",!1),(0,a._)(this,"trafficThroughGatewayForCapi",!1),(0,a._)(this,"trafficThroughInternalCapi",!1),(0,a._)(this,"versionHistory",!1),(0,a._)(this,"isGetStartedChecklistPermanentDismissEnabled",!0),(0,a._)(this,"gDebugger",!1)}}e.DenaliFeaturesMock=t,e.SDUIDenaliFeaturesMock=class extends t{constructor(...e){super(...e),(0,a._)(this,"sdui",!0)}},e.DenaliPageFeaturesMock=class{get isFree(){return"boolean"==typeof this._isFree?h.s.create(this._isFree):this._isFree}get isPremium(){return"boolean"==typeof this._isFree?h.s.create(!this._isFree):this._isFree.view((e=>!e))}get denaliUserType(){return{type:("boolean"==typeof this._isFree?this._isFree:this._isFree.get())?o.Free:o.Premium}}constructor(e,t,i=!1){(0,a._)(this,"_isFree",void 0),(0,a._)(this,"denali",void 0),(0,a._)(this,"hideOnboarding",void 0),(0,a._)(this,"disableAppsPromotion",void 0),(0,a._)(this,"enableTrackingOnDownload",void 0),(0,a._)(this,"onboardingMode",void 0),(0,a._)(this,"plagiarism",void 0),(0,a._)(this,"proofit",void 0),(0,a._)(this,"demoMode",void 0),(0,a._)(this,"proofitTest",void 0),(0,a._)(this,"proofitLastJob",void 0),(0,a._)(this,"preventAnimation",void 0),(0,a._)(this,"voxInfo",void 0),(0,a._)(this,"track3rdPartyExtensionsInjection",void 0),(0,a._)(this,"subscriptionCampaign",void 0),(0,a._)(this,"lastSubscribedDateString",void 0),(0,a._)(this,"isOnFreeTrial",void 0),(0,a._)(this,"isMacEditor",void 0),(0,a._)(this,"isEligibleForFreeTrial",void 0),(0,a._)(this,"isEligibleForFreeTrialEuUk",void 0),(0,a._)(this,"proVsPremiumExperiment",void 0),(0,a._)(this,"assignProVsPremiumExperiment",void 0),(0,a._)(this,"isSmartPlagiarismUphookEnabled",void 0),(0,a._)(this,"isLongFormPremiumFeedEnabled",void 0),(0,a._)(this,"assignSmartPlagiarismUphookExperiment",void 0),this._isFree=e,this.denali=t,this.hideOnboarding=i,this.disableAppsPromotion=!1,this.enableTrackingOnDownload=h.s.create(!1),this.plagiarism=h.s.create(B.disabled),this.proofit=h.s.create(B.disabled),this.proofitTest=_.none,this.proofitLastJob=_.none,this.voxInfo=_.none,this.track3rdPartyExtensionsInjection=!1,this.subscriptionCampaign=h.s.create(_.none),this.lastSubscribedDateString=h.s.create(_.none),this.isOnFreeTrial=h.s.create(!1),this.proVsPremiumExperiment=!1,this.assignProVsPremiumExperiment=f.Yi,this.isSmartPlagiarismUphookEnabled=!1,this.isLongFormPremiumFeedEnabled=!1,this.assignSmartPlagiarismUphookExperiment=f.Yi}}}(Z||(Z={}));const K={disabled:["disable_extension_installation_disabled"]};var Y=i(10821),J=i(5692),Q=i(83531),$=i(60251);class ee{isDapi(...e){return e.some((e=>this._experiments.has(e)))}isQuery(e){return(0,c.pipe)(this._router.query.get("exp"),_.exists((t=>t.split(",").includes(e))))}isManakin(e,...t){if(e instanceof $.iD){const t=this._experimentClient.isGateEnabled(e);return t&&this.storeKnown(e.name,e.experience),t}{const i=this._experimentClient.getTreatment(e);if(null===i)return!1;{const s=t.includes(i);return this.storeKnown(e.name,i),s}}}isManakinWithExplicitLog(e,...t){var i=this;return(0,Q._)((function*(){if(e instanceof $.iD)return i.storeKnown(e.name,e.experience),Promise.resolve(i._experimentClient.isGateEnabled(e));{const s=i._experimentClient.peekTreatment(e);if(null===s)return Promise.resolve(!1);try{yield i._experimentClient.logTreatment(e,s);const n=t.includes(s);return i.storeKnown(e.name,s),n}catch(e){}return!1}}))()}getManakinExperimentTreatment(e){const t=this._experimentClient.getTreatment(e);return null!==t&&this.storeKnown(e.name,t),t}peekManakinExperiment(e,...t){const i=this._experimentClient.peekTreatment(e);if(null===i)return!1;{const s=t.includes(i);return this.storeKnown(e.name,i),s}}constructor(e,t,i){(0,a._)(this,"_experimentClient",void 0),(0,a._)(this,"_experiments",void 0),(0,a._)(this,"_router",void 0),(0,a._)(this,"storeKnown",void 0),(0,a._)(this,"_knownExperiments",void 0),this._experimentClient=e,this._experiments=t,this._router=i,this.storeKnown=(e,t)=>{this._knownExperiments[e]||(this._knownExperiments[e]=t)},this._knownExperiments={},y.Bx.Logging.root.context.add({manakinExperiments:this._knownExperiments})}}class te{get _forceEligibleForFreeTrial(){return this._exp.isQuery("forceEligibleForFreeTrial")}get isEligibleForFreeTrial(){return!!this._forceEligibleForFreeTrial||!(!this._vitoClient.getFreeTrialForNewUsersEligibility()||!this._exp.peekManakinExperiment(x.PremiumFreeTrialForNewUsers,"test"))||!(!this._vitoClient.getFreeTrialEuUkEligibility()||!this._exp.peekManakinExperiment(x.PremiumFreeTrialEuUk,"test"))||this._vitoClient.getFreeTrialEligibility()}get isEligibleForFreeTrialEuUk(){return this._vitoClient.getFreeTrialEuUkEligibility()}get isOnFreeTrial(){return this._subscription.view((e=>J.j.isOk(e)&&Boolean(e.value.isOnTrial)))}get isOnProPlan(){return this._subscription.view((e=>J.j.isOk(e)&&!!e.value.proPlans&&!!e.value.currentPlan&&e.value.proPlans.some((t=>t.id===e.value.currentPlan.id))))}get showBusinessBanner(){return!this._institution.view(_.isSome).get()&&(this._router.query.has("gbBannerTesting")||!this.isInternalUser)}get isInternalUser(){return r.isGrammarlyUser(this._userProfile.get())||r.isTestUser(this._userProfile.get())}get trueUpSchedule(){return(0,c.pipe)(this._userProfile.get().institutionInfo,_.chain((e=>e.trueUpSchedule)))}get subscriptionIsLoaded(){return this._subscription.view((e=>J.j.isOk(e)))}get denaliUserType(){return this.isFree.get()?{type:o.Free}:this.isPremium.get()?this._instType.view(_.toNullable).view((e=>e===s.Business)).get()?this.isOnProPlan.get()?{type:o.Business,isPro:!0,institutionType:g.$v(this._instUserType.get())}:{type:o.Business,institutionType:g.$v(this._instUserType.get())}:this._instType.view(_.toNullable).view((e=>e===s.Edu)).get()?{type:o.Edu,institutionType:g.$v(this._instUserType.get())}:{type:o.Premium}:{type:o.Free}}onboardingMode(){const e=this._router.query.get("onboarding"),t=(0,c.pipe)(e,g.gR("show")),i=(0,c.pipe)(e,g.gR("hide")),s=this.denali.showOnboardingTourA11yUpdates,n=V.Content.Oggy;return t?{kind:V.Kind.Forced,content:this.denali.oggy===H.mergedSharedAssistant?V.Content.Oggy:V.Content.OggySplit}:i||r.isTestUser(this._userProfile.get())||this._isIPad?{kind:V.Kind.Hidden}:s?{kind:V.Kind.Standard,content:V.Content.WithoutInlineCards}:{kind:V.Kind.Standard,content:n}}get preventAnimation(){return(0,c.pipe)(this._router.query.get("preventAnimation"),_.exists((e=>"true"===e)))}get demoMode(){return _.isSome(this.denali.globalExperimentDemoText)}get track3rdPartyExtensionsInjection(){const e=this._router.query.get("3rdPartyExtensionsInjections"),t=_.exists((e=>"false"===e)),i=_.exists((e=>"true"===e));return!t(e)&&(Math.random()<.1||i(e))&&!r.isTestUser(this._userProfile.get())}get disableAppsPromotion(){return(0,c.pipe)(this._router.query.get("disableAppsPromotion"),_.exists((e=>"true"===e)))}get isSmartPlagiarismUphookEnabled(){return this._exp.peekManakinExperiment(x.PlagiarismUphook,"test")}get banners(){return this.disableAppsPromotion||!_.isNone(this._institution.get())&&!r.isBusiness(this.denaliUserType)?_.none:_.some(new z.BannersFeaturesImpl(this._userProfile,this._exp,this._settings,this._router,this.denaliUserType,this._isUserRegisteredBefore,this.denali.voxInfo,this._environment.info.browser,this.denali.llamaDiscoverabilityType))}get userRolePopup(){const e=new Date;e.setFullYear(e.getFullYear()-1);const t=this._userProfile.get().role,i=_.isNone(this._institution.get());return this._exp.isQuery("user_role_popup")?_.some(I.UserRolePopupMode.force):"msie"!==this._environment.info.browser&&i&&(_.isNone(t)||this._isUserRegisteredBefore(e)&&(0,c.pipe)(t,_.exists((e=>e===S.gG.school||e===S.j1.student))))?_.some(I.UserRolePopupMode.on):_.none}get lastSubscribedDateString(){return this._subscription.view((e=>J.j.isOk(e)&&void 0!==e.value.lastSubscribedDate?_.some(e.value.lastSubscribedDate):_.none))}get subscriptionCampaign(){return this._subscription.view((e=>J.j.isOk(e)&&void 0!==e.value.campaign?_.some(e.value.campaign):_.none))}get writingProgress(){return{enabled:this._exp.isQuery("learning_hub_mvp")||this._exp.isQuery("writing_progress_v2")||this._exp.isQuery("writing_progress_v3")||this._exp.isManakin(x.WritingProgress,"test")||this._exp.isManakin(x.WritingProgressV2,"test")||this._exp.isManakin(x.WritingProgressV3,"dashboard")||this._exp.isManakin(x.WritingProgressV3,"ipm")||r.isGrammarlyUser(this._userProfile.get())}}get goPremium(){return{enabled:this.isFree.get()}}get premiumBadge(){return{enabled:this.isPremium.get()}}get premiumCounter(){return{enabled:!this.isFree.get()}}get upgradeButton(){return{enabled:this.isFree.get()}}get trackWebVitals(){const e=this._router.query.get("webVitals");return this._environment.has(E.OH.Flag.supportsWebVitals)&&(0,c.pipe)(e,_.fold((()=>Math.random()<.01),(e=>"true"===e)))}get isReferralsEnabled(){return this._exp.isManakin(T.ReferralsGate,"enabled")?this._subscription.view((e=>{return J.j.isOk(e)&&!((i=e.value).isAppleSubscription||i.isGooglePlaySubscription)&&!!e.value.referralInfo.referralLink.key&&("OK"===(t=e.value.referralInfo).canReferUsersStatus||null!=t.referralHistory&&t.referralHistory.length>0);var t,i})):h.s.create(!1)}get proVsPremiumExperiment(){return!!this._exp.isQuery("grammarly_pro_m3")||this._exp.peekManakinExperiment(x.GrammarlyProM3V2,"test")}assignSmartPlagiarismUphookExperiment(){this._exp.getManakinExperimentTreatment(x.PlagiarismUphook)}get isLongFormPremiumFeedEnabled(){return this.denaliUserType.type===o.Free&&(this._exp.isQuery("long_form_premium_feed")||this._exp.peekManakinExperiment(x.LongFormPremiumFeed,"test"))}constructor(e,t,i,o,r,l,u,g,m){(0,a._)(this,"_experimentClient",void 0),(0,a._)(this,"_experiments",void 0),(0,a._)(this,"_subscription",void 0),(0,a._)(this,"_userProfile",void 0),(0,a._)(this,"_settings",void 0),(0,a._)(this,"_clientControls",void 0),(0,a._)(this,"_environment",void 0),(0,a._)(this,"_router",void 0),(0,a._)(this,"_vitoClient",void 0),(0,a._)(this,"_exp",void 0),(0,a._)(this,"_institution",void 0),(0,a._)(this,"_instUserFeature",void 0),(0,a._)(this,"_isUserRegisteredBefore",void 0),(0,a._)(this,"_nonInstUserFeature",void 0),(0,a._)(this,"isFree",void 0),(0,a._)(this,"isPremium",void 0),(0,a._)(this,"_isIPad",void 0),(0,a._)(this,"isMacEditor",void 0),(0,a._)(this,"instUserFeature",void 0),(0,a._)(this,"_instType",void 0),(0,a._)(this,"_instUserType",void 0),(0,a._)(this,"proofit",void 0),(0,a._)(this,"denali",void 0),(0,a._)(this,"proofitTest",void 0),(0,a._)(this,"proofitLastJob",void 0),(0,a._)(this,"plagiarism",void 0),(0,a._)(this,"tour",void 0),(0,a._)(this,"showChangeEmail",void 0),(0,a._)(this,"eduAdminPanelLink",void 0),(0,a._)(this,"appsSection",void 0),(0,a._)(this,"score",void 0),(0,a._)(this,"copyPasteMenuItems",void 0),(0,a._)(this,"quickReplacementsInCard",void 0),(0,a._)(this,"hideTitleInInstCard",void 0),(0,a._)(this,"showFullCards",void 0),(0,a._)(this,"defaultAcademicGenre",void 0),(0,a._)(this,"enableTrackingOnDownload",void 0),(0,a._)(this,"assignProVsPremiumExperiment",void 0),this._experimentClient=e,this._experiments=t,this._subscription=i,this._userProfile=o,this._settings=r,this._clientControls=l,this._environment=u,this._router=g,this._vitoClient=m,this._exp=new ee(this._experimentClient,this._experiments.get(),this._router),this._institution=this._userProfile.view("institutionInfo"),this._instUserFeature=this._institution.view((e=>({enabled:this._router.query.has("instType")||_.isSome(e)}))),this._isUserRegisteredBefore=e=>(0,c.pipe)(this._userProfile.get().registrationDate,_.exists((t=>t<e))),this._nonInstUserFeature=this._instUserFeature.view((e=>({enabled:!e.enabled}))),this.isFree=this._userProfile.view((e=>e.type===S.ut.free||this._router.query.has("isFree"))),this.isPremium=this._userProfile.view((e=>e.type===S.ut.premium&&!this._router.query.has("isFree"))),this._isIPad=this._environment.platform===E.OH.Platform.IPAD,this.isMacEditor=this._environment.platform===E.OH.Platform.MACEDITOR,this.instUserFeature=this._instUserFeature,this._instType=this._institution.view((e=>(0,c.pipe)(this._router.query.get("instType"),_.filter((e=>Object.values(s).indexOf(e)>=0)),_.fold((()=>(0,c.pipe)(e,_.map((e=>["BUSINESS","NGO","GOV"].includes(e.organizationType)?s.Business:s.Edu)))),_.some)))),this._instUserType=this._institution.view(_.map((e=>e.admin?n.Admin:n.Member))),this.proofit=this._isIPad?h.s.create(B.disabled):h.s.combine(this._subscription.view((e=>J.j.isOk(e)&&Boolean(e.value.paymentMethod))),this._userProfile,this.isFree,((e,{editorFeatures:{proofit:t}},i)=>this.demoMode?B.disabled:i&&!t?B.upgradeIsNeeded:t&&(e||this.isInternalUser||!_.isNone(this._institution.get()))?B.enabled:B.disabled)),this.denali=new X(this._userProfile,this._settings,this._clientControls,this._router,this._exp,this._environment,this._instType,this.proofit,this,this._isUserRegisteredBefore),this.proofitTest=(0,c.pipe)(this._router.query.get("proofit"),_.map(Y.c.stringToJobStatus)),this.proofitLastJob=(0,c.pipe)(this._router.query.get("proofitLastJob"),_.map(p.Local.create)),this.plagiarism=h.s.combine(this._userProfile,this.isFree,((e,t)=>this.demoMode?B.disabled:e.editorFeatures.plagiarismDisabled?t?this.isSmartPlagiarismUphookEnabled?B.enabled:B.upgradeIsNeeded:B.disabled:B.enabled)),this.tour=this._nonInstUserFeature,this.showChangeEmail=this._nonInstUserFeature,this.eduAdminPanelLink=this._institution.view((e=>({enabled:(0,c.pipe)(e,_.map((e=>e.admin)),_.getOrElse(d.constFalse))}))),this.appsSection=h.s.create({enabled:!this.disableAppsPromotion}),this.score=this._userProfile.view((e=>({enabled:!e.editorFeatures.scoreDisabled}))),this.copyPasteMenuItems={enabled:!0},this.quickReplacementsInCard=this._userProfile.view((e=>({enabled:e.editorFeatures.quickReplacement}))),this.hideTitleInInstCard=h.s.combine(this._institution,this._userProfile,((e,t)=>({enabled:!_.isSome(e)||!t.editorFeatures.quickReplacement}))),this.showFullCards=this._userProfile.view((e=>({enabled:e.editorFeatures.fullCards}))),this.defaultAcademicGenre=h.s.create({enabled:!1}),this.enableTrackingOnDownload=h.s.create(!1),this.assignProVsPremiumExperiment=()=>{this._exp.getManakinExperimentTreatment(x.GrammarlyProM3V2)},this.isFree&&m.requestSpecialOffersEligibility(["free_trial_rollout","free_trial_new_users","free_trial_eu_uk"])}}},62279:(e,t,i)=>{i.d(t,{gD:()=>y,fI:()=>ot,DJ:()=>s,jj:()=>ge,aF:()=>Pe,yk:()=>n,$0:()=>Ae,ru:()=>o,YT:()=>nt.Y});var s={};i.r(s),i.d(s,{FileMaxSize:()=>me,UploadModelImpl:()=>ye,UploadModelMock:()=>ve,ValidationError:()=>ae});var n={};i.r(n),i.d(n,{d:()=>De});var o={};i.r(o),i.d(o,{mV:()=>Ve});var r=i(23988),a=i(44297),l=i(60251),d=i(80074),c=i(80172),h=i(95074),u=i(78339),p=i(15491),_=i(46669),g=i(86562),m=i(81870),f=i(74056),v=i(98969),y=i(58687),b=i(14650);class w{getAppsItems(){return this._clientsState.supportedApps}onInstallClicked(e){this._handleInstallClick(e,"install")}onReInstallClicked(e){this._handleInstallClick(e,"reInstall")}onMoreClicked(e){this._telemetry.learnMoreClicked(this._appToTracking(e))}_handleInstallClick(e,t){b.X.App.isExtension(e)&&this._extension.install(),this._telemetry.installAppClicked(this._appToTracking(e),t)}_appToTracking(e){return e===b.X.App.extensionEdgeChromium?b.X.App.extensionEdge:e}constructor(e,t,i){(0,r._)(this,"_clientsState",void 0),(0,r._)(this,"_extension",void 0),(0,r._)(this,"_telemetry",void 0),this._clientsState=e,this._extension=t,this._telemetry=i}}var S=i(74194),x=i(97015),T=i(10334),k=i(17171),E=i(42543),P=i(65621),C=i(6987),D=i(54988),A=i(28600);const U="online";class O{setState({type:e,state:t}){this.onlineState.modify((i=>(0,k._)((0,T._)({},i),{[e]:t})))}_getNextOfflineKey(e){if("offline"===e.network.type)return"network";if(e.wsProtocol.type!==U)return"wsProtocol";if(e.dox.type!==U)return"dox";if(e.wsDox.type!==U)return"wsDox";if(e.wsCapi.type!==U)return"wsCapi";if("slow"===e.network.type)return"network";const t=Object.keys(e).find((t=>"online"!==e[t].type));if(Boolean(t))throw new g.zU(`Expected that state is online but got '${t}' is '${e[t].type}'`);return null}constructor(e){(0,r._)(this,"_handlers",void 0),(0,r._)(this,"_subscription",void 0),(0,r._)(this,"_dispose",void 0),(0,r._)(this,"onlineState",void 0),(0,r._)(this,"networkOnline",void 0),this._handlers=e,this._dispose=new E.B7,this.onlineState=d.s.create({network:{type:U},dox:{type:U},wsProtocol:{type:U},wsDox:{type:U},wsCapi:{type:U}}),this.networkOnline=this.onlineState.view((e=>"offline"!==e.network.type)),(0,g.V1)(!this._subscription,"ConnectivityModel already subscribed"),this.onlineState.pipe(P.J(),p.T((([e,t])=>{const i=this._getNextOfflineKey(e),s=this._getNextOfflineKey(t);return{prevKey:i,prevState:Boolean(i)?e[i]:{type:U},nextKey:s,nextState:Boolean(s)?t[s]:{type:U}}})),u.p((({prevKey:e,prevState:t,nextKey:i,nextState:s})=>e!==i||t.type!==s.type||null===i)),C.n((({nextKey:e,nextState:t})=>(this._dispose.next(),null===e||t.type===U?D.w:this._handlers[e].handle(t).pipe(A.Q(this._dispose)))))).subscribe()}}var M=i(95168),I=i(69063);class N{handle(e){switch(e.type){case"slow":return this._notificationsManager.enqueue("slowNetwork");case"offline":return this._notificationsManager.enqueue("offline",{reconnectTime:e.timer.reconnectTime}).pipe(u.p((e=>"reconnect"===e)),M.M(e.timer.resetClock));default:return(0,g.xb)(e)}}constructor(e){(0,r._)(this,"_notificationsManager",void 0),this._notificationsManager=e}}class B{handle(e){return this._log.debug(e.type),"offline"===e.type?this._notificationsManager.enqueue("connectionWSError"):(0,g.xb)(e.type)}constructor(e){(0,r._)(this,"_notificationsManager",void 0),(0,r._)(this,"_log",void 0),this._notificationsManager=e,this._log=I.Bx.Logging.getLogger("connectivity.wsProtocol")}}class F{handle(e){switch(this._log.debug(e.type),e.type){case"unauthorized":return R(this._notificationsManager,this._authentication,this._onUnauthorized);case"serverError":case"unknownConnectionError":return this._notificationsManager.enqueue("serverError");case"blockedByClient":return this._notificationsManager.enqueue("connectionWSError");case"clientConnectionError":return this._notificationsManager.enqueue("clientConnectionError");case"documentNotFoundError":return this._notificationsManager.enqueue("documentNotFoundError").pipe(u.p((e=>"navigateToDocuments"===e)),M.M(this._navigateToDocuments));default:return(0,g.xb)(e.type)}}constructor(e,t,i,s){(0,r._)(this,"_notificationsManager",void 0),(0,r._)(this,"_authentication",void 0),(0,r._)(this,"_navigateToDocuments",void 0),(0,r._)(this,"_onUnauthorized",void 0),(0,r._)(this,"_log",void 0),this._notificationsManager=e,this._authentication=t,this._navigateToDocuments=i,this._onUnauthorized=s,this._log=I.Bx.Logging.getLogger("connectivity.dox")}}class L{handle(e){switch(this._log.debug(e.type),e.type){case"offline":return this._notificationsManager.enqueue("checkingIsDown");case"unauthorized":return R(this._notificationsManager,this._authentication,this._onUnauthorized);default:return(0,g.xb)(e.type)}}constructor(e,t,i){(0,r._)(this,"_notificationsManager",void 0),(0,r._)(this,"_authentication",void 0),(0,r._)(this,"_onUnauthorized",void 0),(0,r._)(this,"_log",void 0),this._notificationsManager=e,this._authentication=t,this._onUnauthorized=i,this._log=I.Bx.Logging.getLogger("connectivity.capi")}}function R(e,t,i){return i(),e.enqueue("unauthorizedError").pipe(u.p((e=>"gotoLogin"===e)),M.M((()=>t.navigateToSigninOrRefresh()())))}var j=i(12884),H=i(5692),W=i(48581),G=i(21216),q=i(14342),V=i(65141),z=i(62822),Z=i(60269),X=i(68594),K=i(58347),Y=i(36840);const J={method:"HEAD",mode:"cors"};class Q{_stopTimer(){this._reconnectTimer&&(this._reconnectTimer.unsubscribe(),this._reconnectTimer=null)}_toSlow(e){return"online"===e?"slow":e}_toOnline(e){return"online"}_toSlowOrOnline(e){return"offline"===e?"online":e}_toOffline(e){return"offline"}constructor(e,t){(0,r._)(this,"_connectivity",void 0),(0,r._)(this,"_onlineTestUrl",void 0),(0,r._)(this,"_log",void 0),(0,r._)(this,"_online",void 0),(0,r._)(this,"_reconnectTimer",void 0),(0,r._)(this,"_timer",void 0),(0,r._)(this,"check",void 0),(0,r._)(this,"getOnlineStatus",void 0),(0,r._)(this,"checkOnlineStatus",void 0),(0,r._)(this,"_startReconnectTimer",void 0),(0,r._)(this,"_setOnline",void 0),(0,r._)(this,"_setOffline",void 0),(0,r._)(this,"_checkRequest",void 0),this._connectivity=e,this._onlineTestUrl=t,this._log=I.Bx.Logging.getLogger("networkConnectivity"),this._online=d.s.create("online"),this.check=(0,Y.p)((()=>this._checkRequest().then(this._setOnline).catch((()=>{this._log.debug("Online check failed, switching to offline state"),this._setOffline(this.check)})))),this.getOnlineStatus=()=>this._online.get(),this.checkOnlineStatus=()=>this.check().then(this.getOnlineStatus),this._startReconnectTimer=e=>{this._stopTimer();const t=d.s.create(10);this._reconnectTimer=j.Y(1e3).subscribe((()=>{t.get()<=1&&e&&e(),t.modify((e=>e<=1?10:e-1))})),this._timer={resetClock:()=>{t.set(10),e&&e()},reconnectTime:t}},this._setOnline=()=>{this._stopTimer(),this._online.modify(this._toSlowOrOnline)},this._setOffline=e=>{"offline"!==this._online.get()&&(this._startReconnectTimer(e),this._online.modify(this._toOffline))},this._checkRequest=()=>H.j.promiseWithTimeout(W.pM.nativeFetch()(`${this._onlineTestUrl}?_=${Date.now()}`,J),5e3),this._online.subscribe((e=>{switch(e){case"online":this._log.debug("Switch back to online state"),this._connectivity.setState({type:"network",state:{type:"online"}});break;case"slow":this._connectivity.setState({type:"network",state:{type:"slow"}});break;case"offline":this._connectivity.setState({type:"network",state:{type:"offline",timer:this._timer}});break;default:(0,g.xb)(e)}})),this._online.pipe(u.p((e=>"slow"!==e)),C.n((e=>"offline"===e?D.w:W.pM.requestResults.pipe(u.p((e=>"timeoutWarn"===e.type&&void 0!==e.target)),M.M((()=>{this._online.modify(this._toSlow)})),C.n((()=>G.of(!1).pipe(q.c(W.pM.FETCH_TIMEOUT)))))))).subscribe((()=>this._online.modify(this._toOnline))),V.R(window,"online").subscribe(this._setOnline),V.R(window,"offline").pipe(z.u(void 0)).subscribe(this._setOffline),this._online.pipe(C.n((e=>"offline"===e?W.pM.requestResults.pipe(u.p((e=>"success"===e.type))):Z.h(W.pM.requestResults.pipe(u.p((({type:e,target:t})=>void 0!==t&&("clientError"===e||"timeoutWarn"===e||"timeoutError"===e)))),this._connectivity.onlineState.pipe(X.i(1),u.p((({dox:e,wsDox:t,wsCapi:i})=>"online"!==i.type||"online"!==e.type||"online"!==t.type)))))),K.B(1e3)).subscribe(this.check)}}class ${setState({type:e,state:t}){this._wsState.modify((i=>(0,k._)((0,T._)({},i),{[e]:t})))}_wasChanged(e,t,i){return e[i].type!==t[i].type}constructor(e,t){(0,r._)(this,"_connectivity",void 0),(0,r._)(this,"_wsHandlers",void 0),(0,r._)(this,"_wsState",void 0),(0,r._)(this,"_getChangedState",void 0),(0,r._)(this,"_handleStateChange",void 0),this._connectivity=e,this._wsHandlers=t,this._wsState=d.s.create({wsDox:{type:U},wsCapi:{type:U}}),this._getChangedState=([e,t])=>{const i=Object.keys(e).find((i=>this._wasChanged(e,t,i)));return(0,g.V1)(!!i,"WsState must be changed"),{type:i,state:t[i]}},this._handleStateChange=({type:e,state:t})=>{t.type===U?this._connectivity.setState({type:e,state:{type:"online"}}):this._wsHandlers[e].handle(t)},this._wsState.pipe(P.J(),p.T(this._getChangedState)).subscribe(this._handleStateChange)}}var ee=i(1717),te=i(80029);class ie extends g.eo{constructor(...e){super(...e),(0,r._)(this,"name",void 0),(0,r._)(this,"reason",void 0)}}class se{constructor(e,t){(0,r._)(this,"networkState",void 0),(0,r._)(this,"connectivity",void 0),(0,r._)(this,"checkWs",void 0),(0,r._)(this,"_wsTest",void 0),(0,r._)(this,"_checkOnline",void 0),this.networkState=e,this.connectivity=t,this.checkWs=()=>"offline"===this.networkState.getOnlineStatus()?Promise.resolve():this._wsTest().catch(this._checkOnline),this._wsTest=()=>Promise.race([new Promise(((e,t)=>{const i=(0,Y.mn)((0,te.W)().api.wsTest);if(!Boolean(i))throw new ie("Socket is not accessible");i.onmessage=()=>{try{i.close(),e()}catch(e){t(e)}},i.onerror=e=>t(e)})),(1e4,(0,Y.cb)(1e4).then((()=>{throw new ee.M})))]),this._checkOnline=()=>this.networkState.checkOnlineStatus().then((e=>"offline"===e?Promise.resolve():Promise.reject(new ie("Websocket test failed while network test passed"))))}}class ne extends se{handle(e){switch(e.type){case"unknownConnectionError":case"clientConnectionError":case"blockedByClient":this.checkWs().then((()=>this.connectivity.setState({type:"wsDox",state:{type:e.type}}))).catch((()=>{this.connectivity.setState({type:"wsProtocol",state:{type:"offline"}})}));break;case"serverError":case"unauthorized":case"documentNotFoundError":this.connectivity.setState({type:"wsDox",state:{type:e.type}});break;default:(0,g.xb)(e.type)}}}class oe extends se{handle(e){switch(e.type){case"offline":this.checkWs().then((()=>this.connectivity.setState({type:"wsCapi",state:{type:e.type}}))).catch((()=>this.connectivity.setState({type:"wsProtocol",state:{type:"offline"}})));break;case"unauthorized":this.connectivity.setState({type:"wsCapi",state:{type:e.type}});break;default:(0,g.xb)(e.type)}}}var re,ae,le=i(10047),de=i(63336),ce=i(80837),he=i(92051),ue=i(29052),pe=i(77396),_e=i(36644),ge=i(78018);!function(e){e.clientError="clientError",e.serverError="serverError"}(re||(re={})),function(e){e.documentTypeUnsupported="documentTypeUnsupported",e.documentIsEmpty="documentIsEmpty",e.documentSizeExceeded="documentSizeExceeded",e.noFileToUpload="noFileToUpload",e.onlyOneDocumentAllowed="onlyOneDocumentAllowed"}(ae||(ae={}));const me=4194304,fe=()=>H.j.defaultValue(),ve=()=>({upload:()=>Promise.resolve([]),navigated:Y.Yi,state:d.s.create(H.j.defaultValue()),uploadingCount:d.s.create(0),dispose:Y.Yi});class ye{dispose(){this._subs.dispose()}upload(e){this._inBackground=!1;const{files:t,notify:i,allowMultiple:s,isDragNDrop:n}=e,o=this._validateFiles(t,s);return o.length<=0?(this._state.set(fe()),Promise.resolve([])):(this._state.modify(H.j.begin),this._uploadingCount.set(o.length),(0,de.pipe)(o.map((e=>(0,de.pipe)(ue.TX((()=>{try{return this._upload(e)}catch(e){return Promise.reject(e)}}),(e=>{const t=(e=>({kind:re.serverError,error:e}))(e);return this._state.modify(H.j.fatal(t)),t})),ue.Tj((t=>({id:String(t.id),uploadedFileType:e.type||"UNKNOWN_FILE_TYPE",uploadedFileName:e.name||"UNKNOWN_FILE_NAME"})))))),le.YO.sequence(ue.bP),ue.Tj((e=>(this._telemetry.gnarSpec.uploadDocumentFormSubmit(n,!0,this._telemetry.pageId),(0,_e.Wd)({source:"upload"}),this._state.modify(H.j.success({navigateTo:e.length>1||e.length!==t.length?a.none:(0,le.d5)(e),notify:i})),this._state.set(fe()),this._uploadingCount.set(0),e))),pe.hq,(e=>e.catch((()=>[])))))}navigated(){this._inBackground=!0}_handleServerError({error:e}){const t=e=>this._telemetry.gnarSpec.uploadDocumentFormSubmit(!1,!1,this._telemetry.pageId,e,"serverError");return e instanceof h.hB.FileSizeOutOfRangeError?(t(ae.documentSizeExceeded),this._notificationsManager.enqueue("documentSizeExceeded",{os:this._environment.info.os,officeAddinUrl:""})):e instanceof h.hB.EmptyFileError?(t(ae.documentIsEmpty),this._notificationsManager.enqueue("documentIsEmpty")):e instanceof h.hB.UnsupportedFileTypeError?(t(ae.documentTypeUnsupported),this._notificationsManager.enqueue("documentTypeUnsupported")):e instanceof h.hB.TrackedChangesIsUnsupported?(t(e.message),this._notificationsManager.enqueue("trackedChangesIsUnsupported",{link:this._config.support.documentAcceptTrackedChanges})):e instanceof h.hB.TooManyRequestsError?(t(e.message),this._notificationsManager.enqueue("error")):(t(e.message),I.Bx.Logging.getLogger("document.upload").error("uploadDocument failed",e),this._notificationsManager.enqueue("documentUploadGeneralError"))}_handleClientError({errorType:e}){switch(this._telemetry.gnarSpec.uploadDocumentFormSubmit(!1,!1,this._telemetry.pageId,ae[e],re.clientError),e){case ae.documentTypeUnsupported:return this._notificationsManager.enqueue("documentTypeUnsupported");case ae.documentIsEmpty:return this._notificationsManager.enqueue("documentIsEmpty");case ae.documentSizeExceeded:return this._notificationsManager.enqueue("documentSizeExceeded",{os:this._environment.info.os,officeAddinUrl:""});case ae.noFileToUpload:return this._notificationsManager.enqueue("noFileToUpload");case ae.onlyOneDocumentAllowed:return this._notificationsManager.enqueue("oneDocumentIsAllowed");default:return(0,g.xb)(e)}}_emitClientError(e){this._state.modify(H.j.error((e=>({kind:re.clientError,errorType:e}))(e)))}_validateFiles(e,t){return e.length<=0?(this._emitClientError(ae.noFileToUpload),[]):!t&&e.length>1?(this._emitClientError(ae.onlyOneDocumentAllowed),[]):(i=e,Array.from(i)).reduce(((e,t)=>{var i;return Boolean((i=t.name)&&ge.$G.some((e=>i.toLowerCase().endsWith(e))))?t.size?t.size>me?this._emitClientError(ae.documentSizeExceeded):e.push(t):this._emitClientError(ae.documentIsEmpty):this._emitClientError(ae.documentTypeUnsupported),e}),[]);var i}constructor(e,t,i,s,n,o){(0,r._)(this,"_upload",void 0),(0,r._)(this,"_navigateToDocument",void 0),(0,r._)(this,"_telemetry",void 0),(0,r._)(this,"_notificationsManager",void 0),(0,r._)(this,"_environment",void 0),(0,r._)(this,"_config",void 0),(0,r._)(this,"_state",void 0),(0,r._)(this,"_uploadingCount",void 0),(0,r._)(this,"_inBackground",void 0),(0,r._)(this,"_subs",void 0),(0,r._)(this,"state",void 0),(0,r._)(this,"uploadingCount",void 0),this._upload=e,this._navigateToDocument=t,this._telemetry=i,this._notificationsManager=s,this._environment=n,this._config=o,this._state=d.s.create(fe()),this._uploadingCount=d.s.create(0),this._inBackground=!1,this._subs=new ce.y.Keeper,this.state=this._state.view(),this.uploadingCount=this._uploadingCount.view(),this._subs.push(this._state.pipe(u.p((e=>H.j.isTerminated(e)||H.j.isError(e))),he.ZZ((e=>{if(H.j.isOk(e)){const{navigateTo:t,notify:i}=e.value,s=(0,de.pipe)(t,a.fold((()=>Y.Yi),(e=>()=>this._navigateToDocument(e.id,{uploadedFileType:e.uploadedFileType,uploadedFileName:e.uploadedFileName,openSidebar:!0,showDocumentUploadedNotification:i}))));if(this._inBackground&&a.isSome(t))return this._notificationsManager.enqueue("documentUploaded").pipe(u.p((e=>"navigateToDocument"===e)),M.M(s));s()}else{if(H.j.isFatal(e))return this._handleServerError(e.error);if(H.j.isError(e))return this._handleClientError(e.error)}return D.w}))).subscribe())}}var be=i(18711),we=i(16843);const Se=Object.values(be),xe=Object.values(we);var Te=i(83531),ke=i(63403);class Ee{install(){var e=this;return(0,Te._)((function*(){switch(e._environment.info.browser){case"firefox":return ke.vL((0,te.W)().domains.cookie),window.location.href=e._firefoxUrl,!0;case"chrome":case"safari":case"edge":return!0;default:throw new TypeError("Unexpected input in browser variable: "+e._environment.info.browser)}}))()}constructor(e,t){(0,r._)(this,"_environment",void 0),(0,r._)(this,"_firefoxUrl",void 0),this._environment=e,this._firefoxUrl=t}}var Pe=i(76901),Ce=i(16432);class De{getNotInstalledAppsCount(){return this._clientsState.getAsArray().filter(b.X.isNotInstalled).length}isAppsVisible(){return this._appsSection&&this._getSupportedAppsCount()>0}isMyGrammarlyVisible(){return!this._clientsState.isEditorBlocked}_getSupportedAppsCount(){return this._clientsState.getAsArray().filter(b.X.isSupported).length}constructor(e,t,i){(0,r._)(this,"features",void 0),(0,r._)(this,"_clientsState",void 0),(0,r._)(this,"brandingSet",void 0),(0,r._)(this,"_appsSection",void 0),this.features=e,this._clientsState=t,this.brandingSet=i,this._appsSection=this.features.appsSection.get().enabled}}var Ae=i(89096),Ue=i(19711),Oe=i(35413),Me=i(68533),Ie=i(36094),Ne=i(82718),Be=i(7323),Fe=i(88423),Le=i(68745),Re=i(24946),je=i(83541),He=i(79711);const We=new Set(["error","selfUpdate","unauthorizedError"]);class Ge{enqueue(e,t){return(We.has(e)?this._isDenali:this._isDenali.pipe(Ue.$())).pipe(C.n((i=>Boolean(i)?this._denaliNotification(e,t):this._editorTsNotification(e,t))))}_denaliNotification(e,t){return this._appManager.enqueue(e,t)}_editorTsNotification(e,t){const[i,s]=this._convertToLegacy(e,t);let n;const o="error"===i.severity;return Oe.v((()=>(n=this._editorTsNotifications.show(i),o?s.pipe(Me.h(this._overlayReady.pipe(C.n(Ie._F.rafScheduler),Ue.$(),M.M((()=>{this._overlay.show()})),Ne.K(Be.t)))):s))).pipe(Fe.j((()=>{o&&this._overlay.hide(),this._editorTsNotifications.hide(n),s.next("closedByUser")})))}_convertToLegacy(e,t){const i=new Le.t("shown"),s=e=>()=>{i.next(e)};switch(e){case"unauthorizedError":return[this._editorTsNotifications.create.unauthorizedError(),i];case"offline":return[this._editorTsNotifications.create.offline(s("reconnect"),t.reconnectTime),i];case"serverError":return[this._editorTsNotifications.create.serverError(),i];case"connectionWSError":return[this._editorTsNotifications.create.connectionWSError(),i];case"clientConnectionError":return[this._editorTsNotifications.create.clientConnectionError(),i];case"documentNotFoundError":return[this._editorTsNotifications.create.documentNotFoundError(s("navigateToDocuments")),i];case"selfUpdate":return[this._editorTsNotifications.create.selfUpdate(),i];case"slowNetwork":return[this._editorTsNotifications.create.slowNetwork(),i];case"checkingIsDown":return[this._editorTsNotifications.create.checkingIsDown(),i];case"error":return[this._editorTsNotifications.create.error(),i];case"proofitPaymentDeclinedError":return[this._editorTsNotifications.create.proofitPaymentDeclinedError(t.paymentMethod),i];case"proofitEmptyDocumentError":return[this._editorTsNotifications.create.proofitEmptyDocumentError(),i];case"proofitDocumentProofreadError":return[this._editorTsNotifications.create.proofitDocumentProofreadError(s("navigateToDocuments")),i];case"proofitComplexInternalStructureError":return[this._editorTsNotifications.create.proofitComplexInternalStructureError(s("navigateToDocuments")),i];case"textRemoved":return[this._editorTsNotifications.create.textRemoved(s("undo"),s("closedByUser")),i];case"copyToClipboardFailed":return[this._editorTsNotifications.create.copyToClipboardFailed(),i];case"proofitCancelled":return[this._editorTsNotifications.create.proofitCancelled(),i];case"proofitCompleted":const n=t;return[this._editorTsNotifications.create.proofitCompleted(n.email,n.documentTitle,n.documentDownloadUrl),i];case"denaliDocumentUploaded":return[this._editorTsNotifications.create.denaliDocumentUploaded(s("navigateToDocuments")),i];case"alertsNothingFound":return[this._editorTsNotifications.create.alertsNothingFound(),i];case"documentSizeExceeded":return[this._editorTsNotifications.create.documentSizeExceeded(),i];case"documentUploaded":return[this._editorTsNotifications.create.documentUploaded(s("navigateToDocument")),i];case"documentTypeUnsupported":return[this._editorTsNotifications.create.documentTypeUnsupported(),i];case"trackedChangesIsUnsupported":return[this._editorTsNotifications.create.trackedChangesIsUnsupported(),i];case"documentUploadGeneralError":return[this._editorTsNotifications.create.documentUploadGeneralError(),i];case"documentIsEmpty":return[this._editorTsNotifications.create.documentIsEmpty(),i];case"noFileToUpload":return[this._editorTsNotifications.create.noFileToUpload(),i];case"oneDocumentIsAllowed":return[this._editorTsNotifications.create.oneDocumentIsAllowed(),i];case"downloadDocumentNotFoundError":return[this._editorTsNotifications.create.downloadDocumentNotFoundError(),i];case"isTemporaryDownloadError":return[this._editorTsNotifications.create.isTemporaryDownloadError(),i];case"safari12EndSupport":return[this._editorTsNotifications.create.safari12EndSupport(),i];case"alertUndo":case"cardMuteOnboarding":case"switchToDenali":case"feedbackSend":case"statisticsError":case"copySuccess":case"clipboardNotSupported":case"premiumOnboardingSurvey":case"paymentSuccess":case"paymentError":case"changePlanCta":case"premiumUngatingRenewal":case"denaliFormattingCompatibility":case"gbBillingMigration":case"gbSatisfactionSurvey":case"safariExtActivation":case"obtainGrades":case"citationStyleChange":case"changePlanSuccess":case"gbRuleCreated":throw new Error(`${e} notification does not have legacy notification analog`);default:return(0,g.xb)(e)}}constructor(e,t,i,s){(0,r._)(this,"_router",void 0),(0,r._)(this,"_editorTsNotifications",void 0),(0,r._)(this,"_overlay",void 0),(0,r._)(this,"state",void 0),(0,r._)(this,"_appManager",void 0),(0,r._)(this,"_isDenali",void 0),(0,r._)(this,"_overlayReady",void 0),this._router=e,this._editorTsNotifications=i,this._overlay=s,this._isDenali=this._router.isActive(m.Lz.routes.denali_editor.href({docId:"*"})),this._overlayReady=this._overlay.state.pipe(X.i(1),Re.s(1),je.shareReplay({refCount:!0})),this._appManager=(0,He.M)(t),this.state=this._appManager.state,this._overlayReady.subscribe(),this._isDenali.subscribe((()=>{this.state.modify((e=>e.filter((e=>We.has(e.type)))))}))}}class qe{dismiss(){this._cancel()}remind(){this._cancel()}cancel(){this._cancel()}_cancel(){this._dismissStream.next(!1)}shown(){}constructor(){(0,r._)(this,"_dismissStream",new E.B7),(0,r._)(this,"getBannerState",void 0)}}class Ve extends qe{install(){this.cancel(),Boolean(this._id)&&this._goToDocument(this._id)}constructor(e,t){super(),(0,r._)(this,"_proofit",void 0),(0,r._)(this,"_goToDocument",void 0),(0,r._)(this,"_id",void 0),(0,r._)(this,"_proofitStream",void 0),(0,r._)(this,"state",void 0),this._proofit=e,this._goToDocument=t,this._proofitStream=this._proofit.pipe(M.M((({id:e})=>this._id=e)),p.T((({id:e})=>null!==e))),this.state=this._dismissStream.pipe(Me.h(this._proofitStream),_.F())}}var ze=i(30040),Ze=i(31113),Xe=i(36735),Ke=i(89769),Ye=i(90405),Je=i(59183),Qe=i(58889),$e=i(58193);const et={currentVersion:"1.5.43-0",minimalVersion:"1.0.0-0"};var tt;!function(e){e[e.hardWebUpdate=0]="hardWebUpdate"}(tt||(tt={}));class it{watchForIdleState(e,t){return this.watch(e.pipe(Xe.c(3e3),C.n((()=>je.timer(this._config.selfUpdate.canReloadCheckInterval).pipe(z.u(!0),Ke.Z(!1))))),t)}watch(e,t){return this._canReloadSemaphore.watch(this._shouldUpdate.pipe(Ue.$(),Ne.K(e),Ke.Z(!0)),t)}_getVersion(e){const t=d.s.create(H.j.defaultValue());H.j.OperationRetrier.create((()=>W.pM.request({target:"self_update",cache:this._environment.has(f.OH.Flag.useForceNoCacheOption)?"no-cache":"default"})(e.versionFilePath,{credentials:"include"}).then((e=>e.json()))),t,H.j.OperationRetrier.RetryStrategy.linear(e.retryFailedVersionCheckLimit,e.retryFailedVersionCheckInterval)),t.pipe(u.p(H.j.isTerminated),Ue.$()).toPromise().then((e=>{if(H.j.isFatal(e))throw e.error;this._versions.set((0,T._)({},et,e.value))})).catch((e=>this._logger.warn("getVersion failed",e)))}_listenWebUpdates(e){const t=this._environment.buildVersion.toString();(0,g.V1)("unknown"!==t,"Unknown build versions");const i="auto"===this._selfUpdateConfig.debugBuildVersion?t:this._selfUpdateConfig.debugBuildVersion;this._versions.pipe(X.i(1)).subscribe((t=>{this._handleWebUpdate(e,i,t,this._selfUpdateConfig)})),this.watch(this._onlineState.view((e=>"online"===e.network.type)),"online"),this.watchForIdleState(this._userActivity.generalActivity,"generalActivity")}_handleWebUpdate(e,t,i,s){const{currentVersion:n,minimalVersion:o}=i;if((0,Ze.lt)(t,n)){const i=(0,Ze.lt)(t,o),n=i?0:s.selfUpdateDelay,r=()=>{V.R(document,"visibilitychange").pipe(Ke.Z(void 0),p.T((()=>document.hidden)),C.n((e=>e?this._canReloadSemaphore.state.pipe(C.n(Ie.vh(je.timer(s.canReloadCheckInterval)))):D.w))).subscribe(e.forceReloadCurrentLocation)},a=()=>{this._canReloadSemaphore.state.pipe(C.n((e=>e?je.timer(s.canReloadCheckInterval).pipe(M.M((()=>this._displayNotification(tt.hardWebUpdate))),C.n((()=>je.timer(s.blockingModalAutoReloadDelay)))):D.w))).subscribe(e.forceReloadCurrentLocation)};if(!this._isUpdateInProgress||i){const t=i?"hard":"soft";this._logger.info(`scheduled.${t}`),this._isUpdateInProgress=!0,this._shouldUpdate.next(),je.timer(n).subscribe((()=>{this._logger.info(`started.${t}`),e.scheduleReloadOnNavigation(),r(),i&&a()}))}}}_listenNotificationState(){return this._onlineState.view("network","type").pipe(p.T((e=>"offline"!==e)),C.n(Ie.vh(this._currentNotificationType)),Ye.oE,C.n(this._createNotificationByType))}constructor(e,t,i,s,n,o){(0,r._)(this,"_config",void 0),(0,r._)(this,"_onlineState",void 0),(0,r._)(this,"_userActivity",void 0),(0,r._)(this,"_environment",void 0),(0,r._)(this,"_notificationsManager",void 0),(0,r._)(this,"_subs",void 0),(0,r._)(this,"_logger",void 0),(0,r._)(this,"_versions",void 0),(0,r._)(this,"_isUpdateInProgress",void 0),(0,r._)(this,"_shouldUpdate",void 0),(0,r._)(this,"_canReloadSemaphore",void 0),(0,r._)(this,"_selfUpdateConfig",void 0),(0,r._)(this,"_currentNotificationType",void 0),(0,r._)(this,"_createNotificationByType",void 0),(0,r._)(this,"_displayNotification",void 0),this._config=t,this._onlineState=i,this._userActivity=s,this._environment=n,this._notificationsManager=o,this._subs=new ce.y.Keeper,this._logger=I.Bx.Logging.getLogger("selfUpdate"),this._versions=d.s.create(et),this._isUpdateInProgress=!1,this._shouldUpdate=new E.B7,this._canReloadSemaphore=new Je.p.Impl("selfUpdate"),this._selfUpdateConfig=this._config.selfUpdate,this._currentNotificationType=d.s.create(a.none),this._createNotificationByType=e=>e===tt.hardWebUpdate?this._notificationsManager.enqueue("selfUpdate"):(0,g.xb)(e),this._displayNotification=e=>{this._currentNotificationType.modify((0,ze.flow)(Qe.fromPredicate($e.Lw((t=>e>t)),ze.identity),Qe.fold(ze.identity,(()=>a.some(e)))))},this._subs.push(this._listenNotificationState().subscribe()),this._listenWebUpdates(e),j.Y(this._selfUpdateConfig.versionCheckInterval).subscribe((()=>this._getVersion(this._selfUpdateConfig))),(0,Y.hJ)("setVersionJSON",(e=>{this._versions.set(e)}))}}class st{watchForIdleState(){return ce.y.EMPTY}watch(){return ce.y.EMPTY}}i(37107),i(40464);var nt=i(1424);class ot{get userAccount(){if(!this._unsafeUserAccount)throw new g.zU("User should be already authenticated");return this._unsafeUserAccount}get navigationBar(){return this._navigationBar=this._navigationBar||new De(this.userAccount.features,this.clientsState,this.userAccount.entitlements.view(a.chain(v.b.getBrandingSet)))}get documentsPage(){return this._documentsPage=Boolean(this._documentsPage)?this._documentsPage:new ge.rv(this._persistentApp.appState.lens("documentsPage"),this._doxApi,this._doxWSApi,this.userAccount.settings,this.connectivity,this.editorTsNotifications,this._navigateToDocument,this._router)}get documentUpload(){if(!this._unsafeUserAccount)throw new g.zU("User should be already authenticated");return this._documentUpload=Boolean(this._documentUpload)?this._documentUpload:new ye((e=>this.documentsPage.actions.uploadDocument(e,h.Jo.UploadFileMode.plain)),this._navigateToDocument.bind(this),this.telemetry,this.notificationsManager,this._environment,this._config)}get clientsState(){return new b.X.Impl(this._environment,this.userAccount)}get apps(){return new w(this.clientsState,this.extension,this.telemetryLegacy)}get banners(){return this._banners=Boolean(this._banners)?this._banners:new x.VF(this.clientsState,this.extension,this.userAccount.features.banners,this.userAccount.settings.updateBanners.bind(this.userAccount.settings))}get modals(){return new Ce.XH(this.userAccount.settings)}get upgradeHook(){const e=this._nullableUserAccount;if(void 0===e.get())throw new g.zU("User should be already authenticated");return this._upgradeHook=this._upgradeHook||new nt.Y.Impl(this._config,this._environment,e.view("userProfile","id"),e.view("userProfile","type"))}constructor(e,t,i,s,n,o,a,h,g,v,b,w,x,T,k,E,P,C,D,A,U){(0,r._)(this,"_persistentApp",void 0),(0,r._)(this,"_authApi",void 0),(0,r._)(this,"_dapi",void 0),(0,r._)(this,"_institution",void 0),(0,r._)(this,"_treatmentService",void 0),(0,r._)(this,"_gateService",void 0),(0,r._)(this,"_subscriptionApi",void 0),(0,r._)(this,"_doxApi",void 0),(0,r._)(this,"_doxWSApi",void 0),(0,r._)(this,"_settingsRegistryApi",void 0),(0,r._)(this,"telemetryLegacy",void 0),(0,r._)(this,"telemetry",void 0),(0,r._)(this,"_config",void 0),(0,r._)(this,"_router",void 0),(0,r._)(this,"userActivity",void 0),(0,r._)(this,"_environment",void 0),(0,r._)(this,"_platformEnvironment",void 0),(0,r._)(this,"fingerprints",void 0),(0,r._)(this,"backendManagedStorageManager",void 0),(0,r._)(this,"_vitoClient",void 0),(0,r._)(this,"_passportClient",void 0),(0,r._)(this,"gnarSpec",void 0),(0,r._)(this,"isReady",void 0),(0,r._)(this,"_nullableUserAccount",void 0),(0,r._)(this,"_userAccount",void 0),(0,r._)(this,"_navigateToDocument",void 0),(0,r._)(this,"editorTsNotifications",void 0),(0,r._)(this,"_unsafeUserAccount",void 0),(0,r._)(this,"modal",void 0),(0,r._)(this,"overlay",void 0),(0,r._)(this,"notificationsManager",void 0),(0,r._)(this,"experimentClient",void 0),(0,r._)(this,"_onUnauthorized",void 0),(0,r._)(this,"authentication",void 0),(0,r._)(this,"_navigationBar",void 0),(0,r._)(this,"_documentsPage",void 0),(0,r._)(this,"_documentUpload",void 0),(0,r._)(this,"_banners",void 0),(0,r._)(this,"connectivity",void 0),(0,r._)(this,"networkState",void 0),(0,r._)(this,"wsConnectivity",void 0),(0,r._)(this,"selfUpdate",void 0),(0,r._)(this,"extension",void 0),(0,r._)(this,"apis",void 0),(0,r._)(this,"_upgradeHook",void 0),this._persistentApp=e,this._authApi=t,this._dapi=i,this._institution=s,this._treatmentService=n,this._gateService=o,this._subscriptionApi=a,this._doxApi=h,this._doxWSApi=g,this._settingsRegistryApi=v,this.telemetryLegacy=b,this.telemetry=w,this._config=x,this._router=T,this.userActivity=k,this._environment=E,this._platformEnvironment=P,this.fingerprints=C,this.backendManagedStorageManager=D,this._vitoClient=A,this._passportClient=U,this.gnarSpec=this.telemetry.gnarSpec,this.isReady=d.s.create(!1),this._nullableUserAccount=this._persistentApp.appState.lens("userAccount"),this._userAccount=this._nullableUserAccount.pipe(u.p((e=>null!==e)),p.T((e=>e))),this._navigateToDocument=(e,t)=>{this._router.navigate(m.Lz.routes.editor.href({docId:e}),t)},this.editorTsNotifications=new Ae.kU(this._persistentApp.appState.lens("editorTsNotifications")),this._unsafeUserAccount=null,this.modal=new Pe.Rs(this._persistentApp.appState.lens("modal"),this.editorTsNotifications),this.overlay=new Pe.LF(this._persistentApp.appState.lens("overlay")),this.notificationsManager=new Ge(this._router,this._config,this.editorTsNotifications,this.overlay),this.experimentClient=new l.Re(this._treatmentService,Se,this._gateService,xe),this._onUnauthorized=()=>this._persistentApp.invalidate("Unauthorized"),this.authentication=new S.EL(this._persistentApp.appState.lens("authentication"),this._authApi,this._dapi,this._institution,this.experimentClient,this._settingsRegistryApi,this._passportClient,((e,t)=>{this._nullableUserAccount.set(e),this._unsafeUserAccount=new y.Aj(this._nullableUserAccount,this._subscriptionApi,this._authApi,this._dapi,this.experimentClient,e.clientControls,this._router,this._config,this._environment,this._platformEnvironment,this.upgradeHook,this.modal,this.overlay,t,this._vitoClient,(()=>this._persistentApp.invalidate("Logout"))),this.isReady.set(!0)}),this.telemetry,new c.W6(this._config.domains.cookie),this._environment,(()=>this._persistentApp.invalidate("Auth error"))),this._navigationBar=null,this.connectivity=new O({network:new N(this.notificationsManager),wsProtocol:new B(this.notificationsManager),dox:new F(this.notificationsManager,this.authentication,(()=>this._router.navigate(m.Lz.routes.documents.href())),this._onUnauthorized),wsDox:new F(this.notificationsManager,this.authentication,(()=>this._router.navigate(m.Lz.routes.documents.href())),this._onUnauthorized),wsCapi:new L(this.notificationsManager,this.authentication,this._onUnauthorized)}),this.networkState=new Q(this.connectivity,this._config.api.onlineTestUrl),this.wsConnectivity=new $(this.connectivity,{wsDox:new ne(this.networkState,this.connectivity),wsCapi:new oe(this.networkState,this.connectivity)}),this.selfUpdate=Boolean(this._environment.has(f.OH.Flag.supportsSelfUpdate))?new it(this._router,this._config,this.connectivity.onlineState,this.userActivity,this._environment,this.notificationsManager):new st,this.extension=new Ee(this._environment,this._config.extension.firefox.installURL),this.apis={dox:this._doxApi,doxWS:this._doxWSApi},this._upgradeHook=null,this._userAccount.pipe(_.F(((e,t)=>e.userProfile.id===t.userProfile.id))).subscribe((({userProfile:{id:e,isTest:t,type:i},experiments:s})=>{w.bootstrap.setUser(e,i,"test"===this._config.tracking.state||t,s)}))}}},76901:(e,t,i)=>{i.d(t,{LF:()=>r,Rs:()=>o,n6:()=>n});var s=i(23988);const n={visible:!1,opts:{type:null}};class o{show(e){this._state.set({visible:!0,opts:e})}hide(){this._state.set(n)}constructor(e,t){(0,s._)(this,"_state",void 0),(0,s._)(this,"editorTsNotifications",void 0),(0,s._)(this,"state",void 0),this._state=e,this.editorTsNotifications=t,this.state=this._state.view()}}class r{show(){this._state.set({visible:!0})}hide(){this._state.set({visible:!1})}constructor(e){(0,s._)(this,"_state",void 0),(0,s._)(this,"state",void 0),this._state=e,this.state=this._state.view()}}},16432:(e,t,i)=>{i.d(t,{QN:()=>o,QS:()=>n,XH:()=>m,q3:()=>s});var s,n,o,r=i(23988),a=i(10334),l=i(17171),d=i(80074),c=i(68594),h=i(40027),u=i(86562),p=i(22835),_=i(36840);function g(e,t,i){return t.filter((t=>e(t)!==i))}!function(e){e.UserRole="userRole",e.SignOut="signOut",e.PremiumTopFeatures="premiumTopFeatures",e.ClientsComparison="clientsComparison",e.GrammarlyGoOnboarding="grammarlyGoOnboarding"}(s||(s={})),function(e){e.empty={dismiss:[],later:[],shown:[]}}(n||(n={})),function(e){e.Shown="shown",e.Dismiss="dismiss",e.Later="later"}(o||(o={}));class m{initialize(e){this._modals.set(e)}notHidden(e){return function(e,t){return!Boolean(e.dismiss.find((e=>e===t)))&&!e.later.find((e=>e.type===t&&e.expire>Date.now()))}(this._modals.get(),e)}notLater(e){return function(e,t){return!e.later.find((e=>e.type===t))}(this._modals.get(),e)}dispatch(e,t){switch(t.type){case o.Dismiss:return this._updateState({later:g((e=>e.type),this._modals.get().later,e),dismiss:[...g((e=>e),this._modals.get().dismiss,e),e]});case o.Shown:return this._updateState({shown:[...g((e=>e),this._modals.get().shown,e),e]});case o.Later:return this._updateState({later:[...g((e=>e.type),this._modals.get().later,e),{type:e,expire:Date.now()+t.expire}]});default:(0,u.xb)(t)}}_updateState(e){this._modals.modify((t=>p.yo(t,e)))}constructor(e){(0,r._)(this,"_settings",void 0),(0,r._)(this,"_modals",void 0),this._settings=e,this._modals=d.s.create(n.empty),(0,_.hJ)("resetModals",(()=>{this._settings.updateModals({shown:[],later:[],dismiss:[]})})),(0,_.hJ)("remindModal",(e=>{const t=this._settings.modals.get();this._settings.updateModals((0,l._)((0,a._)({},t),{later:[...t.later.filter((t=>t.type!==e)),{type:e,expire:Date.now()}]}))})),this._modals.pipe(c.i(1),h.Z(100)).subscribe((e=>{Boolean(this._settings)&&this._settings.updateModals(e)}))}}},79711:(e,t,i)=>{i.d(t,{M:()=>d});var s=i(10334),n=i(80074),o=i(78126),r=i(55101),a=i(13435),l=i(39032);function d(e){const t=n.s.create([]),i=(0,s._)({},{alertUndo:o.S.createBuilder().build({priority:r.E.Priority.low,timeout:r.E.DefaultTimeout,position:r.E.Position.bottomRight,viewType:r.E.ViewType.custom}),textRemoved:o.S.createBuilder().build({priority:r.E.Priority.average,timeout:r.E.DefaultTimeout,position:r.E.Position.bottomRight,viewType:r.E.ViewType.standard}),cardMuteOnboarding:o.S.createBuilder().build({priority:r.E.Priority.low,timeout:r.E.TimeoutDisabled,position:r.E.Position.bottomRight,viewType:r.E.ViewType.custom}),premiumOnboardingSurvey:o.S.createBuilder().build({priority:r.E.Priority.lowest,timeout:r.E.TimeoutDisabled,position:r.E.Position.bottomRight,viewType:r.E.ViewType.custom}),changePlanCta:o.S.createBuilder().build({priority:r.E.Priority.average,position:r.E.Position.bottomRight,viewType:r.E.ViewType.custom,timeout:r.E.TimeoutDisabled}),gbBillingMigration:o.S.createBuilder().build({priority:r.E.Priority.average,position:r.E.Position.bottomRight,viewType:r.E.ViewType.custom,timeout:r.E.TimeoutDisabled}),changePlanSuccess:o.S.createBuilder().build({priority:r.E.Priority.low,timeout:r.E.DefaultTimeout,position:r.E.Position.bottomRight,viewType:r.E.ViewType.standard}),premiumUngatingRenewal:o.S.createBuilder().build({priority:r.E.Priority.average,position:r.E.Position.bottomRight,viewType:r.E.ViewType.custom,timeout:r.E.TimeoutDisabled}),gbSatisfactionSurvey:o.S.createBuilder().build({priority:r.E.Priority.lowest,timeout:r.E.TimeoutDisabled,position:r.E.Position.bottomRight,viewType:r.E.ViewType.custom}),safariExtActivation:o.S.createBuilder().build({priority:r.E.Priority.average,timeout:r.E.TimeoutDisabled,position:r.E.Position.bottomRight,viewType:r.E.ViewType.custom}),obtainGrades:o.S.createBuilder().build({priority:r.E.Priority.average,timeout:r.E.TimeoutDisabled,position:r.E.Position.bottomRight,viewType:r.E.ViewType.custom}),citationStyleChange:o.S.createBuilder().build({priority:r.E.Priority.low,timeout:r.E.DefaultTimeout,position:r.E.Position.bottomRight,viewType:r.E.ViewType.standard}),gbRuleCreated:o.S.createBuilder().build({priority:r.E.Priority.lowest,timeout:r.E.TimeoutDisabled,position:r.E.Position.bottomRight,viewType:r.E.ViewType.custom}),safari12EndSupport:o.S.createBuilder().build({priority:r.E.Priority.average,timeout:r.E.TimeoutDisabled,position:r.E.Position.top,viewType:r.E.ViewType.standard})},l.E.createFactory());return new a.i(t,i,e.maxNotificationsOnTheScreen,e.notificationShowTimeMs)}},37107:(e,t,i)=>{i.d(t,{$u:()=>$,CH:()=>Y,Jf:()=>z,Ks:()=>K,L0:()=>R,RM:()=>G,Z4:()=>Z,ZJ:()=>ie,Zb:()=>ne,pK:()=>X,tl:()=>Q,uD:()=>W,wq:()=>oe,xR:()=>H});var s=i(83531),n=i(23988),o=i(10334),r=i(17171),a=i(69384),l=i(87485),d=i(30040),c=i(63336),h=i(96797),u=i(83308),p=i(56621),_=i(80074),g=i(45887),m=i(63724),f=i(44781),v=i(89011),y=i(75363),b=i(5692),w=i(1717),S=i(83194),x=i(86562),T=i(44297),k=i(58889),E=i(23121),P=i(47370),C=i(34717),D=i(22835),A=i(77396),U=i(58193),O=i(29052),M=i(36840),I=i(69063),N=i(80029),B=i(31373),F=i(16432);const L=(0,N.W)();var R,j,H,W,G,q,V,z,Z,X,K,Y,J,Q,$,ee,te;!function(e){e.ProofitPromo="proofit_promo",e.FreeClarityAlertsEnabled="free_clarity_alerts",e.FreeClarityAlertsControl="free_clarity_alerts_control",e.PremiumOnboarding="premium_onboarding",e.GBSatisfaction="gb_satisfaction",e.MostActiveUsers="most_active_users"}(R||(R={})),function(e){e.SuperScrollWithAutoJump="super_scroll_with_auto_jump",e.SuperScrollWithoutAutoJump="super_scroll_without_auto_jump"}(j||(j={})),function(e){e.AccountCreation="accountCreation",e.Tour="tour",e.TryWebsite="tryWebsite",e.ViewApps="viewApps",e.CustomizeSettings="customizeSettings"}(H||(H={})),function(e){e.UnlockPremium="unlockPremium",e.TopFeatures="topFeatures",e.ExploreAllProducts="exploreAllProducts"}(W||(W={})),function(e){e.HardDismiss="hardDismiss",e.SoftDismiss="softDismiss"}(G||(G={})),function(e){e.mapBySurveyType=function(e,t,i,s,n){switch(e){case R.ProofitPromo:return t(e);case R.FreeClarityAlertsEnabled:case R.FreeClarityAlertsControl:case R.MostActiveUsers:return i(e);case R.PremiumOnboarding:return s(e);case R.GBSatisfaction:return n(e);default:return(0,x.xb)(e)}}}(q||(q={})),function(e){e.Work="work",e.StrongTeams="strongTeams",e.StepUp="stepUp",e.FreeStyleGuide="freeStyleGuide",e.EveryTeammate="everyTeammate",e.Expensing="expensing",e.ViewPerformance="viewPerformance",e.ForWorkTrial="forWorkTrial",e.PremiumStyleGuide="premiumStyleGuide"}(V||(V={})),function(e){e.wordsCount="wordsCount",e.charsCount="charsCount",e.readingTime="readingTime",e.speakingTime="speakingTime",e.readabilityScore="readabilityScore"}(z||(z={})),function(e){e.Normal="Normal",e.Large="Large"}(Z||(Z={})),(Z||(Z={})).match=(e,t)=>i=>{switch(i){case Z.Normal:return e;case Z.Large:return t;default:return(0,x.xb)(i)}},function(e){e.Default="Default",e.Accessible="Accessible"}(X||(X={})),function(e){e.RTF="rtf",e.PDF="pdf",e.ProofitClarity="proofitClarity",e.MutedAlerts="mutedAlerts",e.Trash="trash",e.VersionHistory="versionHistory"}(K||(K={})),function(e){e.smbSpecificProfessionalism="smbSpecificProfessionalism",e.styleGuides="styleGuides"}(Y||(Y={})),function(e){e.prefix="cheetah",e.propertyName="onboardingState:editor"}(J||(J={})),function(e){var t=e.empty={firstCall:!1,seenWelcome:!1,suppressedWelcome:!1,dialectStrong:T.none,dialectWeak:T.none,banners:{dismiss:new Set,shown:new Set,later:new Set,cancelled:new Set},modals:F.QS.empty,businessBanner:{latestCloseTime:T.none,closed:[]},denaliLens:{},onboardingPassed:new Set,[J.propertyName]:p.V.State.empty,showExitNotification:!0,showSetGoalsLoader:!0,seenDenaliWelcome:!1,seenSignOutSurvey:!1,footerCounterType:z.wordsCount,editorPreferences:{autoScrollToNextAlert:T.none,fontSize:Z.Normal,suggestionsVisualMode:X.Default},survey:{},news:new Set,changePlanHook:{latestDismissAt:T.none,latestAppearances:[]},gbBannersUpHook:{[Y.smbSpecificProfessionalism]:{latestAppearances:[],latestDismissAt:T.none,dismissesCount:0},[Y.styleGuides]:{latestAppearances:[],latestDismissAt:T.none,dismissesCount:0}},dunningSettings:{dunningDismissCount:0,latestDismissAt:T.none},gbBillingMigrationSettings:{latestDismissAt:T.none},dunning_billing_status:T.none,featuresOnboardingSeen:new Set,ungated_trial_end_date:T.none,ungatedRenewalNotificationSettings:{latestAppearance:T.none,wasDismissed:!1},memberInviteOnboardingPassed:!1,safariDeactivatedWeb:!1,safariDeactivatedNative:!1,seenSafariExtNotification:!1,supportUkraineCardAppearanceCount:0,getStartedChecklistSettings:{dismissal:T.none,completedItems:new Set([H.AccountCreation])},getStartedPremiumChecklistSettings:{dismissal:T.none,completedItems:new Set([W.UnlockPremium])},llamaDiscoverabilitySettings:{modalDismissalTimestamp:T.none,bannerDismissalTimestamp:T.none},firstSeenTrashBin:T.none},i=e.extensionAutoCitationsBanners=g.n(["chrome-autoCitations","edge-chromium-autoCitations","safari-autoCitations","firefox-autoCitations"]),s=e.llamaBanners=g.n(["llama-mac-download-banner","llama-windows-download-banner"]),n=e.llamaPopups=g.n(["llama-mac-download-popup","llama-windows-download-popup"]),o=e.extensionBanners=g.n(["safari-extension","firefox-extension","chrome-extension","edge-extension","edge-chromium-extension",...i]),r=e.extensionAutoCitationsPopups=g.n(["chrome-autoCitations-popup","edge-chromium-autoCitations-popup","safari-autoCitations-popup","firefox-autoCitations-popup"]),a=e.extensionAppPopups=g.n(["chrome-popup","safari-popup","firefox-popup","edge-popup","edge-chromium-popup"]);e.isExtensionAutoCitationsPopup=function(e){return r.some((t=>t===e))};var l=e.extensionPopups=g.n([...a,...r]),d=e.gbBanners=g.n(["invite-members","style-guide","true-up"]),_=e.deDeprecationPopup="de-deprecation-popup",m=e.deDeprecationBanner="de-deprecation-banner";const b=g.n(["desktop-windows","desktop-mac",_,m]);var w=e.banners=g.n(["campaign-end","proofit-cancelled","proofit-completed","mobile-keyboard",...d,...o,...l,...s,...n,...b]);const S=g.Z.literalUnion("banner",w);var x=e.bannersType=h.qO({dismiss:g.Z.set(S),shown:g.Z.set(S),later:g.Z.fallback(g.Z.set(h.qO({type:S,expire:h.ai})),new Set),cancelled:g.Z.fallback(g.Z.set(S),new Set)});const P=h.zz(h.Yj,h.OH({dismissAllCounter:h.ai,important:h.zM})),C=g.Z.properties({firstCall:g.Z.withDefault(h.zM,t.firstCall),seenWelcome:g.Z.withDefault(h.zM,t.seenWelcome),suppressedWelcome:g.Z.withDefault(h.zM,t.suppressedWelcome),dialectStrong:g.Z.option(y.p.dialectType),dialectWeak:g.Z.option(y.p.dialectType),banners:g.Z.withDefault(x,t.banners),denaliLens:g.Z.fallback(P,t.denaliLens),onboardingPassed:g.Z.fallback(g.Z.set(g.Z.createStringEnum(v.E.StepId,"Onboarding")),t.onboardingPassed),showExitNotification:g.Z.withDefault(h.zM,t.showExitNotification)},"","legacyProps"),D=g.Z.properties({dunning_billing_status:g.Z.fallback(g.Z.option(h.Yj),t.dunning_billing_status),ungated_trial_end_date:g.Z.option(g.Z.date()),memberInviteOnboardingPassed:g.Z.fallback(h.zM,t.memberInviteOnboardingPassed),safariDeactivatedWeb:g.Z.fallback(h.zM,t.safariDeactivatedWeb),safariDeactivatedNative:g.Z.fallback(h.zM,t.safariDeactivatedNative),firstSeenTrashBin:g.Z.option(h.ai)},"","sharedProps"),A=h.qO({counter:h.ai,actual:h.zM,wasClosedAt:g.Z.option(g.Z.date())}),U=g.Z.properties({businessBanner:g.Z.withDefault(h.NW({latestCloseTime:g.Z.fallback(g.Z.option(h.ai),t.businessBanner.latestCloseTime),closed:g.Z.fallback(h.QZ(g.Z.createStringEnum(V,"string")),t.businessBanner.closed)}),t.businessBanner),modals:g.Z.withDefault(h.qO({dismiss:h.YO(g.Z.createStringEnum(F.q3,"string")),shown:h.YO(g.Z.createStringEnum(F.q3,"string")),later:h.YO(h.qO({expire:h.ai,type:g.Z.createStringEnum(F.q3,"string")}))}),t.modals),seenDenaliWelcome:g.Z.withDefault(h.zM,t.seenDenaliWelcome),seenSignOutSurvey:g.Z.withDefault(h.zM,t.seenSignOutSurvey),showSetGoalsLoader:g.Z.withDefault(h.zM,t.showSetGoalsLoader),footerCounterType:g.Z.fallback(g.Z.createStringEnum(z,"string"),z.wordsCount),editorPreferences:g.Z.fallback(h.NW({autoScrollToNextAlert:g.Z.fallback(g.Z.option(h.zM),t.editorPreferences.autoScrollToNextAlert),fontSize:g.Z.fallback(g.Z.createStringEnum(Z,"FontSize"),t.editorPreferences.fontSize),suggestionsVisualMode:g.Z.fallback(g.Z.createStringEnum(X,"SuggestionsVisualMode"),t.editorPreferences.suggestionsVisualMode)}),t.editorPreferences),survey:g.Z.fallback(h.OH({[R.FreeClarityAlertsEnabled]:A,[R.FreeClarityAlertsControl]:A,[R.ProofitPromo]:h.qO({actual:h.zM})}),t.survey),news:g.Z.fallback(g.Z.set(g.Z.createStringEnum(K,"NewsItemId")),t.news),changePlanHook:g.Z.fallback(h.qO({latestAppearances:h.YO(g.Z.date()),latestDismissAt:g.Z.option(g.Z.date())}),t.changePlanHook),gbBannersUpHook:g.Z.fallback(h.NW({[Y.smbSpecificProfessionalism]:h.qO({latestAppearances:h.YO(g.Z.date()),latestDismissAt:g.Z.option(g.Z.date()),dismissesCount:h.ai}),[Y.styleGuides]:h.qO({latestAppearances:h.YO(g.Z.date()),latestDismissAt:g.Z.option(g.Z.date()),dismissesCount:h.ai})}),t.gbBannersUpHook),dunningSettings:g.Z.fallback(h.qO({dunningDismissCount:h.ai,latestDismissAt:g.Z.option(g.Z.date())}),t.dunningSettings),gbBillingMigrationSettings:g.Z.fallback(h.qO({latestDismissAt:g.Z.option(g.Z.date())}),t.gbBillingMigrationSettings),featuresOnboardingSeen:g.Z.fallback(g.Z.set(g.Z.createStringEnum(f.k,"FeatureOnboardingItemId")),t.featuresOnboardingSeen),ungatedRenewalNotificationSettings:g.Z.fallback(h.qO({latestAppearance:g.Z.option(g.Z.date()),wasDismissed:h.zM}),t.ungatedRenewalNotificationSettings),seenSafariExtNotification:g.Z.fallback(h.zM,t.seenSafariExtNotification),supportUkraineCardAppearanceCount:g.Z.fallback(h.ai,t.supportUkraineCardAppearanceCount),llamaDiscoverabilitySettings:g.Z.fallback(h.qO({modalDismissalTimestamp:g.Z.option(g.Z.date()),bannerDismissalTimestamp:g.Z.option(g.Z.date())}),t.llamaDiscoverabilitySettings),getStartedChecklistSettings:g.Z.fallback(h.qO({dismissal:g.Z.option(h.qO({type:g.Z.createStringEnum(G,"GetStartedChecklistDismissalType"),timestamp:g.Z.date()})),completedItems:g.Z.set(g.Z.createStringEnum(H,"GetStartedItemType"))}),t.getStartedChecklistSettings),getStartedPremiumChecklistSettings:g.Z.fallback(h.qO({dismissal:g.Z.option(h.qO({type:g.Z.createStringEnum(G,"GetStartedChecklistDismissalType"),timestamp:g.Z.date()})),completedItems:g.Z.set(g.Z.createStringEnum(W,"GetStartedPremiumItemType"))}),t.getStartedPremiumChecklistSettings)},"DN","namespacedProps"),O=g.Z.fallback(p.V.codec,p.V.State.empty),M=g.Z.properties({[J.propertyName]:O},J.prefix,"cheetahProps");var N=e.dapiPropsCodec=g.Z.combineProperties([C,D,U,M]);e.parse=function(...e){try{return(0,c.pipe)(N.decode(e),k.mapLeft(u.V2),k.mapLeft((e=>(I.Bx.Logging.getLogger("model.settings.parse").warn("fail",e),e))),k.getOrElse((()=>t)))}catch(e){return I.Bx.Logging.getLogger("model.settings.parse").error("fail",e),t}},e.serialize=function(e){return E.zb((()=>N.encode(e)))}}(Q||(Q={})),function(e){e.eq=P.OW({fontSize:P.w_,suggestionsVisualMode:P.w_,autoScrollToNextAlert:T.getEq(P.zF)})}($||($={})),function(e){e.pruneDapiProperties=function(e){return(0,r._)((0,o._)({},e),{survey:e.survey&&(t=e.survey,l.LV((e=>Object.values(R).includes(e)))(t))});var t}}(ee||(ee={})),function(e){e.create=(e,t,i={})=>s=>({error:s,currentSettings:t,newSettings:i,source:e})}(te||(te={}));class ie{markFeatureOnboarded(e){return this.featuresOnboardingSeen.modify((t=>{const i=new Set(t);return i.add(e),i})),this._setProperty({featuresOnboardingSeen:this.featuresOnboardingSeen.get()},!1).catch((t=>{this._log.warn(`Cannot mark onboarding as complete for feature ${e}`,t)}))}getSurveyModel(e){return this._userSettings.view("survey",e).view(T.fromNullable)}setSurveyModel(e,t){return this._userSettings.lens("survey").lens(e).set(t),this._setProperty({survey:this._userSettings.lens("survey").get()},!1).catch((e=>{this._log.warn("Cannot update survey",e)}))}markNewsItemsAsSeen(e){const t=new Set(this.newsSeen.get());return e.forEach((e=>t.add(e))),this._setProperty({news:t},!1)}incrementDunningDismissCount(){return this._setProperty({dunningSettings:{dunningDismissCount:(0,B.J)(this.dunningSettings.get())?1:this.dunningSettings.view("dunningDismissCount").get()+1,latestDismissAt:T.some(C.Local.now())}},!1)}supportUkraineCardSeen(){const e=this._userSettings.lens("supportUkraineCardAppearanceCount").get();return this._setProperty({supportUkraineCardAppearanceCount:e+1},!1)}trashBinSeen(){return this._setProperty({firstSeenTrashBin:T.some(C.xW.Timestamp.now())},!1)}_setProperty(e,t=!0,i){return b.j.modifyRemoteStateOptimistic(this._userSettings,D.JP(e),(()=>A.hq(this._sync(e,i)).catch((e=>{const{error:t}=e,i=(0,a._)(e,["error"]);throw this._log.handler("dapiError: save failed",i).warn(t),e}))),t)}firstCallDone(){return this._setProperty({firstCall:!0},!1).catch((e=>{e instanceof w.M?this._log.warn("Cannot set first call as done",e):this._log.error("Cannot set first call as done",e)}))}setDialect(e){return this._setProperty({dialectStrong:T.some(e)}).then((t=>e))}setDialectWeak(e){return this._setProperty({dialectWeak:T.some(e)}).then((t=>e))}updateFooterCounterType(e){return this._setProperty({footerCounterType:e},!1).catch((e=>this._log.warn("Cannot update footer counter type",e)))}welcomeTourSeen(){return this._setProperty({seenWelcome:!0},!1).catch((e=>this._log.warn("Cannot mark welcome tour as looked",e)))}denaliWelcomeTourSeen(){return this._setProperty({seenDenaliWelcome:!0},!1).catch((e=>this._log.warn("Cannot mark denali welcome tour as seen",e)))}markSignOutSurveySeen(){return this._setProperty({seenSignOutSurvey:!0},!1).catch((e=>this._log.warn("Cannot mark signOut survey as seen",e)))}updateBusinessBanner(e){return this._setProperty({businessBanner:e}).catch((e=>{e instanceof w.M?this._log.warn("Cannot update business banner state",e):this._log.error("Cannot update business banner state",e)}))}updateBanners(e){return this._setProperty({banners:e}).catch((t=>{t instanceof w.M?this._log.warn("Cannot update banners state",t,e):this._log.error("Cannot update banners state",t,e)}))}updateModals(e){return this._setProperty({modals:e}).catch((t=>{t instanceof w.M?this._log.warn("Cannot update modals state",t,e):this._log.error("Cannot update modals state",t,e)}))}toggleMarkAsImportant(e,t){const i=Object.assign({},this.denaliLens.get());return i[e]=Object.assign({},i[e],{important:t}),this._setProperty({denaliLens:Object.assign({},i)},!1)}dismissAll(e){var t,i;const s=Object.assign({},this.denaliLens.get());var n;return s[e]=Object.assign({},s[e],{dissmissAllCounter:Math.sqrt((n=Boolean(null===(t=s[e])||void 0===t?void 0:t.dismissAllCounter)?null===(i=s[e])||void 0===i?void 0:i.dismissAllCounter:0,1+(Boolean(n)?n*n:1)))}),this._setProperty({denaliLens:Object.assign({},s)},!1)}updateOnboardingPassed(e){const t=new Set(this._userSettings.get().onboardingPassed),i=t.size;return e.forEach((e=>t.add(e))),i===t.size?Promise.resolve():this._setProperty({onboardingPassed:t},!1)}updateCheetahOnboardingState(e){var t=this;return(0,s._)((function*(){const i=t._userSettings.get()[J.propertyName],s=(0,o._)({},p.V.State.toClientState(i,"editor"),e),n=p.V.State.patch(s,"editor")(i);return t._setProperty({[J.propertyName]:n},!1,{keepalive:!0}).catch((e=>{const{error:i}=e,s=(0,a._)(e,["error"]);t._log.handler("Cannot set remote Cheetah onboardingState",s).warn(i)}))}))()}updateExitNotification(e){return this._setProperty({showExitNotification:e},!1).catch((e=>{this._log.warn("Cannot set showExitNotification",e)}))}updateSetGoalsLoader(e){return this._setProperty({showSetGoalsLoader:e},!1).catch((e=>{this._log.warn("Cannot set showSetGoalsLoader",e)}))}updateEditorPreferences(e){return this._setProperty({editorPreferences:e},!1).catch((e=>{this._log.warn("Cannot update Editor Preferences",e)}))}changePlanHookSeen(){const{latestAppearances:e,latestDismissAt:t}=Object.assign({},this.changePlanHook.get());return e.push(C.Local.now()),this._setProperty({changePlanHook:{latestDismissAt:t,latestAppearances:e.slice(-3)}},!1).catch((e=>this._log.warn("Cannot add appearance of change plan hook",e)))}dismissChangePlanHook(){const{latestAppearances:e}=Object.assign({},this.changePlanHook.get());return this._setProperty({changePlanHook:{latestDismissAt:T.some(C.Local.now()),latestAppearances:e}},!1).catch((e=>this._log.warn("Cannot set latest dismiss time of change plan hook",e)))}gbUpHookSeen(e){const t=this.gbBannersUpHook.get(),{[e]:i}=t,{latestAppearances:s}=i;return this._setProperty({gbBannersUpHook:(0,r._)((0,o._)({},t),{[e]:(0,r._)((0,o._)({},i),{latestAppearances:[...s,C.Local.now()].slice(-3)})})},!1).catch((e=>this._log.warn("Cannot set latest dismiss time of change plan hook",e)))}dismissGBUpHook(e){const t=this.gbBannersUpHook.get(),{[e]:i}=t;return this._setProperty({gbBannersUpHook:(0,r._)((0,o._)({},t),{[e]:(0,r._)((0,o._)({},i),{latestDismissAt:T.some(C.Local.now()),dismissesCount:i.dismissesCount+1})})},!1).catch((e=>this._log.warn("Cannot set latest dismiss time of change plan hook",e)))}ungatedRenewalNotificationDismissed(){return this._setProperty({ungatedRenewalNotificationSettings:{latestAppearance:T.some(C.Local.now()),wasDismissed:!0}},!1).catch((e=>this._log.warn("Cannot set ungated notification dismiss status",e)))}ungatedRenewalNotificationSeen(){return this._setProperty({ungatedRenewalNotificationSettings:{latestAppearance:T.some(C.Local.now()),wasDismissed:!1}},!1).catch((e=>this._log.warn("Cannot set ungated notification seen time",e)))}dismissGBBillingMigrationNotification(){return this._setProperty({gbBillingMigrationSettings:{latestDismissAt:T.some(C.Local.now())}},!1).catch((e=>this._log.warn("Cannot update gb billing migration notification dismiss time",e)))}markSafariExtNotificationSeen(){return this._userSettings.get().seenSafariExtNotification?(this._log.error("Tried to mark SafariExtNotification as seen repeatedly."),Promise.resolve()):this._setProperty({seenSafariExtNotification:!0},!1).catch((e=>this._log.warn("Cannot set seenSafariExtNotification",e)))}updateGetStartedChecklistSettings(e){const t=this._userSettings.get().getStartedChecklistSettings,i=(0,o._)({},t,e);return this._setProperty({getStartedChecklistSettings:i},!1).catch((e=>this._log.warn("Unable to update getStartedChecklistSettings",e)))}updateGetStartedPremiumChecklistSettings(e){const t=this._userSettings.get().getStartedPremiumChecklistSettings,i=(0,o._)({},t,e);return this._setProperty({getStartedPremiumChecklistSettings:i},!1).catch((e=>this._log.warn("Unable to update getStartedPremiumChecklistSettings",e)))}updateLlamaDiscoverabilitySettings(e){const t=this._userSettings.get().llamaDiscoverabilitySettings,i=(0,o._)({},t,e);return this._setProperty({llamaDiscoverabilitySettings:i},!1).catch((e=>this._log.warn("Unable to update llamaDiscoverabilitySettings",e)))}constructor(e,t,i){(0,n._)(this,"_userSettings",void 0),(0,n._)(this,"_dapi",void 0),(0,n._)(this,"_userId",void 0),(0,n._)(this,"_log",void 0),(0,n._)(this,"firstCall",void 0),(0,n._)(this,"dialect",void 0),(0,n._)(this,"dialectOrDefault",void 0),(0,n._)(this,"firstSeenTrashBin",void 0),(0,n._)(this,"seenWelcome",void 0),(0,n._)(this,"seenDenaliWelcome",void 0),(0,n._)(this,"seenSignOutSurvey",void 0),(0,n._)(this,"suppressedWelcome",void 0),(0,n._)(this,"banners",void 0),(0,n._)(this,"modals",void 0),(0,n._)(this,"businessBanner",void 0),(0,n._)(this,"denaliLens",void 0),(0,n._)(this,"onboardingPassed",void 0),(0,n._)(this,"showExitNotification",void 0),(0,n._)(this,"enableSetGoalsLoader",void 0),(0,n._)(this,"footerCounterType",void 0),(0,n._)(this,"editorPreferences",void 0),(0,n._)(this,"newsSeen",void 0),(0,n._)(this,"dunningSettings",void 0),(0,n._)(this,"dunningStatus",void 0),(0,n._)(this,"gbBillingMigrationSettings",void 0),(0,n._)(this,"changePlanHook",void 0),(0,n._)(this,"gbBannersUpHook",void 0),(0,n._)(this,"featuresOnboardingSeen",void 0),(0,n._)(this,"ungatedTrialEndDate",void 0),(0,n._)(this,"ungatedRenewalNotificationSettings",void 0),(0,n._)(this,"memberInviteOnboardingPassed",void 0),(0,n._)(this,"safariDeactivatedWeb",void 0),(0,n._)(this,"safariDeactivatedNative",void 0),(0,n._)(this,"seenSafariExtNotification",void 0),(0,n._)(this,"supportUkraineCardAppearanceCount",void 0),(0,n._)(this,"getStartedChecklistSettings",void 0),(0,n._)(this,"getStartedPremiumChecklistSettings",void 0),(0,n._)(this,"llamaDiscoverabilitySettings",void 0),(0,n._)(this,"cheetahOnboardingState",void 0),(0,n._)(this,"_saveToDapi",void 0),(0,n._)(this,"_syncRemote",void 0),(0,n._)(this,"_syncLocal",void 0),(0,n._)(this,"_sync",void 0),this._userSettings=e,this._dapi=t,this._userId=i,this._log=I.Bx.Logging.getLogger("model.settings"),this.firstCall=this._userSettings.lens("firstCall"),this.dialect=this._userSettings.view((e=>(0,c.pipe)(e.dialectStrong,U.NW(e.dialectWeak)))),this.dialectOrDefault=this.dialect.view(T.fold((()=>L.defaultDialect),(e=>e))),this.firstSeenTrashBin=this._userSettings.lens("firstSeenTrashBin"),this.seenWelcome=this._userSettings.lens("seenWelcome"),this.seenDenaliWelcome=this._userSettings.lens("seenDenaliWelcome"),this.seenSignOutSurvey=this._userSettings.lens("seenSignOutSurvey"),this.suppressedWelcome=this._userSettings.lens("suppressedWelcome"),this.banners=this._userSettings.lens("banners"),this.modals=this._userSettings.lens("modals"),this.businessBanner=this._userSettings.lens("businessBanner"),this.denaliLens=this._userSettings.lens("denaliLens"),this.onboardingPassed=this._userSettings.lens("onboardingPassed"),this.showExitNotification=this._userSettings.lens("showExitNotification"),this.enableSetGoalsLoader=this._userSettings.lens("showSetGoalsLoader"),this.footerCounterType=this._userSettings.lens("footerCounterType"),this.editorPreferences=this._userSettings.lens("editorPreferences"),this.newsSeen=this._userSettings.lens("news"),this.dunningSettings=this._userSettings.lens("dunningSettings"),this.dunningStatus=this._userSettings.lens("dunning_billing_status"),this.gbBillingMigrationSettings=this._userSettings.lens("gbBillingMigrationSettings"),this.changePlanHook=this._userSettings.lens("changePlanHook"),this.gbBannersUpHook=this._userSettings.lens("gbBannersUpHook"),this.featuresOnboardingSeen=this._userSettings.lens("featuresOnboardingSeen"),this.ungatedTrialEndDate=this._userSettings.lens("ungated_trial_end_date"),this.ungatedRenewalNotificationSettings=this._userSettings.lens("ungatedRenewalNotificationSettings"),this.memberInviteOnboardingPassed=this._userSettings.lens("memberInviteOnboardingPassed"),this.safariDeactivatedWeb=this._userSettings.view("safariDeactivatedWeb"),this.safariDeactivatedNative=this._userSettings.view("safariDeactivatedNative"),this.seenSafariExtNotification=this._userSettings.view("seenSafariExtNotification"),this.supportUkraineCardAppearanceCount=this._userSettings.view("supportUkraineCardAppearanceCount"),this.getStartedChecklistSettings=this._userSettings.lens("getStartedChecklistSettings"),this.getStartedPremiumChecklistSettings=this._userSettings.lens("getStartedPremiumChecklistSettings"),this.llamaDiscoverabilitySettings=this._userSettings.lens("llamaDiscoverabilitySettings"),this.cheetahOnboardingState=this._userSettings.lens(J.propertyName),this._saveToDapi=(e,t)=>(0,c.pipe)(Q.serialize(e),O.Mr,O.cy((e=>O.TX((()=>this._dapi.save(e,t)),(e=>new Error(`Failed to save DAPI props. Reason: ${JSON.stringify(e)}`)))))),this._syncRemote=(e,t)=>(0,c.pipe)(this._saveToDapi(e),O.NW((i=>i instanceof m._d?(this._log.warn("Failed to serialize DAPI props",i),this._saveToDapi(ee.pruneDapiProperties(e),t)):O.kb(i))),O.qE(te.create("_syncRemote",this._userSettings.get(),e))),this._syncLocal=()=>(0,c.pipe)(Q.serialize(this._userSettings.get()),k.bimap(te.create("_syncLocal",this._userSettings.get()),(e=>ne.write(this._userId.get(),e)))),this._sync=(0,d.flow)(this._syncRemote,O.Q5(this._syncLocal)),(0,M.hJ)("clearFeaturesOnboarding",(()=>this._setProperty({featuresOnboardingSeen:new Set}))),(0,M.hJ)("clearNews",(()=>this._setProperty({news:new Set}))),(0,M.hJ)("clearSeenSafariExt",(()=>this._setProperty({seenSafariExtNotification:!1}))),(0,M.hJ)("clearCheetahOnboarding",(()=>this._setProperty({[J.propertyName]:p.V.State.empty})))}}const se=`${L.userSettingsPrefix}${L.userSettingsVersion}-`;class ne{static read(e){try{const t=`${se}${e}`;return m.OA.of(JSON.parse(String(S.Qh(t)[t])))}catch(e){return m.OA.of({})}}static write(e,t){S.V_(m.OA.of({[`${se}${e}`]:JSON.stringify(t)}))}}var oe;!function(e){e.Mock=class{markFeatureOnboarded(e){throw new Error("Method not implemented.")}markNewsItemsAsSeen(e){return Promise.resolve()}getSurveyModel(){throw new Error("Method not implemented.")}setSurveyModel(){throw new Error("Method not implemented.")}updateSetGoalsLoader(e){return Promise.resolve()}ungatedRenewalNotificationSeen(){return Promise.resolve()}ungatedRenewalNotificationDismissed(){return Promise.resolve()}toggleMarkAsImportant(e,t){return Promise.resolve()}dismissAll(e){return Promise.resolve()}updateOnboardingPassed(e){return Promise.resolve()}incrementDunningDismissCount(){return Promise.resolve()}updateExitNotification(e){return Promise.resolve()}denaliWelcomeTourSeen(){return Promise.resolve()}markSignOutSurveySeen(){return Promise.resolve()}updateFooterCounterType(e){return Promise.resolve()}updateEditorPreferences(e){return Promise.resolve()}changePlanHookSeen(){return Promise.resolve()}markSafariExtNotificationSeen(){return Promise.resolve()}dismissChangePlanHook(){return Promise.resolve()}gbUpHookSeen(e){return Promise.resolve()}dismissGBUpHook(e){return Promise.resolve()}premiumPreviewUnderlinesSeen(){return Promise.resolve()}dismissGBBillingMigrationNotification(){return Promise.resolve()}supportUkraineCardSeen(){return Promise.resolve()}updateGetStartedChecklistSettings(e){return Promise.resolve()}updateGetStartedPremiumChecklistSettings(e){return Promise.resolve()}updateLlamaDiscoverabilitySettings(e){return Promise.resolve()}updateCheetahOnboardingState(){return Promise.resolve()}constructor(){(0,n._)(this,"footerCounterType",_.s.create(z.wordsCount)),(0,n._)(this,"seenDenaliWelcome",_.s.create(!1)),(0,n._)(this,"seenSignOutSurvey",_.s.create(!1)),(0,n._)(this,"enableSetGoalsLoader",_.s.create(!0)),(0,n._)(this,"denaliLens",_.s.create({})),(0,n._)(this,"onboardingPassed",_.s.create(new Set)),(0,n._)(this,"cheetahOnboardingState",_.s.create(p.V.State.empty)),(0,n._)(this,"newsSeen",_.s.create(new Set)),(0,n._)(this,"showExitNotification",_.s.create(!0)),(0,n._)(this,"editorPreferences",_.s.create({autoScrollToNextAlert:T.none,fontSize:Z.Normal,suggestionsVisualMode:X.Default})),(0,n._)(this,"changePlanHook",_.s.create({latestAppearances:[],latestDismissAt:T.none})),(0,n._)(this,"gbBannersUpHook",_.s.create({[Y.smbSpecificProfessionalism]:{latestAppearances:[],latestDismissAt:T.none,dismissesCount:0},[Y.styleGuides]:{latestAppearances:[],latestDismissAt:T.none,dismissesCount:0}})),(0,n._)(this,"dunningSettings",_.s.create({dunningDismissCount:0,latestDismissAt:T.none})),(0,n._)(this,"dunningStatus",_.s.create(U.Ie())),(0,n._)(this,"gbBillingMigrationSettings",_.s.create({latestDismissAt:T.none})),(0,n._)(this,"featuresOnboardingSeen",_.s.create(new Set)),(0,n._)(this,"ungatedRenewalNotificationSettings",_.s.create({wasDismissed:!1,latestAppearance:T.none})),(0,n._)(this,"ungatedTrialEndDate",_.s.create(T.none)),(0,n._)(this,"seenSafariExtNotification",_.s.create(!1)),(0,n._)(this,"supportUkraineCardAppearanceCount",_.s.create(0)),(0,n._)(this,"getStartedChecklistSettings",_.s.create({dismissal:T.none,completedItems:new Set})),(0,n._)(this,"getStartedPremiumChecklistSettings",_.s.create({dismissal:T.none,completedItems:new Set})),(0,n._)(this,"llamaDiscoverabilitySettings",_.s.create({modalDismissalTimestamp:T.none,bannerDismissalTimestamp:T.none}))}}}(oe||(oe={}))},92676:(e,t,i)=>{i.d(t,{U:()=>m,d:()=>s});var s,n=i(83531),o=i(23988),r=i(80074),a=i(6987),l=i(36094),d=i(86562),c=i(69063),h=i(60080);!function(e){e.UNMOUNTED="UNMOUNTED",e.MOUNTED="MOUNTED",e.MOUNTING="MOUNTING",e.READY="READY",e.LOADING="LOADING",e.CANCEL="CANCEL",e.AUTHORIZED="AUTHORIZED",e.ERROR="ERROR"}(s||(s={}));const u=(e,t)=>new Promise(((i,s)=>e(t,((e,t)=>{if(Boolean(e))return s(e);i(t)}))));var p;!function(e){e.isBlockedPopupWarn=e=>/Can not open popup window - blocked/.test(e.message)}(p||(p={}));class _{constructor(e){(0,o._)(this,"_isPaymentSandbox",void 0),(0,o._)(this,"_log",void 0),(0,o._)(this,"_checkoutInstance",void 0),(0,o._)(this,"_state",void 0),(0,o._)(this,"state",void 0),(0,o._)(this,"_isUnmounted",void 0),(0,o._)(this,"teardown",void 0),(0,o._)(this,"_shouldBlockPayPal",void 0),(0,o._)(this,"init",void 0),this._isPaymentSandbox=e,this._log=c.Bx.Logging.getLogger("model.subscription.braintree.paypal"),this._state=r.s.create({kind:s.UNMOUNTED}),this.state=this._state,this._isUnmounted=()=>this._state.view((({kind:e})=>e===s.UNMOUNTED)).get(),this.teardown=()=>{Boolean(this._checkoutInstance)&&this._checkoutInstance.teardown(),this._state.set({kind:s.UNMOUNTED})},this._shouldBlockPayPal=()=>window.name.includes("xcomponent");var t,h=this;this.init=(t=(0,n._)((function*(e,t){if(h._state.set({kind:s.MOUNTING}),h._shouldBlockPayPal())return void h._state.set({kind:s.ERROR,error:"PayPal exploit detected",recoverable:!1});const{Paypal:n}=yield Promise.all([i.e(2074),i.e(5874)]).then(i.bind(i,68606));try{if(!h._isPaymentSandbox){const t=yield Promise.all([i.e(2074),i.e(5874)]).then(i.t.bind(i,32983,23));h._checkoutInstance=yield t.create({client:e})}}catch(e){h._state.set({kind:s.ERROR,error:e,recoverable:!1})}return n.Button.render({env:h._isPaymentSandbox?"sandbox":"production",style:{label:"paypal",size:"medium",shape:"pill",color:"gold"},validate:e=>{h._isPaymentSandbox?e.disable():e.enable(),h._state.set({kind:s.READY})},onClick:()=>{h._state.set({kind:s.LOADING}),h._isPaymentSandbox&&h._state.set({kind:s.AUTHORIZED,nonce:"fake-paypal-billing-agreement-nonce"})},payment:()=>h._checkoutInstance.createPayment({flow:"vault"}),onAuthorize:e=>(h._state.set({kind:s.LOADING}),h._checkoutInstance.tokenizePayment(e).then((e=>h._state.set({kind:s.AUTHORIZED,nonce:e.nonce}))).catch((e=>h._state.set({kind:s.ERROR,error:e,recoverable:!0})))),onCancel:()=>h._state.set({kind:s.CANCEL}),onError:e=>{h._isUnmounted()||(p.isBlockedPopupWarn(e)?h._log.error("Cannot open popup",e):h._state.set({kind:s.ERROR,error:e,recoverable:!0}))}},t).then((()=>{h._state.set({kind:s.MOUNTED})})).catch((e=>{h._isUnmounted()||h._state.set({kind:s.ERROR,error:e,recoverable:!1})}))})),function(e,i){return t.apply(this,arguments)}),this._state.pipe(a.n(l._F.rafScheduler)).subscribe((e=>{switch(this._log.debug("Paypal state changed",e),e.kind){case s.UNMOUNTED:case s.MOUNTING:case s.MOUNTED:break;case s.LOADING:this._log.info("Paypal button clicked");break;case s.AUTHORIZED:this._log.info("Paypal authorized"),this._state.set({kind:s.READY});break;case s.CANCEL:this._log.info("Paypal cancel"),this._state.set({kind:s.READY});break;case s.READY:break;case s.ERROR:e.recoverable?(this._log.warn("Paypal integration error, recoverable",e.error),this._state.set({kind:s.READY})):(this._log.error("Paypal integration error, fatal",e.error),this.teardown());break;default:(0,d.xb)(e)}}))}}class g{constructor(e){(0,o._)(this,"_notificationModel",void 0),(0,o._)(this,"_log",void 0),(0,o._)(this,"_teardownInProgress",void 0),(0,o._)(this,"_state",void 0),(0,o._)(this,"state",void 0),(0,o._)(this,"_hostedFields",void 0),(0,o._)(this,"updateCreditCard",void 0),(0,o._)(this,"init",void 0),(0,o._)(this,"teardown",void 0),this._notificationModel=e,this._log=c.Bx.Logging.getLogger("model.subscription.braintree.creditCard"),this._teardownInProgress=!1,this._state=r.s.create(s.UNMOUNTED),this.state=this._state,this.updateCreditCard=()=>new Promise(((e,t)=>{this._hostedFields.tokenize(((i,s)=>{if(Boolean(i)){const{fields:e}=this._hostedFields.getState();return Object.keys(e).forEach((t=>{e[t].isValid||e[t].container.classList.add("braintree-hosted-fields-invalid")})),void t(i)}return Boolean(s)||t(i),Object.keys(this._hostedFields.getState().fields).forEach((e=>this._hostedFields.clear(e))),e(s)}))})).then((e=>(this._log.info("CreditCard updated"),e))).catch((e=>{throw this._log.error("CreditCard error",e),e}));var t,a=this;this.init=(t=(0,n._)((function*(e,{styles:t,fields:n}){try{const o={client:e,styles:t,fields:n},r=yield Promise.all([i.e(2074),i.e(5874)]).then(i.t.bind(i,82510,23));a._hostedFields=yield u(r.create,o),a._state.set(s.MOUNTED),a._log.info("CreditCard fields initialized")}catch(e){if(Boolean(e)&&"HOSTED_FIELDS_INVALID_FIELD_SELECTOR"!==e.code)return;a._notificationModel.setNotification(h.d.unknownError)}})),function(e,i){return t.apply(this,arguments)}),this.teardown=()=>{try{if(this._notificationModel.clearNotification(),this._teardownInProgress)return;return this._teardownInProgress=!0,Boolean(this._hostedFields)?this._hostedFields.teardown((e=>{this._teardownInProgress=!1,Boolean(e)?this._log.error("Could not tear down Hosted Fields!",e):this._state.set(s.UNMOUNTED)})):this._hostedFields}catch(e){this._log.warn("Braintree teardown error",e)}}}}class m{_generateToken(){var e=this;return(0,n._)((function*(){const{token:t}=yield e._subscriptionApi.generateClientToken();return t}))()}constructor(e,t,s){(0,o._)(this,"_notificationModel",void 0),(0,o._)(this,"_subscriptionApi",void 0),(0,o._)(this,"_isPaymentSandbox",void 0),(0,o._)(this,"_creditCard",void 0),(0,o._)(this,"_paypal",void 0),(0,o._)(this,"_braintreeClient",void 0),(0,o._)(this,"updateCreditCard",void 0),(0,o._)(this,"creditCardState",void 0),(0,o._)(this,"paypalState",void 0),(0,o._)(this,"init",void 0),(0,o._)(this,"teardown",void 0),(0,o._)(this,"_getBraintreeClient",void 0),this._notificationModel=e,this._subscriptionApi=t,this._isPaymentSandbox=s,this._creditCard=new g(this._notificationModel),this._paypal=new _(this._isPaymentSandbox),this.updateCreditCard=this._creditCard.updateCreditCard,this.creditCardState=this._creditCard.state,this.paypalState=this._paypal.state;var r,a=this;this.init=(r=(0,n._)((function*(e,t){a._notificationModel.clearNotification();const i=yield a._getBraintreeClient();a._creditCard.init(i,t),a._paypal.init(i,e)})),function(e,t){return r.apply(this,arguments)}),this.teardown=()=>{this._paypal.teardown(),this._creditCard.teardown()};var l=this;this._getBraintreeClient=(0,n._)((function*(){const e=yield Promise.all([i.e(2074),i.e(5874)]).then(i.t.bind(i,33562,23));if(Boolean(l._braintreeClient))return l._braintreeClient;const t=yield l._generateToken(),s=yield u(e.create,{authorization:t});return l._braintreeClient=s,s}))}}},40464:(e,t,i)=>{i.d(t,{E2:()=>U,H0:()=>O,n6:()=>D});var s=i(83531),n=i(23988),o=i(10334),r=i(17171),a=i(29052),l=i(30040),d=i(96797),c=i(21296),h=i(80074),u=i(81207),p=i(5692),_=i(78339),g=i(19711),m=i(15491),f=i(80837),v=i(85076),y=i(42543),b=i(82718),w=i(36094),S=i(23121),x=i(58889),T=i(28421),k=i(44297),E=i(69063),P=i(92676),C=i(60080);const D=p.j.defaultValue(),A=d.OH({state:d.KC([d.eu("DEFAULT"),d.eu("FROZEN"),d.eu("TRIAL"),d.eu("BILLING_FLOW_MIGRATION_STARTED"),d.eu("BILLING_FLOW_MIGRATION_ENDED")]),paymentMethod:u.g5.codec,creditCard:d.KC([d.E$([d.NW({cardType:u.CJ.codec}),d.OH({cardSuffix:d.Yj,expirationMonth:d.ai,expirationYear:d.ai})]),d.Vx],"CreditCard"),billingFlowMigrationMethod:d.KC([d.eu("DEFAULT"),d.eu("INVOICING")]),usePaymentsApi:d.zM,isPremium:d.zM,nextPayDate:d.Yj,nextRenewalInvoiceDate:d.Yj,lastSubscribedDate:d.Yj,expirationDate:d.Yj,isAppleSubscription:d.zM,isGooglePlaySubscription:d.zM,isCancelled:d.zM,isDunning:d.zM,isPaymentMethodFailed:d.zM,isFree:d.zM,isFreebie:d.zM,isPremiumConversion:d.zM,isLegacyPayPal:d.zM,canCancelPlanSwitch:d.zM,hasInstitutionSubscription:d.zM,currentPlan:u.yB.codec,queuedPlan:u.yB.codec,plans:d.YO(u.yB.codec),hardChangePlans:d.YO(u.Tn.codec),institutionDynamicPlans:d.YO(u.yB.codec),institutionPlans:d.YO(u.yB.codec),institutionEduPlans:d.YO(u.yB.codec),proPlans:d.YO(u.yB.codec),pricingOptions:u.lY.codec,paymentMethodOptions:u._3.codec,payPalEmail:d.Yj,isOnTrial:d.zM,companyInfo:d.Yj,dunningEndDate:d.Yj,dunningDeactivationDate:d.Yj,campaign:u.Hu.codec,stripeInvoiceInfo:u.zW.codec,countryCode:d.Yj,regionCode:d.Yj,isUngatedTrialDisabled:d.zM},"SubscriptionStatus"),U=d.E$([A,d.NW({plans:d.YO(u.yB.codec),referralInfo:u.SK.codec}),d.OH({nextPayDate:d.Yj,currentPlan:u.yB.codec,expirationDate:d.Yj})]);class O{dispose(){this._subs.dispose()}clearNotification(){this._notification.set(null)}navigateToSubscribeUrl(){document.location.href=this._config.funnel.subscribe}navigateToUpgradeUrl(e){(0,l.pipe)(S.zb((()=>this._upgradeHook.fromHome(e))),x.chain(this._platformEnvironment.actions.openUrl),x.getOrElse((e=>this._log.fatal("unexpected error on open upgrade page",e))))}renew(){var e=this;return(0,s._)((function*(){yield e._subscriptionApi.renewSubscription(),e._reloadSubscription()}))()}changePlan(e){var t=this;return(0,s._)((function*(){yield t._subscriptionApi.changePlan(e),t._reloadSubscription()}))()}getPlans(){var e=this;return(0,s._)((function*(){return e._reloadSubscription(),e.state.pipe(_.p(p.j.isOk),g.$(),m.T((e=>e.value)),m.T((e=>e.plans||[]))).toPromise()}))()}_reloadSubscription(){this._subscriptionTrigger.next()}constructor(e,t,i,s,d,u){(0,n._)(this,"state",void 0),(0,n._)(this,"_subscriptionApi",void 0),(0,n._)(this,"_config",void 0),(0,n._)(this,"_platformEnvironment",void 0),(0,n._)(this,"_upgradeHook",void 0),(0,n._)(this,"_isPaymentSandbox",void 0),(0,n._)(this,"_log",void 0),(0,n._)(this,"_subs",void 0),(0,n._)(this,"_notification",void 0),(0,n._)(this,"_getSubscription",void 0),(0,n._)(this,"_subscriptionTrigger",void 0),(0,n._)(this,"braintreeApi",void 0),(0,n._)(this,"setNotification",void 0),this.state=e,this._subscriptionApi=t,this._config=i,this._platformEnvironment=s,this._upgradeHook=d,this._isPaymentSandbox=u,this._log=E.Bx.Logging.getLogger("model.subscription"),this._subs=new f.y.Keeper,this._notification=h.s.create(null),this._getSubscription=v.l((0,a.TX)((()=>Promise.all([this._subscriptionApi.getStatus(),this._subscriptionApi.getReferralInfo()]).then((([e,t])=>(e.plans||(e.plans=[]),(0,r._)((0,o._)({},e),{referralInfo:t}))))),l.unsafeCoerce),[(0,c.limitRetries)(3),M(1e3)],(e=>!("code"in e)||401!==e.code)),this._subscriptionTrigger=new y.B7,this.braintreeApi=new P.U(this,this._subscriptionApi,this._isPaymentSandbox),this.setNotification=(e,t)=>{requestAnimationFrame((()=>this._notification.set({type:e,planName:t})))},this._subs.push(this._subscriptionTrigger.pipe(b.K(this._getSubscription),_.p((e=>!(T.LT(e)&&p.j.isError(this.state.get())))),m.T(p.j.fromRD)).subscribe(w.H9(this.state)),this.state.subscribe((e=>{p.j.isError(e)&&1===e.attempt?this._log.warn("cant get user subscription",e.error):p.j.isFatal(e)&&(this._log.error("cant get user subscription",e.error),this.setNotification(C.d.unknownError))}))),p.j.isOk(e.get())||this._reloadSubscription()}}const M=e=>t=>k.some(t.iterNumber*e)},60080:(e,t,i)=>{var s;i.d(t,{d:()=>s}),function(e){e[e.updateBilling=0]="updateBilling",e[e.paymentError=1]="paymentError",e[e.subscriptionUpdated=2]="subscriptionUpdated",e[e.subscriptionCancelled=3]="subscriptionCancelled",e[e.cantUpgradeSubscription=4]="cantUpgradeSubscription",e[e.resumedSubscription=5]="resumedSubscription",e[e.cantResumeSubscription=6]="cantResumeSubscription",e[e.unknownError=7]="unknownError",e[e.unknownOrigin=8]="unknownOrigin",e[e.blobDownloadUnsupported=9]="blobDownloadUnsupported",e[e.mobileCancel=10]="mobileCancel",e[e.paypalSuccess=11]="paypalSuccess",e[e.paypalError=12]="paypalError"}(s||(s={}))},1424:(e,t,i)=>{i.d(t,{Y:()=>s});var s,n=i(23988),o=i(30040),r=i(52839),a=i(96509),l=i(74416),d=i(23121),c=i(58889),h=i(76720),u=i(86562),p=i(38908),_=i(69063),g=i(74056),m=i(58434),f=i(37107);!function(e){let t;!function(e){let i,s,n;!function(e){e.editorMenu="editorMyGrammarly",e.editorReferrals="editorReferrals",e.editorMenuBusiness="editorBusinessHomePageMenu"}(i=e.Home||(e.Home={})),e.isHome=function(e){return Object.values(t.Home).some((t=>t===e))},function(e){e.editorDenaliAdvanced="editorAdvancedIssues",e.editorDenaliDelivery="editorDeliveryTooltip",e.editorDenaliEngagement="editorEngagementTooltip",e.editorDenaliPlagiarism="editorPlagiarismTooltip",e.editorDenaliProofit="editorProofreadingTooltip",e.editorDenaliOverview="editorDenaliOverview",e.editorDenaliGoals="editorDenaliGoals",e.editorDenaliDocumentSettings="editorDenaliDocumentSettings",e.editorDenaliUpgradeInline="editorDenaliUpgradeInline",e.editorDenaliChecksFeed="editorDenaliChecksFeed",e.oggyPlagiarismUphook="oggyPlagiarismUphook"}(s=e.DenaliDocument||(e.DenaliDocument={})),function(e){e.gdocsSidebarCardList="gdocsSidebarCardList",e.gdocsSidebarSuccessView="gdocsSidebarSuccessView",e.gdocsGoals="gdocsGoals",e.assistantCardList="assistantCardList",e.extensionSettingsAssistant="extensionSettingsAssistant"}(n=e.Extension||(e.Extension={}))}(t=e.Place||(e.Place={}));class i{fromHome(e,t,i){return e===s.Place.Home.editorMenuBusiness?this._businessHook(t,i):this._from(e).addParams({upgradeFrom:this._env.names.funnel})}fromDenaliDocumentToPlans(e,t,s,n,r){const a=this._from(e).addParams({doc_id:t,upgradeFrom:this._env.names.funnel});return(0,o.pipe)(d.zb((()=>{const e=r?l.Q.prism.reverseGet(r.get()):0;return e>5?a.addParams({plagiarism:e.toString()}):a})),c.mapLeft((e=>this._log.error("can not append plagiarismPercent",e))),c.chain((e=>(0,o.pipe)(d.zb((()=>e.addParams(i._encodeCategorizedAlerts(s)))),c.mapLeft((e=>this._log.error("can not append encoded alertsByCategories",e)))))),c.chain((e=>(0,o.pipe)(d.zb((()=>e.addParams(i._encodeLensedAlerts(n)))),c.mapLeft((e=>this._log.error("can not append encoded alertsByLenses",e)))))),c.getOrElse((()=>a)))}fromDenaliDocumentToUpgrade(e,t){return this._from(e).addParams({doc_id:t,redirectUphookToUpgradePageExp:"1",upgrade:"1"})}fromDenaliDocumentToUpgradeTry(e,t){const i=this._from(e).addParams({doc_id:t,redirectUphookToUpgradePageExp:"1"});return new h.U(this._config.funnel.upgradeTry,i.params)}fromGbUpHookNotification(e){return new h.U(e===f.CH.styleGuides?this._config.funnel.businessStyleguideLanding:this._config.funnel.businessLanding).addParams(i._hookMeta).addParams({utm_campaign:"webEditorDocumentPopupGBp",utm_content:e})}fromGrammarlyGO(){return new h.U(this._config.funnel.plans).addParams(i._hookMeta).addParams({utm_campaign:"webEditorGrammarlyGoPrompts"})}fromGbVoxUpHookLens(){return new h.U(this._config.funnel.businessStyleguideLanding).addParams(i._hookMeta).addParams({utm_campaign:"gbDenaliVoxLens"})}_businessHook(e,t){const s=this._userType.get(),{plans:n,businessUpgradeLanding:o}=this._config.funnel,r=!0===t?o:n;return new h.U(r).addParams(i._hookMeta).addParams(i._encodeBusinessPlatform(s,this._env.platform)).addParams({utm_content:e})}_from(e){return new h.U(this._config.api.redirect).addParams({page:"free",hash:r(this._userId.get()),app_type:i._getAppType(this._env.platform)}).addParams(i._hookMeta).addParams(i._encodePlace(e,this._env.platform))}static _getAppType(e){switch(e){case g.OH.Platform.WEB:case g.OH.Platform.IPAD:case g.OH.Platform.MACEDITOR:return"app";default:return(0,u.xb)(e)}}static _encodePlace(e,i){return e===t.DenaliDocument.oggyPlagiarismUphook?{utm_campaign:`${i}Editor_plagiarism_plagiarismView_premium`}:{utm_campaign:`${i}${p.PT(e)}`}}static _encodeBusinessPlatform(e,t){return{utm_campaign:`${t}EditorMyGrammarlyGB${e===m.ut.free?"f":"p"}`}}static _encodeCategorizedAlerts(e){return e.forEach((e=>{(0,u.V1)(6===Object.keys(e).length,"alert group should had exactly six keys",(()=>JSON.stringify(e)))})),{alerts:this._compress(e)}}static _encodeLensedAlerts(e){return e.forEach((e=>{(0,u.V1)(3===Object.keys(e).length,"alert group should had exactly four keys",(()=>JSON.stringify(e)))})),{lensedAlerts:this._compress(e)}}static _compress(e){const t=a.compressToEncodedURIComponent(JSON.stringify(e));return(0,u.V1)(t.length<1500,"serialized data exceeded allowed size",(()=>JSON.stringify({size:t.length,data:e}))),t}constructor(e,t,i,s){(0,n._)(this,"_config",void 0),(0,n._)(this,"_env",void 0),(0,n._)(this,"_userId",void 0),(0,n._)(this,"_userType",void 0),(0,n._)(this,"_log",void 0),this._config=e,this._env=t,this._userId=i,this._userType=s,this._log=_.Bx.Logging.getLogger("model.UpgradeHook")}}(0,n._)(i,"_hookMeta",{utm_medium:"internal",utm_source:"upHook"}),e.Impl=i,e.Mock=class{fromHome(e){throw new Error("Method not implemented.")}fromDenaliDocumentToPlans(e,t,i){throw new Error("Method not implemented.")}fromDenaliDocumentToUpgrade(e,t){throw new Error("Method not implemented.")}fromDenaliDocumentToUpgradeTry(e,t){throw new Error("Method not implemented.")}fromGbUpHookNotification(e){throw new Error("Method not implemented.")}fromGbVoxUpHookLens(){throw new Error("Method not implemented.")}fromGrammarlyGO(){throw new Error("Method not implemented.")}}}(s||(s={}))},8094:(e,t,i)=>{i.d(t,{WG:()=>p,y9:()=>s});var s,n=i(83531),o=i(23988),r=i(38819),a=i(48581),l=i(36840),d=i(69063),c=i(704),h=i(34681),u=i(80029);class p{getFreeTrialEligibility(){return!(!this._eligibilitySpecialOffers||!this._eligibilitySpecialOffers.free_trial_rollout)&&this._eligibilitySpecialOffers.free_trial_rollout.eligibility}getFreeTrialEuUkEligibility(){return!(!this._eligibilitySpecialOffers||!this._eligibilitySpecialOffers.free_trial_eu_uk)&&this._eligibilitySpecialOffers.free_trial_eu_uk.eligibility}getFreeTrialForNewUsersEligibility(){return!(!this._eligibilitySpecialOffers||!this._eligibilitySpecialOffers.free_trial_new_users)&&this._eligibilitySpecialOffers.free_trial_new_users.eligibility}constructor(e){(0,o._)(this,"_fingerprints",void 0),(0,o._)(this,"_vitoClient",void 0),(0,o._)(this,"_eligibilitySpecialOffers",void 0),(0,o._)(this,"_initVitoClient",void 0),(0,o._)(this,"requestSpecialOffersEligibility",void 0),this._fingerprints=e;var t=this;this._initVitoClient=(0,n._)((function*(){const e=yield(0,h.r)(t._fingerprints)(),i=new r.Configuration({basePath:(0,u.W)().api.vito,fetchApi:a.pM.request({target:"vito",cache:"default"}),headers:{"X-CSRF-Token":e["X-CSRF-Token"],"X-Container-Id":e["X-Container-Id"],"X-Client-Version":e["X-Client-Version"],"X-Client-Type":e["X-Client-Type"]},credentials:"include"});t._vitoClient=new r.VitoApi(i)}));var i,s=this;this.requestSpecialOffersEligibility=(i=(0,n._)((function*(e){s._vitoClient||(yield s._initVitoClient());try{d.Bx.TimeSeries.rootFemetrics.getMetric(c.b.Metrics.SpecialOfferEligibility).getCounter(c.b.MetricsActions.RequestAttemptsTotal).increment(),s._eligibilitySpecialOffers=yield s._vitoClient.specialOffersGet({names:e}),d.Bx.TimeSeries.rootFemetrics.getMetric(c.b.Metrics.SpecialOfferEligibility).getCounter(c.b.MetricsActions.RequestSuccessTotal).increment()}catch(t){d.Bx.Logging.getLogger("VitoService").error(`Special offer eligibility request failed: ${e}`,t),d.Bx.TimeSeries.rootFemetrics.getMetric(c.b.Metrics.SpecialOfferEligibility).getCounter(c.b.MetricsActions.RequestFailuresTotal).increment()}})),function(e){return i.apply(this,arguments)}),this._initVitoClient()}}!function(e){e.Mock=class{constructor(){(0,o._)(this,"requestSpecialOffersEligibility",(()=>l.Yi)),(0,o._)(this,"getFreeTrialEligibility",(()=>!1)),(0,o._)(this,"getFreeTrialEuUkEligibility",(()=>!1)),(0,o._)(this,"getFreeTrialForNewUsersEligibility",(()=>!1))}}}(s||(s={}))},36257:(e,t,i)=>{i.d(t,{j:()=>s});var s,n=i(10334),o=i(17171),r=i(30040),a=i(10821),l=i(44297),d=i(81870);!function(e){let t,i,s,c,h,u,p;function _(e){return e.status===a.c.JobStatus.building||e.status===a.c.JobStatus.newJob}!function(e){e.new="new",e.loading="loading",e.existing="existing",e.deleted="deleted"}(t=e.Kind||(e.Kind={})),function(e){e.todayDocs="todayDocs",e.yesterdayDocs="yesterdayDocs",e.earlierDocs="earlierDocs"}(i=e.Group||(e.Group={})),function(e){e.create=()=>({kind:t.new})}(s=e.New||(e.New={})),function(e){e.create=()=>({kind:t.loading})}(c=e.Loading||(e.Loading={})),function(e){e.create=(e,i=l.none)=>p.create(t.existing)(e,i)}(h=e.Existing||(e.Existing={})),function(e){e.create=(e,i=l.none)=>p.create(t.deleted)(e,i)}(u=e.Deleted||(e.Deleted={})),function(e){e.create=e=>(t,i=l.none)=>{const s=l.fromNullable(t.proofit);return{kind:e,document:t,groupStarter:i,proofit:{result:s,inProgress:(0,r.pipe)(s,l.exists(_))}}},e.updateProofit=e=>t=>{const i=(0,r.pipe)(t,l.alt((()=>e.proofit.result)));return(0,o._)((0,n._)({},e),{proofit:{result:i,inProgress:(0,r.pipe)(i,l.exists(_))}})},e.getDestination=e=>d.Lz.routes.editor.href({docId:e.document.id.toString()})}(p=e.WithDocument||(e.WithDocument={})),e.isNew=e=>e.kind===t.new,e.isLoading=e=>e.kind===t.loading,e.isExisting=e=>e.kind===t.existing,e.isDeleted=e=>e.kind===t.deleted,e.isProofitInProgress=_,e.isProofitCompleted=function(e){return e.status===a.c.JobStatus.completed}}(s||(s={}))},704:(e,t,i)=>{var s,n;i.d(t,{P:()=>s,b:()=>n}),function(e){let t,i,s,n,o;!function(e){e.GetPremiumButton="get_premium_button"}(t=e.Metrics||(e.Metrics={})),function(e){e.Click="clicks",e.Show="shows",e.Dismiss="dismisses"}(i=e.MetricsActions||(e.MetricsActions={})),function(e){e.AdvancedIssues="advancedIssues",e.Tooltip="tooltip",e.Navigation="navigation"}(s=e.UpgradeHookName||(e.UpgradeHookName={})),function(e){e.Assistant="assistant",e.Sidebar="sidebar",e.PlagiarismTooltip="plagiarismTooltip",e.ProofreadingTooltip="proofreadingTooltip"}(n=e.UpgradeHookSlot||(e.UpgradeHookSlot={})),function(e){e.premium="premium",e.premiumTrial="premiumTrial",e.pro="pro"}(o=e.UpgradeHookVariant||(e.UpgradeHookVariant={}))}(s||(s={})),function(e){let t,i;!function(e){e.SpecialOfferEligibility="special_offer_eligibility"}(t=e.Metrics||(e.Metrics={})),function(e){e.RequestAttemptsTotal="request_attempts_total",e.RequestSuccessTotal="request_success_total",e.RequestFailuresTotal="request_failures_total"}(i=e.MetricsActions||(e.MetricsActions={}))}(n||(n={}))},16721:(e,t,i)=>{i.d(t,{Y:()=>s});var s,n=i(50659),o=i(63336),r=i(39212),a=i.n(r),l=i(80172),d=i(59636),c=i(38908),h=i(44297),u=i(23121),p=i(58889),_=i(20739);!function(e){var t=e.Context=n.createContext(d.o.invariantContent("Telemetry.Context")),i=e.createPageSessionId=()=>c.G7(10),s=e.ContextProvider=e=>n.createElement(t.Provider,{value:Object.create({},{gnarSpec:{get:()=>e.gnarSpec},pageId:{get:()=>e.pageId},pageSessionId:{get:()=>e.pageSessionId},getSessionUuid:{get:()=>e.sessionUuidGetter},sessionUuid:{get:()=>(0,o.pipe)(e.sessionUuidGetter(),h.getOrElse((()=>"")))},docId:{get:()=>{if(Boolean(e.docId))return e.docId;throw new Error("docId is not specified. Please provide it thru the PageContextProvider")}},isTouchDevice:{get:()=>(0,o.pipe)(u.zb(a()),p.getOrElse((()=>!1)))}})},n.Children.only(e.children));e.ContextProviderInherited=e=>n.createElement(t.Consumer,null,(i=>n.createElement(t.Provider,{value:Object.create({},{gnarSpec:{get:()=>i.gnarSpec},pageId:{get:()=>Boolean(e.pageId)?e.pageId:i.pageId},pageSessionId:{get:()=>i.pageSessionId},docId:{get:()=>Boolean(e.docId)?e.docId:i.docId},isTouchDevice:{get:()=>(0,o.pipe)(u.zb(a()),p.getOrElse((()=>!1)))}})},n.Children.only(e.children)))),e.ContextProviderMock=e=>n.createElement(s,{gnarSpec:new _.vp(new l.Aj),pageId:Boolean(e.pageId)?e.pageId:"mockPageId",pageSessionId:i(),docId:Boolean(e.docId)?e.docId:"mockDocId",sessionUuidGetter:()=>h.none},e.children)}(s||(s={}))},31373:(e,t,i)=>{i.d(t,{J:()=>r,m:()=>a});var s=i(63336),n=i(34717),o=i(44297);function r(e){const t=n.Local.daysAgo(n.Local.now(),16);return(0,s.pipe)(e.latestDismissAt,o.fold((()=>!0),(e=>e.getTime()<t)))}function a(e){if(r(e))return!0;const t=n.Local.daysAgo(n.Local.now(),1);return e.dunningDismissCount<14&&(0,s.pipe)(e.latestDismissAt,o.fold((()=>!0),(e=>e.getTime()<t)))}}}]);