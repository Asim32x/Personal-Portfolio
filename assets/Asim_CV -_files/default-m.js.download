"use strict";(self.webpackChunk_grammarly_denali_app=self.webpackChunk_grammarly_denali_app||[]).push([[4964],{43406:(e,t,n)=>{var o,r=n(58889),a=n(30040),i=n(68654),s=n(44297),d=n(69063),l=n(5849),c=n(50659),m=n(53493),p=n(10334),g=n(17171),u=n(63336),f=n(78952),h=n(53917),w=n(12061),x=n(5692),b=n(78339),E=n(19711),v=n(24946),C=n(29052),L=n(86562),M=n(80074),y=n(61198),P=n(52267),S=n(80837),T=n(95168),I=n(41831),_=n(58193),V=n(30805),k=n(74056),A=n(29518),R=n(97091),j=n(6614);!function(e){e.create=(e,t,n)=>{const o=new S.y.Keeper,r=R.W.create(e,t),a=A.C.create(e,t),i=j.c.create(e,t),d=M.s.create(s.none);return o.push(e.isReady.pipe(b.p(Boolean),T.M((()=>{new P.ai(I.th.from([i]),n.has(k.OH.Flag.isAppleSystem),n.platform===k.OH.Platform.IPAD),d.set(s.some(new y.jM(new V.h(e.modals,e.userAccount,e.telemetry))))}))).subscribe()),{proofitViewModel:r,documentListViewModel:a,trashbinViewModel:i,get modalManager(){const e=d.get();return(0,L.V1)(s.isSome(e),"Trying to get ModalManager instance before user account is initialized"),_.$v(e)},dispose:()=>{o.dispose(),r.dispose(),a.dispose()}}}}(o||(o={}));var B,F=n(96750),N=n(70932),U=n(16721);!function(e){e.measure=function(){const e=d.Bx.Logging.getLogger("web_vitals"),t=d.Bx.TimeSeries.rootFemetrics;n.e(4233).then(n.bind(n,91849)).then((({onFCP:e,onFID:t,onLCP:n,onTTFB:o})=>{const r=new Promise((t=>e(t))),a=new Promise((e=>n(e))),i=new Promise((e=>t(e))),s=new Promise((e=>o(e)));return Promise.all([r,a,i,s])})).then((([n,o,r,a])=>{const i=window.location.href.includes("grammarly.com/ddocs/")?"editor":"myGrammarly";e.info("Web vitals",{fcp:n,lcp:o,fid:r,ttfb:a,page:i}),t.getTimer("webVitals_fcp").setContext({page:i}).recordTime(n.value),t.getTimer("webVitals_lcp").setContext({page:i}).recordTime(o.value),t.getTimer("webVitals_fid").setContext({page:i}).recordTime(r.value),t.getTimer("webVitals_ttfb").setContext({page:i}).recordTime(a.value)})).catch((t=>e.error("Couldn't measure web-vitals",t)))}}(B||(B={}));var D=n(86503),O=n(80029),W=n(74194),H=n(69204),Y=n(785);const Z=e=>{const{isEligible:t,children:n}=e;return c.useEffect((()=>{if(t){var e;const t=document.createElement("script");t.type="text/javascript",t.innerHTML="(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src='https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);})(window,document,'script','dataLayer','GTM-NPLPZQ89');",null===(e=document.querySelector("head"))||void 0===e||e.appendChild(t)}}),[t]),c.createElement(c.Fragment,null,n)};var $=n(75967),G=n(23988),q=n(33689);class z extends c.Component{getChildContext(){const{telemetryLegacy:e,editorTsNotifications:t}=this.props.model;return{telemetry:e,editorTsNotifications:t}}render(){return c.Children.only(this.props.children)}}(0,G._)(z,"childContextTypes",q.h1);var K=n(87574),Q=n(51707),J=n(36094),X=n(15491),ee=n(11213),te=n(22409);class ne extends c.Component{componentDidMount(){const e=this.context;this.props.external?(e.scheduleReloadOnNavigation(),e.navigate(this.props.destination,(0,u.pipe)(e.locationState,s.toUndefined))):e.replace(this.props.destination,(0,u.pipe)(e.locationState,s.toUndefined))}render(){return null}constructor(...e){super(...e),(0,G._)(this,"context",void 0)}}(0,G._)(ne,"contextType",Y.L.Context);const oe=Q.RZ((()=>Promise.all([n.e(2688),n.e(3641),n.e(6671),n.e(9810),n.e(1304),n.e(7034),n.e(4613),n.e(270),n.e(9960),n.e(5637),n.e(8348),n.e(3827)]).then(n.bind(n,79675)))),re=Q.RZ((()=>Promise.all([n.e(2688),n.e(3641),n.e(6671),n.e(9810),n.e(1304),n.e(7034),n.e(4613),n.e(270),n.e(9960),n.e(5637),n.e(8348),n.e(3827)]).then(n.bind(n,39152)))),ae=Q.RZ((()=>Promise.all([n.e(2688),n.e(3641),n.e(6671),n.e(9810),n.e(1304),n.e(7034),n.e(4613),n.e(270),n.e(9960),n.e(5637),n.e(8348),n.e(3827)]).then(n.bind(n,3038)))),ie=Q.RZ((()=>Promise.all([n.e(2688),n.e(9967),n.e(6008),n.e(3641),n.e(6671),n.e(9810),n.e(1304),n.e(3620),n.e(7034),n.e(2552),n.e(1062),n.e(9473),n.e(5637),n.e(8437),n.e(6333),n.e(5952)]).then(n.bind(n,65795)))),se=({model:e,demoText:t})=>{const o=J.RF((()=>n.e(2350).then(n.bind(n,44011)).then((n=>{const{text:o,title:r}=n[t];return e.documentsPage.actions.createDocument(o,r)}))));return c.createElement(K.F.div,null,o.pipe(X.T(s.fold((()=>c.createElement(te.y,{className:ee.A.spinner})),(0,a.flow)(r.map((e=>e.id.toString())),r.fold((e=>(d.Bx.Logging.getLogger("global_experiment").fatal("Fail when redirecting to demo doc",e),c.createElement(ne,{destination:Y.L.routes.documents.href()}))),(e=>c.createElement(ne,{destination:Y.L.routes.denali_editor.href({docId:e})}))))))))};function de({authentication:e,onUserReady:t,model:n}){const o=c.useContext(k.OH.Context),r=e.status.get();if(x.j.isIdle(r))throw(0,u.pipe)(e.ensureAuthenticated(),C.qE((e=>{e===W.lR.UnauthorizedError&&o.actions.showSigninView()})))();if(x.j.isTerminated(r)){if(x.j.isFatal(r))return c.createElement(N.l,null);if(x.j.isOk(r)){if(n.isReady.get())return t();throw n.isReady.pipe(b.p(Boolean),v.s(1)).toPromise()}return(0,L.xb)(r)}throw e.status.pipe(b.p(x.j.isTerminated),E.$()).toPromise()}function le({environment:e,platformEnvironment:t,backendManagedStorageManager:n}){const i=e.platform===k.OH.Platform.IPAD,l=d.Bx.Logging.getLogger("router"),m=(0,f.zR)(),v=new h.kI(l,m,window.localStorage,window.location),C=(0,H.Z)((0,O.W)(),v.query.get("config")),L=(0,k.W$)(e),M={pageId:"root",pageSessionId:U.Y.createPageSessionId()},y=(0,D.$I)(e,t,C,v,M,n),P=o.create(y,v,e),S=function(e,t,n,o,i,l){return{documents:w.a.bindComponent(Y.L.routes.documents,(()=>c.createElement(U.Y.ContextProviderInherited,{pageId:"home"},c.createElement(oe,{model:e,proofitViewModel:t.proofitViewModel,documentListViewModel:t.documentListViewModel,trashbinViewModel:t.trashbinViewModel,modalManager:t.modalManager,textResources:n.base,config:o})))),trash:w.a.bindComponent(Y.L.routes.trash,(()=>c.createElement(U.Y.ContextProviderInherited,{pageId:"trash"},c.createElement(re,{model:e,proofitViewModel:t.proofitViewModel,documentListViewModel:t.documentListViewModel,trashbinViewModel:t.trashbinViewModel,modalManager:t.modalManager,textResources:n.base})))),apps:w.a.bindComponent(Y.L.routes.apps,(()=>c.createElement(U.Y.ContextProviderInherited,{pageId:"apps"},c.createElement(ae,{model:e,textResources:n.base,config:o})))),new_document:w.a.bindComponent(Y.L.routes.new_document,(()=>c.createElement(K.F.div,null,J.RF((()=>e.documentsPage.actions.createDocument())).pipe(X.T(s.fold((()=>c.createElement(te.y,{className:ee.A.spinner})),(0,a.flow)(r.map((e=>e.id.toString())),r.fold((e=>(d.Bx.Logging.getLogger("routes").fatal("Fail create new document",e),c.createElement(N.l,null))),(e=>c.createElement(ne,{destination:Y.L.routes.editor.href({docId:e})})))))))))),editor:w.a.bindComponent(Y.L.routes.editor,(({docId:e})=>c.createElement(ne,{destination:Y.L.routes.denali_editor.href({docId:e})}))),denali_editor:w.a.bindComponent(Y.L.routes.denali_editor,(({docId:t})=>(e.apis.dox.clientType=i.names.dox,c.createElement(U.Y.ContextProviderInherited,{pageId:"document",docId:t},c.createElement(Y.L.Context.Consumer,null,(r=>c.createElement(ie,{wsConnectivity:e.wsConnectivity,networkState:e.networkState,selfUpdate:e.selfUpdate,doxApi:e.apis.dox,doxWSApi:e.apis.doxWS,docId:t,userAccount:e.userAccount,upgradeHook:e.upgradeHook,notificationsManager:e.notificationsManager,backendManagedStorageManager:e.backendManagedStorageManager,textResources:n,config:o,router:r,environment:i,platformEnvironment:l,telemetryContainerId:e.telemetry,fingerprints:e.fingerprints,experimentClient:e.experimentClient}))))))),not_found:w.a.bindComponent(Y.L.routes.not_found,(()=>c.createElement(ne,{destination:w.a.page({path:"/not-found",exact:!0}).href(),external:!0})))}}(y,P,L,C,e,t);return(0,$.e)(i),c.createElement(w.j.Context.Provider,{value:m},c.createElement(w.a.Wrapper,{routesMap:S,renderer:({match:n},o)=>(!0===o.private&&y.authentication.status.pipe(b.p(x.j.isOk),E.$()).subscribe((()=>{y.apis.dox.clientType="denali_editor"})),c.createElement(F.x,{pageName:"EditorCore",environment:e,platformEnvironment:t},c.createElement(z,{model:y},c.createElement(Y.L.Context.Provider,{value:v},c.createElement(U.Y.ContextProvider,(0,g._)((0,p._)({gnarSpec:y.gnarSpec},M),{sessionUuidGetter:()=>s.none}),!0===o.private?c.createElement("div",null,c.createElement(de,{authentication:y.authentication,onUserReady:()=>(0,u.pipe)(function(e,t){const{features:n}=e.userAccount;return n.demoMode&&!t.isActive(Y.L.routes.denali_editor.href({docId:"*"})).get()?(0,u.pipe)(n.denali.globalExperimentDemoText,s.map((t=>c.createElement(se,{model:e,demoText:t}))),s.alt((()=>(d.Bx.Logging.getLogger("global_experiment").fatal("No demo text assigned for global experiment"),s.none)))):s.none}(y,v),ce(y),s.getOrElse((()=>c.createElement(Z,{isEligible:"prod"===C.env&&y.userAccount.features.denali.isEligibleForGtm},o.component(n.params))))),config:C,model:y})):o.component(n.params))))))}))}const ce=e=>(e.userAccount.features.trackWebVitals&&B.measure(),a.identity),me=(0,i.e)(),{env:pe,platformEnv:ge}=(0,l.I)((()=>{me.then(s.fold(a.constVoid,(e=>e.clearAllStorage().then(r.mapLeft((e=>d.Bx.Logging.getLogger("BackendManagedStorage.clearAllStorage").warn(String(e),e))))))).catch((e=>d.Bx.Logging.getLogger("BackendManagedStorage.clearAllStorage").warn(`Unexpected promise rejection: ${String(e)}`,e)))}));m.render(c.createElement(le,{environment:pe,platformEnvironment:ge,backendManagedStorageManager:me}),document.getElementById("page"))}}]);